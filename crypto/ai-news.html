<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AI å‰æ²¿æ–°é—» Â· çƒ­åº¦è‡ªåŠ¨æ’è¡Œï¼ˆä¸­è‹±æº / ä¸­æ–‡æ‘˜è¦ / è¶‹åŠ¿å±•æœ›ï¼‰</title>
<style>
:root{
  --bg:#0a0f16; --panel:#101827; --text:#e6edf3; --muted:#9fb0c2; --line:#1f2a37;
  --chip:#162133; --link:#8ab4ff; --accent:#4c82ff; --danger:#ff8a8a; --ok:#25d07f;
}
*{box-sizing:border-box}
body{margin:0;background:radial-gradient(1200px 600px at 70% -10%, #142036 0%, transparent 70%) no-repeat, var(--bg);
  color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"SF Pro Text",Inter,"PingFang SC","Noto Sans CJK SC","Microsoft YaHei",Arial,sans-serif}
a{color:var(--link);text-decoration:none}
header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg, rgba(10,15,22,.9), rgba(10,15,22,.6));backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
.wrap{max-width:1200px;margin:0 auto;padding:14px 16px}
h1{margin:0;font-size:22px}
.sub{color:var(--muted);font-size:13px;margin-top:4px}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
input[type="search"]{background:#0f1623;border:1px solid #263144;color:var(--text);border-radius:10px;padding:10px 12px;outline:none;width:280px}
button{background:linear-gradient(180deg,#507bff,#3a63f0);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer;box-shadow:0 8px 18px rgba(76,130,255,.25)}
button.secondary{background:#182235;border:1px solid #2a3852;box-shadow:none;color:#d5e4ff}
select{background:#0f1623;border:1px solid #263144;color:var(--text);border-radius:8px;padding:6px 8px;margin-left:6px}
input[type="number"]{width:70px;background:#0f1623;border:1px solid #263144;color:var(--text);border-radius:8px;padding:4px 6px;margin-left:6px}
input[type="checkbox"]{margin-left:6px;transform:scale(1.1)}
main{max-width:1200px;margin:0 auto;padding:18px 16px 40px}
.grid{display:grid;grid-template-columns: 2fr 1fr;gap:16px}
@media (max-width:1000px){.grid{grid-template-columns:1fr}}
.panel{background:linear-gradient(180deg,#0f1726,#0c1421);border:1px solid var(--line);border-radius:14px;padding:14px}
.panel h2{margin:0 0 12px 0;font-size:16px;display:flex;align-items:center;gap:8px}
.chip{display:inline-flex;gap:6px;align-items:center;background:var(--chip);color:#cfe0ff;border:1px solid #27334a;border-radius:999px;padding:3px 8px;font-size:12px}
.list{display:flex;flex-direction:column;gap:10px}
.item{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:start;background:#0c1421;border:1px solid #1b2436;border-radius:12px;padding:12px}
.item:hover{border-color:#2b3a58;background:#0f1827}
.rank{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;background:#19263b;color:#cfe0ff}
.item h3{margin:0;font-size:15px;line-height:1.4}
.meta{color:#a7b9cc;font-size:12px;display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
.badge{font-size:11px;border:1px solid #2a3852;border-radius:999px;padding:2px 6px;background:#141d2b}
.score{font-variant-numeric:tabular-nums}
.desc{color:#c6d3e2;font-size:13px;margin-top:8px}
footer{color:#8aa0b4;font-size:12px;border-top:1px solid var(--line);padding:18px 16px 48px;max-width:1200px;margin:0 auto}
.skeleton{height:14px;width:100%;border-radius:6px;background:linear-gradient(90deg,#0f1622,#121b2c,#0f1622);background-size:200% 100%;animation:shine 1.4s linear infinite}
@keyframes shine{0%{background-position:200% 0}100%{background-position:-200% 0}}
/* CN summary & trends */
.desc-cn{color:#d8e7ff;font-size:13px;margin-top:6px;border-left:3px solid #2a3a56;padding-left:10px}
.cn-tag{display:inline-block;margin-right:6px}
.trend-card{background:linear-gradient(180deg,#0d1626,#0a1220);border:1px solid #22304a;border-radius:14px;padding:14px}
.trend-card h3{margin:0 0 8px 0;font-size:15px}
.trend-list{margin:0;padding-left:18px;color:#cfe0ff}
.kpi{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
.kpi .badge{background:#0f1a2b}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>AI å‰æ²¿æ–°é—» Â· çƒ­åº¦è‡ªåŠ¨æ’è¡Œ</h1>
    <div class="sub">æ¥æºæ¶µç›–ï¼šTechCrunch / VentureBeat / MIT Tech Review / Ars Technica / Wired / OpenAI / Google AI / DeepMind / Hugging Face / arXiv ç­‰ï¼ˆå«ä¸­æ–‡ï¼šæœºå™¨ä¹‹å¿ƒã€é‡å­ä½ï¼‰</div>
    <div class="controls">
      <input id="q" type="search" placeholder="æœç´¢æ ‡é¢˜ / æ¥æº / å…³é”®è¯â€¦">
      <label class="chip">æ—¶é—´çª—å£
        <select id="timewin">
          <option value="latest" selected>æœ€æ–°</option>
          <option value="24h">è¿‘ 24 å°æ—¶</option>
          <option value="48h">è¿‘ 48 å°æ—¶</option>
        </select>
      </label>
      <button id="refresh">ç«‹å³åˆ·æ–°</button>
      <button id="toggleAuto" class="secondary">è‡ªåŠ¨åˆ·æ–°ï¼šå¼€å¯</button>
      <button id="toggleCN" class="secondary">ä¸­æ–‡æ‘˜è¦ï¼šå¼€å¯</button>
      <label class="chip">ä¸­æ–‡æºè®¡å…¥çƒ­åº¦ <input id="cnInHot" type="checkbox"></label>
      <label class="chip">ä¸­æ–‡æºæƒé‡ <input id="cnWeight" type="number" step="0.05" min="0" max="1" value="0"></label>
      <label class="chip">LLM/AGI æƒé‡ <input id="wLLM" type="number" step="0.01" min="0" max="1" value="0.22"></label>
      <label class="chip">RAG æƒé‡ <input id="wRAG" type="number" step="0.01" min="0" max="1" value="0.14"></label>
      <label class="chip">MoE æƒé‡ <input id="wMOE" type="number" step="0.01" min="0" max="1" value="0.14"></label>
      <label class="chip">è§†é¢‘ç”Ÿæˆ æƒé‡ <input id="wVideo" type="number" step="0.01" min="0" max="1" value="0.16"></label>
      <span class="chip">æœ¬åœ°æ—¶é—´ <span id="now"></span></span>
    </div>
  </div>
</header>

<main>
  <!-- TOP: Trend panel -->
  <section class="panel" id="trend" style="margin-bottom:20px">
    <h2>ğŸ“ˆ æ€»ä½“è¶‹åŠ¿ & 30 å¤©å±•æœ› <span class="chip" id="trendUpdated">ç”Ÿæˆä¸­â€¦</span></h2>
    <div id="trendBody">
      <div class="skeleton" style="height:18px"></div>
      <div class="skeleton" style="height:14px;width:80%"></div>
      <div class="skeleton" style="height:14px;width:60%"></div>
    </div>
  </section>

  <div class="grid">
    <section class="panel" id="hot">
      <h2>ğŸ”¥ çƒ­ç‚¹ Top 10 <span class="chip" id="hotUpdated">åŠ è½½ä¸­â€¦</span></h2>
      <div class="list" id="hotList">
        <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
        <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
      </div>
    </section>

    <section class="panel src-panel" id="bySource">
      <h2>ğŸ“° æŒ‰æ¥æºæµè§ˆ <span class="chip" id="srcUpdated">åŠ è½½ä¸­â€¦</span></h2>
      <div id="srcLists"></div>
    </section>
  </div>
</main>

<footer>
  æ³¨ï¼šæœ¬é¡µé€šè¿‡å®˜æ–¹/å…¬å¼€ RSS è·å–æ ‡é¢˜ä¸æ‘˜è¦ï¼Œæ— æ³•è·å–ä»˜è´¹å¢™å…¨æ–‡ï¼›â€œçƒ­åº¦åˆ†â€é‡‡ç”¨å¯å‘å¼ç®—æ³•ï¼š<span class="badge">æ—¶æ•ˆæ€§è¡°å‡</span> + <span class="badge">å¤šæºé‡å¤åº¦</span> + <span class="badge">å…³é”®è¯åŠ æƒ</span>ï¼ˆå¦‚ LLM/AGIã€RAGã€MoEã€è§†é¢‘ç”Ÿæˆã€èŠ¯ç‰‡ç­‰ï¼‰ã€‚ä»…ä½œèµ„è®¯æ’åºå‚è€ƒã€‚
</footer>

<script>
const feeds = [
  // ä¸­æ–‡èµ„è®¯æºï¼ˆé»˜è®¤ä¸è®¡å…¥çƒ­åº¦ï¼Œå¯åˆ‡æ¢/è®¾ç½®æƒé‡ï¼‰
  { name: "æœºå™¨ä¹‹å¿ƒ", home: "https://www.jiqizhixin.com", url: "https://www.jiqizhixin.com/rss", isCN:true },
  { name: "é‡å­ä½",   home: "https://www.qbitai.com",    url: "https://www.qbitai.com/feed", isCN:true },

  // è‹±æ–‡èµ„è®¯æºï¼ˆåª’ä½“ï¼‰
  { name: "TechCrunch AI",     home: "https://techcrunch.com",         url: "https://techcrunch.com/category/artificial-intelligence/feed/" },
  { name: "VentureBeat AI",    home: "https://venturebeat.com",        url: "https://venturebeat.com/category/ai/feed/" },
  { name: "MIT Tech Review",   home: "https://www.technologyreview.com", url: "https://www.technologyreview.com/feed/" },
  { name: "The Verge",         home: "https://www.theverge.com",       url: "https://www.theverge.com/rss/index.xml" },
  { name: "Ars Technica AI",   home: "https://arstechnica.com",        url: "https://arstechnica.com/tag/artificial-intelligence/feed/" },
  { name: "Wired AI",          home: "https://www.wired.com",          url: "https://www.wired.com/feed/tag/ai/latest/rss" },

  // å®˜æ–¹/ç ”ç©¶åšå®¢
  { name: "OpenAI Blog",       home: "https://openai.com/blog",        url: "https://openai.com/blog/rss" },
  { name: "Google AI Blog",    home: "https://ai.googleblog.com",      url: "https://ai.googleblog.com/feeds/posts/default" },
  { name: "DeepMind Blog",     home: "https://deepmind.google/discover/blog", url: "https://deepmind.google/discover/blog/rss/" },
  { name: "Hugging Face Blog", home: "https://huggingface.co/blog",    url: "https://huggingface.co/blog/feed.xml" },

  // å­¦æœ¯/è®ºæ–‡
  { name: "arXiv cs.AI",       home: "https://arxiv.org",              url: "https://export.arxiv.org/rss/cs.AI" },
  { name: "arXiv cs.CL",       home: "https://arxiv.org",              url: "https://export.arxiv.org/rss/cs.CL" }
];

const MAX_PER_FEED = 14;
const HOT_LIMIT = 10;
let auto = true, autoTimer = null;
let showCN = true;

// time & controls
const hotList = document.getElementById('hotList');
const hotUpdated = document.getElementById('hotUpdated');
const srcUpdated = document.getElementById('srcUpdated');
const trendUpdated = document.getElementById('trendUpdated');
const trendBody = document.getElementById('trendBody');

const q = document.getElementById('q');
const nowEl = document.getElementById('now');
const btnRefresh = document.getElementById('refresh');
const btnAuto = document.getElementById('toggleAuto');
const btnCN = document.getElementById('toggleCN');

const selTime = document.getElementById('timewin');
const chkCnInHot = document.getElementById('cnInHot');
const inpCnWeight = document.getElementById('cnWeight');
const wLLM = document.getElementById('wLLM');
const wRAG = document.getElementById('wRAG');
const wMOE = document.getElementById('wMOE');
const wVideo = document.getElementById('wVideo');

let CN_INCLUDE_IN_HOT = false;
let CN_WEIGHT = 0.0;

function tickNow(){ nowEl.textContent = new Date().toLocaleString(); }
setInterval(tickNow, 1000); tickNow();

btnRefresh.addEventListener('click', refreshAll);
btnAuto.addEventListener('click', ()=>{
  auto = !auto;
  btnAuto.textContent = 'è‡ªåŠ¨åˆ·æ–°ï¼š' + (auto ? 'å¼€å¯' : 'å…³é—­');
  btnAuto.classList.toggle('secondary', !auto);
  if(auto) autoTimer = setInterval(refreshAll, 15*60*1000);
  else clearInterval(autoTimer);
});
btnCN.addEventListener('click', ()=>{
  showCN = !showCN;
  btnCN.textContent = 'ä¸­æ–‡æ‘˜è¦ï¼š' + (showCN ? 'å¼€å¯' : 'å…³é—­');
  for(const el of document.querySelectorAll('.desc-cn')) el.style.display = showCN ? '' : 'none';
});

q.addEventListener('input', ()=>{
  for (const el of document.querySelectorAll('[data-search]')){
    const hit = (el.dataset.search || '').includes(q.value.trim().toLowerCase());
    el.style.display = hit ? '' : 'none';
  }
});

chkCnInHot.addEventListener('change', ()=>{ CN_INCLUDE_IN_HOT = chkCnInHot.checked; refreshAll(); });
inpCnWeight.addEventListener('input', ()=>{ CN_WEIGHT = Math.max(0, Math.min(1, parseFloat(inpCnWeight.value||'0')||0)); });
[wLLM, wRAG, wMOE, wVideo, selTime].forEach(el => el.addEventListener('input', ()=> refreshAll()));
selTime.addEventListener('change', ()=> refreshAll());

function getKeywordBoosts(){
  const wLLMV = parseFloat(wLLM.value||'0.22') || 0;
  const wRAGV = parseFloat(wRAG.value||'0.14') || 0;
  const wMOEV = parseFloat(wMOE.value||'0.14') || 0;
  const wVideoV = parseFloat(wVideo.value||'0.16') || 0;
  return [
    // äº§å“/è¡Œä¸šçº§å…³é”®è¯
    {re:/\b(AGI|LLM|GPT|Claude|Gemini|Llama|Mistral|o1|o3|Sora)\b/i, w:wLLMV},
    {re:/\b(RAG|retrieval[- ]augmented|vector|embedding)\b/i, w:wRAGV},
    {re:/\b(MoE|Mixture of Experts|experts)\b/i, w:wMOEV},
    {re:/\b(video generation|text-to-video|sora|vlogr|runway|pika)\b/i, w:wVideoV},
    // èŠ¯ç‰‡/ç®—åŠ›/åŸºå»º
    {re:/\b(H100|H200|H200|B200|GB200|TPU|MI300|MI325|Blackwell|Grace|NVLink|inference|throughput)\b/i, w:0.18},
    // å®‰å…¨ä¸æ”¿ç­–
    {re:/\b(AI safety|alignment|red teaming|evals|policy|regulation|compliance|copyright|lawsuit)\b/i, w:0.18},
    // ç ”ç©¶æŒ‡æ ‡
    {re:/\b(SOTA|benchmark|MMLU|Arena|MT-Bench|HumanEval|GSM8K|TÃœLU|Tulu|L-Eval)\b/i, w:0.16},
    // å¼€æºä¸æ¨¡å‹å‘å¸ƒ
    {re:/\b(release|weights|checkpoint|open source|opensource|license|Apache-2\.0|MIT)\b/i, w:0.14}
  ];
}

function inTimeWindow(pubDate){
  if(!pubDate) return true;
  const mode = selTime.value || 'latest';
  if(mode==='latest') return true;
  const ageMs = Date.now() - new Date(pubDate).getTime();
  const limit = (mode==='24h') ? 24*3600000 : 48*3600000;
  return ageMs <= limit;
}

function domainFrom(u){ try{ return new URL(u).hostname.replace(/^www\./,''); }catch(_){ return ''; } }
function strip(html){ const d = document.createElement('div'); d.innerHTML = html; return d.textContent || d.innerText || ''; }
function trunc(s, n=200){ if(!s) return ''; return s.length>n ? s.slice(0,n-1) + 'â€¦' : s; }

async function fetchWithFallbacks(url){
  try{ const r = await fetch(url, {mode:'cors'}); if(r.ok){ return { kind:'xml', text: await r.text() }; } }catch(e){}
  try{ const r = await fetch('https://api.allorigins.win/raw?url='+encodeURIComponent(url)); if(r.ok){ return { kind:'xml', text: await r.text() }; } }catch(e){}
  try{ const r = await fetch('https://api.rss2json.com/v1/api.json?rss_url='+encodeURIComponent(url)); if(r.ok){ return { kind:'json', json: await r.json() }; } }catch(e){}
  throw new Error('è·å–å¤±è´¥ï¼š'+url);
}

function parseXMLItems(xmlText){
  const dp = new DOMParser(); const doc = dp.parseFromString(xmlText, 'text/xml');
  let nodes = [...doc.querySelectorAll('item')]; if(nodes.length===0) nodes = [...doc.querySelectorAll('entry')];
  const items = nodes.map(n=>{
    const title = n.querySelector('title')?.textContent?.trim() || 'Untitled';
    const link = n.querySelector('link')?.getAttribute?.('href') || n.querySelector('link')?.textContent?.trim() || '#';
    const pubDate = n.querySelector('pubDate')?.textContent?.trim() || n.querySelector('updated')?.textContent?.trim() || n.querySelector('published')?.textContent?.trim() || '';
    const desc = n.querySelector('description')?.textContent || n.querySelector('content\\:encoded')?.textContent || '';
    return { title, link, pubDate, desc };
  });
  return items;
}
function parseJSONItems(j){
  return (j.items||[]).map(x=>({ title:x.title, link:x.link, pubDate:x.pubDate||x.published||'', desc:x.description||'' }));
}

function normalizeTitle(s){
  return (s||'').toLowerCase()
    .replace(/[\|\-â€“â€”Â·â€¢:;,_()\[\]{}]/g,' ')
    .replace(/\s+/g,' ')
    .replace(/\b(breaking|update|news)\b/g,'')
    .trim();
}

function classifyCategory(text){
  const t = text.toLowerCase();
  if(/(policy|regulation|copyright|lawsuit|compliance|eu ai act|white house)/i.test(t)) return 'æ”¿ç­–/åˆè§„';
  if(/(h100|b200|gb200|tpu|mi300|blackwell|inference|throughput|latency)/i.test(t)) return 'èŠ¯ç‰‡/ç®—åŠ›';
  if(/(rag|retrieval[- ]augmented|vector|embedding|bedrock|pinecone|faiss|milvus)/i.test(t)) return 'RAG/æ£€ç´¢';
  if(/(moe|mixture of experts|experts)/i.test(t)) return 'MoE æ¶æ„';
  if(/(video generation|text-to-video|sora|runway|pika|gen-3)/i.test(t)) return 'è§†é¢‘ç”Ÿæˆ';
  if(/(sota|benchmark|mmlu|human ?eval|gsm8k|mt[- ]bench|arena|eval)/i.test(t)) return 'è¯„æµ‹/SOTA';
  if(/(release|weights|checkpoint|open source|license|apache|mit|hugging face)/i.test(t)) return 'å¼€æº/å‘å¸ƒ';
  if(/(bug|exploit|red team|abuse|safety|alignment)/i.test(t)) return 'å®‰å…¨/å¯¹é½';
  if(/(agi|llm|gpt|claude|gemini|llama|mistral|o1|o3)/i.test(t)) return 'æ¨¡å‹/äº§å“';
  return 'å…¶ä»–';
}

function cnSummary(it){
  const title = it.title || '';
  const desc = (it.desc || '').replace(/\s+/g,' ').trim();
  const cat = classifyCategory(title + ' ' + desc);
  const time = it.pubDate ? new Date(it.pubDate).toLocaleString() : '';

  let point = '';
  switch(cat){
    case 'æ”¿ç­–/åˆè§„':
      point = 'æ”¿ç­–ä¸åˆè§„åŠ¨æ€å°†å½±å“äº§å“åˆè§„è¾¹ç•Œä¸å•†ç”¨è½åœ°èŠ‚å¥ï¼ŒçŸ­æœŸæˆ–å¸¦æ¥ä¼°å€¼é‡å®šä»·ã€‚'; break;
    case 'èŠ¯ç‰‡/ç®—åŠ›':
      point = 'èŠ¯ç‰‡ä¸ç®—åŠ›ä¾›ç»™å†³å®šè®­ç»ƒä¸æ¨ç†æˆæœ¬ï¼Œä¸­æœŸå½±å“æ¨¡å‹è¿­ä»£é€Ÿåº¦ä¸å•†ä¸šå¯è¡Œæ€§ã€‚'; break;
    case 'RAG/æ£€ç´¢':
      point = 'RAG åŸºå»ºå‡çº§æå‡ä¼ä¸šçº§å‡†ç¡®æ€§ä¸å¯æ§æ€§ï¼Œæ˜¯è½åœ°è·¯å¾„çš„é‡è¦å¢é‡ã€‚'; break;
    case 'MoE æ¶æ„':
      point = 'MoE åœ¨æ•ˆç‡ä¸è´¨é‡é—´å¹³è¡¡ï¼Œè‹¥å·¥å…·é“¾æˆç†Ÿï¼Œå¯èƒ½æˆä¸ºä¸»æµæ¶æ„ä¹‹ä¸€ã€‚'; break;
    case 'è§†é¢‘ç”Ÿæˆ':
      point = 'è§†é¢‘ç”Ÿæˆè¿›å…¥é«˜è´¨é‡é˜¶æ®µï¼Œåº”ç”¨æ‰©å±•è¿…é€Ÿï¼Œä½†ç‰ˆæƒä¸åˆè§„æŒ‘æˆ˜ä¸Šå‡ã€‚'; break;
    case 'è¯„æµ‹/SOTA':
      point = 'è¯„æµ‹ä¸å¯¹é½æŒ‡æ ‡æ›´æ–°å¯å¿«é€Ÿæ”¹å˜è¡Œä¸šæ’åï¼Œéœ€å…³æ³¨è¯„æµ‹å®¢è§‚æ€§ä¸ä½œå¼Šé˜²èŒƒã€‚'; break;
    case 'å¼€æº/å‘å¸ƒ':
      point = 'å¼€æºå‘å¸ƒä¸æƒé‡å¼€æ”¾èƒ½å¿«é€Ÿæ‰©æ•£èƒ½åŠ›ï¼Œç”Ÿæ€ä¸è®¸å¯è¯é€‰æ‹©å†³å®šäº§ä¸šå½±å“ã€‚'; break;
    case 'å®‰å…¨/å¯¹é½':
      point = 'å®‰å…¨ä¸å¯¹é½ç ”ç©¶å†³å®šå¯æ§æ€§è¾¹ç•Œï¼ŒçŸ­æœŸå‹åˆ¶é£é™©ï¼Œé•¿æœŸæå‡å¯ç”¨æ€§ã€‚'; break;
    case 'æ¨¡å‹/äº§å“':
      point = 'æ¨¡å‹/äº§å“æ›´æ–°å½±å“ç”¨æˆ·é¢ä¸ç”Ÿæ€ç«äº‰æ ¼å±€ï¼Œå¸¸ä¸ç®—åŠ›ä¸è¯„æµ‹è”åŠ¨ã€‚'; break;
    default:
      point = 'è¯¥æ¶ˆæ¯å½±å“éœ€ç»“åˆåç»­æŠ«éœ²ä¸å¤šæºéªŒè¯å†åˆ¤æ–­ã€‚';
  }

  let concl = '';
  switch(cat){
    case 'æ”¿ç­–/åˆè§„':
      concl = 'ç»“è®ºï¼šè·Ÿè¸ªå®˜æ–¹æ–‡æœ¬ä¸å®æ–½ç»†åˆ™ï¼›ä¼ä¸šåº”ç”¨éœ€åŒæ­¥è¯„ä¼°åˆè§„æˆæœ¬ä¸æ•°æ®æ²»ç†ã€‚'; break;
    case 'èŠ¯ç‰‡/ç®—åŠ›':
      concl = 'ç»“è®ºï¼šå…³æ³¨ä¾›ç»™èŠ‚å¥ä¸ä»·æ ¼æ›²çº¿ï¼›æ¨ç†æˆæœ¬ä¸‹é™å°†é‡Šæ”¾æ›´å¤šå•†ä¸šåœºæ™¯ã€‚'; break;
    case 'RAG/æ£€ç´¢':
      concl = 'ç»“è®ºï¼šä¼˜å…ˆéªŒè¯æ£€ç´¢è´¨é‡ä¸çŸ¥è¯†æ—¶æ•ˆï¼›ç»“åˆè§‚æµ‹æ—¥å¿—è¿›è¡Œè¯„ä¼°é—­ç¯ã€‚'; break;
    case 'MoE æ¶æ„':
      concl = 'ç»“è®ºï¼šè¯„ä¼°è·¯ç”±ç¨³å®šæ€§ä¸å·¥å…·é“¾æˆç†Ÿåº¦ï¼›åœ¨é«˜åååœºæ™¯æ¸è¿›å¼è¯•ç‚¹ã€‚'; break;
    case 'è§†é¢‘ç”Ÿæˆ':
      concl = 'ç»“è®ºï¼šé‡è§†ç‰ˆæƒåˆè§„ä¸å®‰å…¨æ°´å°ï¼›ä¼˜å…ˆé€‰æ‹©å¯æ§åº¦é«˜çš„åº”ç”¨åœºæ™¯ã€‚'; break;
    case 'è¯„æµ‹/SOTA':
      concl = 'ç»“è®ºï¼šé¿å…å”¯æŒ‡æ ‡è®ºï¼›ç»“åˆä¼ä¸šä»»åŠ¡é›†è¿›è¡Œå¯¹é½ä¸ç¨³å¥æ€§éªŒè¯ã€‚'; break;
    case 'å¼€æº/å‘å¸ƒ':
      concl = 'ç»“è®ºï¼šæ ¸å¯¹è®¸å¯è¯ä¸å•†ç”¨æ¡æ¬¾ï¼›ç»“åˆå›¢é˜Ÿèƒ½åŠ›é€‰æ‹©è‡ªç ”/é›†æˆè·¯å¾„ã€‚'; break;
    case 'å®‰å…¨/å¯¹é½':
      concl = 'ç»“è®ºï¼šå»ºç«‹çº¢é˜Ÿä¸è‡ªåŠ¨åŒ–è¯„æµ‹ï¼›å®‰å…¨èƒ½åŠ›çº³å…¥é‡‡è´­ä¸ä¸Šçº¿é—¨æ§›ã€‚'; break;
    case 'æ¨¡å‹/äº§å“':
      concl = 'ç»“è®ºï¼šç»“åˆçœŸå®ç”¨ä¾‹è¿›è¡Œ A/B ä¸æˆæœ¬è¯„ä¼°ï¼›å…³æ³¨ç”Ÿæ€ä¸æ’ä»¶æ‰©å±•ã€‚'; break;
    default:
      concl = 'ç»“è®ºï¼šç»´æŒè§‚å¯Ÿï¼Œç­‰å¾…å¤šæºç¡®è®¤åå†è¯„ä¼°ä»·å€¼ã€‚';
  }

  return {cat, point, concl, time};
}

function renderCnBlock(it){
  const s = cnSummary(it);
  return `<div class="desc-cn" style="${showCN?'':'display:none'}">
    <span class="badge cn-tag">ç±»åˆ«ï¼š${s.cat}</span>
    <span class="badge">${s.time || ''}</span>
    <div style="margin-top:6px">${s.point}</div>
    <div class="muted" style="margin-top:4px">${s.concl}</div>
  </div>`;
}

function buildTrends(hot){
  const counts = { 'æ”¿ç­–/åˆè§„':0, 'èŠ¯ç‰‡/ç®—åŠ›':0, 'RAG/æ£€ç´¢':0, 'MoE æ¶æ„':0, 'è§†é¢‘ç”Ÿæˆ':0, 'è¯„æµ‹/SOTA':0, 'å¼€æº/å‘å¸ƒ':0, 'å®‰å…¨/å¯¹é½':0, 'æ¨¡å‹/äº§å“':0, 'å…¶ä»–':0 };
  let newestTs = 0;
  for(const it of hot){
    const cat = classifyCategory((it.title||'') + ' ' + (it.desc||''));
    counts[cat] = (counts[cat]||0) + 1;
    const ts = it.pubDate ? new Date(it.pubDate).getTime() : 0;
    if(ts > newestTs) newestTs = ts;
  }
  const focus = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,3);
  const dateStr = newestTs? new Date(newestTs).toLocaleString() : '';

  const bullets = [];
  if(counts['æ¨¡å‹/äº§å“']>0) bullets.push('æ¨¡å‹/äº§å“æ›´æ–°å¯†é›†ï¼Œç”Ÿæ€ç«äº‰åŠ é€Ÿï¼›æ³¨æ„è¯„æµ‹ä¸æˆæœ¬çš„è”åŠ¨å˜åŒ–ã€‚');
  if(counts['èŠ¯ç‰‡/ç®—åŠ›']>0) bullets.push('èŠ¯ç‰‡/ç®—åŠ›ä¾›ç»™ä¸ä»·æ ¼æ›²çº¿æ˜¯å…³é”®å˜é‡ï¼Œå†³å®šè®­ç»ƒ/æ¨ç†èŠ‚å¥ã€‚');
  if(counts['å¼€æº/å‘å¸ƒ']>0) bullets.push('å¼€æºä¸æƒé‡å¼€æ”¾å¸¦æ¥æ‰©æ•£æ•ˆåº”ï¼Œåº”ç”¨ä¾§å°†å¿«é€Ÿè·Ÿè¿›ã€‚');
  if(counts['è§†é¢‘ç”Ÿæˆ']>0) bullets.push('è§†é¢‘ç”Ÿæˆçƒ­åº¦ä¸Šå‡ï¼Œéœ€å…³æ³¨ç‰ˆæƒä¸å®‰å…¨æ°´å°æŠ€æœ¯ã€‚');
  if(counts['æ”¿ç­–/åˆè§„']>0) bullets.push('æ”¿ç­–åˆè§„äº‹é¡¹å¢å¤šï¼Œä¼ä¸šè½åœ°éœ€åŒæ­¥å‡çº§æ²»ç†ä¸å®¡è®¡èƒ½åŠ›ã€‚');
  if(bullets.length===0) bullets.push('å¸‚åœºä¸»é¢˜åˆ†æ•£ï¼Œå»ºè®®ä»¥é£æ§ä¸è¯„æµ‹å…ˆè¡Œï¼Œè°¨æ…æ‰©å¼ ã€‚');

  const outlook = [];
  outlook.push('30 å¤©å±•æœ›ï¼š');
  if(counts['èŠ¯ç‰‡/ç®—åŠ›']>=counts['æ”¿ç­–/åˆè§„']) {
    outlook.push('è‹¥ç®—åŠ›ä¸å·¥å…·é“¾åˆ©å¥½å ä¼˜ï¼Œäº§å“ä¸å¼€æºæ›´æ–°å°†ç»§ç»­é«˜é¢‘å‡ºç°ï¼ŒBç«¯éªŒè¯åŠ é€Ÿã€‚');
  } else {
    outlook.push('è‹¥æ”¿ç­–/åˆè§„æ‰°åŠ¨å¢å¼ºï¼ŒèŠ‚å¥æˆ–æ”¾ç¼“ï¼›ä¼˜å…ˆå·©å›ºå®‰å…¨ä¸æ²»ç†èƒ½åŠ›ã€‚');
  }
  outlook.push('å»ºè®®å…³æ³¨ï¼šæ¨¡å‹æ›´æ–° â†’ è¯„æµ‹éªŒè¯ â†’ æˆæœ¬ç»“æ„ â†’ å®é™…è½åœ°çš„é—­ç¯ã€‚');

  const kpi = `
    <div class="kpi">
      ${focus.map(([k,v])=>`<span class="badge">${k}ï¼š${v} æ¡</span>`).join('')}
      <span class="badge">æœ€æ–°æ—¶é—´ï¼š${dateStr||'â€”'}</span>
    </div>`;

  return `
    <div class="trend-card">
      <h3>è¦ç‚¹</h3>
      ${kpi}
      <ul class="trend-list">
        ${bullets.map(x=>`<li>${x}</li>`).join('')}
      </ul>
      <h3 style="margin-top:10px">é¢„æµ‹</h3>
      <ul class="trend-list">
        ${outlook.map(x=>`<li>${x}</li>`).join('')}
      </ul>
    </div>
  `;
}

// ===== Aggregation & Scoring =====
function inTimeWindow(pubDate){
  if(!pubDate) return true;
  const mode = selTime.value || 'latest';
  if(mode==='latest') return true;
  const ageMs = Date.now() - new Date(pubDate).getTime();
  const limit = (mode==='24h') ? 24*3600000 : 48*3600000;
  return ageMs <= limit;
}

function scoreItem(it, appearances=1){
  const KEYWORD_BOOSTS = getKeywordBoosts();
  // recency
  let recency = 0;
  if(it.pubDate){
    const ageMs = Date.now() - new Date(it.pubDate).getTime();
    const ageH = Math.max(0, ageMs/3600000);
    recency = Math.exp(-ageH/24); // 24h åŠè¡°
  }
  // keywords
  const text = (it.title + ' ' + (it.desc||'')).toLowerCase();
  let ksum = 0;
  for (const r of KEYWORD_BOOSTS){ if(r.re.test(text)) ksum += r.w; }
  // multi-source
  const multi = Math.min(1, 0.3 * Math.max(0, appearances-1));
  let score = 0.6*recency + ksum + multi + 0.1;

  if(it.isCN){ score = score * (CN_WEIGHT>0 ? (1+CN_WEIGHT) : 1); }
  return Math.round(score*100)/100;
}

async function refreshAll(){
  hotUpdated.textContent = 'æ›´æ–°ä¸­â€¦';
  srcUpdated.textContent = 'æ›´æ–°ä¸­â€¦';
  trendUpdated.textContent = 'ç”Ÿæˆä¸­â€¦';
  hotList.innerHTML = '<div class="skeleton"></div>'.repeat(10);
  document.getElementById('srcLists').innerHTML = '';

  const allBySource = [];
  await Promise.all(feeds.map(async f=>{
    try{
      const res = await fetchWithFallbacks(f.url);
      let items = res.kind==='xml' ? parseXMLItems(res.text) : parseJSONItems(res.json);
      items = items.slice(0, MAX_PER_FEED).map(x=>({ ...x, source:f.name, home:f.home, isCN: !!f.isCN }));
      allBySource.push({ source:f.name, home:f.home, items, isCN: !!f.isCN });
    }catch(e){
      allBySource.push({ source:f.name, home:f.home, items:[{ title:'âŒ æ‹‰å–å¤±è´¥ï¼š'+e.message, link:f.home, pubDate:'', desc:'' }], isCN: !!f.isCN });
    }
  }));

  // é‡å¤èšåˆ
  const bucket = new Map();
  for (const pkg of allBySource){
    for (const it of pkg.items){
      if (!inTimeWindow(it.pubDate)) continue; // æ—¶é—´çª—å£è¿‡æ»¤ï¼ˆè¿›å…¥ HOT çš„å‰ç½®æ¡ä»¶ï¼‰
      const key = normalizeTitle(it.title);
      if(!bucket.has(key)) bucket.set(key, { item: it, appearances:1, sources:new Set([it.source]) });
      else{
        const o = bucket.get(key);
        o.appearances += 1; o.sources.add(it.source);
        if(new Date(it.pubDate) > new Date(o.item.pubDate)) o.item = it;
        o.item.isCN = o.item.isCN || it.isCN;
      }
    }
  }

  // è®¡ç®—çƒ­åº¦
  let hot = [];
  for (const [_, obj] of bucket){
    const isCN = !!obj.item.isCN || (obj.item.source && (obj.item.source.includes('æœºå™¨ä¹‹å¿ƒ') || obj.item.source.includes('é‡å­ä½')));
    if(isCN && !CN_INCLUDE_IN_HOT) continue; // ä¸­æ–‡æºä¸è®¡å…¥ HOTï¼ˆå¯åˆ‡æ¢ï¼‰
    const s = scoreItem(obj.item, obj.appearances);
    hot.push({ ...obj.item, appearances: obj.appearances, sources: [...obj.sources], score: s });
  }
  hot.sort((a,b)=> b.score - a.score);
  hot = hot.slice(0, HOT_LIMIT);

  // æ¸²æŸ“ HOT
  hotList.innerHTML = hot.map((it, idx)=>{
    const dom = domainFrom(it.link) || it.source;
    const time = it.pubDate ? new Date(it.pubDate).toLocaleString() : '';
    const search = (it.title + ' ' + dom + ' ' + it.source).toLowerCase();
    const excerpt = trunc(strip(it.desc||''), 220);
    return `
      <article class="item" data-search="${search}">
        <div class="rank">${idx+1}</div>
        <div>
          <h3><a href="${it.link}" target="_blank" rel="noopener">${it.title}</a></h3>
          <div class="meta">
            <span class="badge">æ¥æºï¼š${it.source}${it.appearances>1?` Â· ${it.appearances}æºå…±è¯†`:''}</span>
            ${time?`<span class="badge">${time}</span>`:''}
            <span class="badge score">çƒ­åº¦åˆ†ï¼š${it.score.toFixed(2)}</span>
          </div>
          ${excerpt?`<div class="desc">${excerpt}</div>`:''}
          ${renderCnBlock(it)}
          <div class="actions" style="margin-top:8px">
            <a class="chip" href="${it.link}" target="_blank" rel="noopener">é˜…è¯»å…¨æ–‡ â†’</a>
            <a class="chip" href="${feeds.find(f=>f.name===it.source)?.home||'#'}" target="_blank" rel="noopener">è®¿é—® ${it.source}</a>
          </div>
        </div>
        <div><span class="chip">${dom}</span></div>
      </article>
    `;
  }).join('');
  hotUpdated.textContent = 'æ›´æ–°å®Œæˆ Â· ' + new Date().toLocaleTimeString();

  // è¶‹åŠ¿é¢æ¿ï¼ˆåŸºäº HOTï¼Œä»¥ä¾¿ä¸æ—¶é—´çª—å£ä¸€è‡´ï¼‰
  trendBody.innerHTML = buildTrends(hot);
  trendUpdated.textContent = 'å·²ç”Ÿæˆ';

  // æŒ‰æ¥æºæ¸²æŸ“ï¼ˆä¸å¼ºåˆ¶æ—¶é—´çª—å£è¿‡æ»¤ï¼Œä¾¿äºæ ¸å¯¹ï¼‰
  const srcLists = document.getElementById('srcLists');
  srcLists.innerHTML = allBySource.map(pkg=>{
    const list = pkg.items.map(it=>{
      const t = it.pubDate ? new Date(it.pubDate).toLocaleString() : '';
      const ex = trunc(strip(it.desc||''), 140);
      const s = inTimeWindow(it.pubDate) ? scoreItem(it, 1) : NaN;
      const search = (it.title + ' ' + pkg.source + ' ' + (it.link||'')).toLowerCase();
      return `
        <div class="item" data-search="${search}" style="grid-template-columns:1fr auto">
          <div>
            <h3><a href="${it.link}" target="_blank" rel="noopener">${it.title}</a></h3>
            <div class="meta">
              ${t?`<span class="badge">${t}</span>`:''}
              ${!isNaN(s)?`<span class="badge score">çƒ­åº¦åˆ†ï¼š${s.toFixed(2)}</span>`:'<span class="badge">çª—å£å¤–</span>'}
            </div>
            ${ex?`<div class="desc">${ex}</div>`:''}
            ${inTimeWindow(it.pubDate)?renderCnBlock(it):''}
          </div>
          <div><a class="chip" href="${pkg.home}" target="_blank" rel="noopener">ä¸»é¡µ</a></div>
        </div>
      `;
    }).join('');
    return `
      <div class="panel" style="margin-bottom:12px">
        <h2>${pkg.source}${pkg.isCN?' <span class="badge">ä¸­æ–‡</span>':''}</h2>
        <div class="list">${list}</div>
      </div>
    `;
  }).join('');

  // åº”ç”¨æœç´¢è¿‡æ»¤ï¼ˆè‹¥æœ‰å…³é”®å­—ï¼‰
  q.dispatchEvent(new Event('input'));
}

// init
refreshAll();
autoTimer = setInterval(refreshAll, 15*60*1000);
</script>
</body>
</html>
