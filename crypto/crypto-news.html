<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>åŠ å¯†æ–°é—» Â· çƒ­åº¦è‡ªåŠ¨æ’è¡Œï¼ˆ5 ä¸ªå…è´¹æºï¼‰</title>
<style>
:root{
  --bg:#0a0f16; --panel:#101827; --text:#e6edf3; --muted:#9fb0c2; --line:#1f2a37;
  --chip:#162133; --link:#8ab4ff; --accent:#4c82ff; --danger:#ff8a8a; --ok:#25d07f;
}
*{box-sizing:border-box}
body{margin:0;background:radial-gradient(1200px 600px at 70% -10%, #142036 0%, transparent 70%) no-repeat, var(--bg);
  color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"SF Pro Text",Inter,"PingFang SC","Noto Sans CJK SC","Microsoft YaHei",Arial,sans-serif}
a{color:var(--link);text-decoration:none}
header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg, rgba(10,15,22,.9), rgba(10,15,22,.6));backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
.wrap{max-width:1200px;margin:0 auto;padding:14px 16px}
h1{margin:0;font-size:22px}
.sub{color:var(--muted);font-size:13px;margin-top:4px}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
input[type="search"]{background:#0f1623;border:1px solid #263144;color:var(--text);border-radius:10px;padding:10px 12px;outline:none;width:280px}
button{background:linear-gradient(180deg,#507bff,#3a63f0);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer;box-shadow:0 8px 18px rgba(76,130,255,.25)}
button.secondary{background:#182235;border:1px solid #2a3852;box-shadow:none;color:#d5e4ff}
main{max-width:1200px;margin:0 auto;padding:18px 16px 40px}
.grid{display:grid;grid-template-columns: 2fr 1fr;gap:16px}
@media (max-width:1000px){.grid{grid-template-columns:1fr}}
.panel{background:linear-gradient(180deg,#0f1726,#0c1421);border:1px solid var(--line);border-radius:14px;padding:14px}
.panel h2{margin:0 0 12px 0;font-size:16px;display:flex;align-items:center;gap:8px}
.chip{display:inline-flex;gap:6px;align-items:center;background:var(--chip);color:#cfe0ff;border:1px solid #27334a;border-radius:999px;padding:3px 8px;font-size:12px}
.list{display:flex;flex-direction:column;gap:10px}
.item{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:start;background:#0c1421;border:1px solid #1b2436;border-radius:12px;padding:12px}
.item:hover{border-color:#2b3a58;background:#0f1827}
.rank{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;background:#19263b;color:#cfe0ff}
.item h3{margin:0;font-size:15px;line-height:1.4}
.meta{color:#a7b9cc;font-size:12px;display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
.badge{font-size:11px;border:1px solid #2a3852;border-radius:999px;padding:2px 6px;background:#141d2b}
.score{font-variant-numeric:tabular-nums}
.desc{color:#c6d3e2;font-size:13px;margin-top:8px}
.actions{display:flex;gap:8px;flex-wrap:wrap}
.toggle{background:#101a2b;border:1px solid #2b3a58;border-radius:999px;padding:4px 8px;color:#cfe0ff;font-size:12px;cursor:pointer}
.src-panel .item{grid-template-columns:1fr auto}
footer{color:#8aa0b4;font-size:12px;border-top:1px solid var(--line);padding:18px 16px 48px;max-width:1200px;margin:0 auto}
.skeleton{height:14px;width:100%;border-radius:6px;background:linear-gradient(90deg,#0f1622,#121b2c,#0f1622);background-size:200% 100%;animation:shine 1.4s linear infinite}
@keyframes shine{0%{background-position:200% 0}100%{background-position:-200% 0}}

.desc-cn{color:#d8e7ff;font-size:13px;margin-top:6px;border-left:3px solid #2a3a56;padding-left:10px}
.cn-tag{display:inline-block;margin-right:6px}
.trend-card{background:linear-gradient(180deg,#0d1626,#0a1220);border:1px solid #22304a;border-radius:14px;padding:14px}
.trend-card h3{margin:0 0 8px 0;font-size:15px}
.trend-list{margin:0;padding-left:18px;color:#cfe0ff}
.kpi{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0}
.kpi .badge{background:#0f1a2b}
.toggle-cn{margin-left:auto}


select{background:#0f1623;border:1px solid #263144;color:var(--text);border-radius:8px;padding:6px 8px;margin-left:6px}
input[type="number"]{width:70px;background:#0f1623;border:1px solid #263144;color:var(--text);border-radius:8px;padding:4px 6px;margin-left:6px}
input[type="checkbox"]{margin-left:6px;transform:scale(1.1)}

</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>åŠ å¯†æ–°é—» Â· çƒ­åº¦è‡ªåŠ¨æ’è¡Œ</h1>
    <div class="sub">æ¥æºï¼šCoinDesk / The Block / Cointelegraph / CryptoSlate / Decrypt Â· è‡ªåŠ¨æŒ‰â€œçƒ­åº¦åˆ†â€æ’åºï¼ˆæ—¶æ•ˆ + å¤šæºå…±è¯† + å…³é”®è¯æƒé‡ï¼‰</div>
    <div class="controls">
      <label class="chip">æ—¶é—´çª—å£ <select id="timewin"><option value="latest" selected>æœ€æ–°</option><option value="24h">è¿‘ 24 å°æ—¶</option><option value="48h">è¿‘ 48 å°æ—¶</option></select></label><label class="chip">ä¸­æ–‡æºè®¡å…¥çƒ­åº¦ <input id="cnInHot" type="checkbox"></label><label class="chip">ä¸­æ–‡æºæƒé‡ <input id="cnWeight" type="number" step="0.05" min="0" max="1" value="0"></label><label class="chip">Stablecoinæƒé‡ <input id="wStable" type="number" step="0.01" min="0" max="1" value="0.18"></label><label class="chip">TAOæƒé‡ <input id="wTAO" type="number" step="0.01" min="0" max="1" value="0.15"></label><label class="chip">DOGEæƒé‡ <input id="wDOGE" type="number" step="0.01" min="0" max="1" value="0.12"></label>
      <button id="toggleCN" class="secondary toggle-cn">ä¸­æ–‡æ‘˜è¦ï¼šå¼€å¯</button>
      <input id="q" type="search" placeholder="æœç´¢æ ‡é¢˜ / æ¥æº / å…³é”®è¯â€¦">
      <button id="refresh">ç«‹å³åˆ·æ–°</button>
      <button id="toggleAuto" class="secondary">è‡ªåŠ¨åˆ·æ–°ï¼šå¼€å¯</button>
      <span class="chip">æœ¬åœ°æ—¶é—´ <span id="now"></span></span>
    </div>
  </div>
</header>

<main>

  <section class="panel" id="trend" style="margin-bottom:20px">
    <h2>ğŸ“ˆ æ€»ä½“è¶‹åŠ¿ & 30 å¤©å±•æœ› <span class="chip" id="trendUpdated">ç”Ÿæˆä¸­â€¦</span></h2>
    <div id="trendBody">
      <div class="skeleton" style="height:18px"></div>
      <div class="skeleton" style="height:14px;width:80%"></div>
      <div class="skeleton" style="height:14px;width:60%"></div>
    </div>
  </section>

  <div class="grid">

    

    <section class="panel" id="hot">
      <h2>ğŸ”¥ çƒ­ç‚¹ Top 20 <span class="chip" id="hotUpdated">åŠ è½½ä¸­â€¦</span></h2>
      <div class="list" id="hotList">
        ${''.join('<div class="skeleton"></div>' for _ in range(8))}
      </div>
    </section>

    <section class="panel src-panel" id="bySource">
      <h2>ğŸ“° æŒ‰æ¥æºæµè§ˆ <span class="chip" id="srcUpdated">åŠ è½½ä¸­â€¦</span></h2>
      <div id="srcLists"></div>
    </section>
  </div>
</main>

<footer>
  æ³¨ï¼šæœ¬é¡µé€šè¿‡å®˜æ–¹/å…¬å¼€ RSS è·å–æ ‡é¢˜ä¸æ‘˜è¦ï¼Œæ— æ³•è·å–ä»˜è´¹å¢™åçš„å…¨æ–‡ï¼›â€œçƒ­åº¦åˆ†â€é‡‡ç”¨å¯å‘å¼ç®—æ³•ï¼š<span class="badge">æ—¶æ•ˆæ€§è¡°å‡</span> + <span class="badge">å¤šæºé‡å¤åº¦</span> + <span class="badge">å…³é”®è¯åŠ æƒ</span>ï¼ˆå¦‚ ETF / SEC / é»‘å®¢ / ç¨³å®šå¸ ç­‰ï¼‰ã€‚ä»…ä½œèµ„è®¯æ’åºå‚è€ƒã€‚
</footer>

<script>
const feeds = [
  // ä¸­æ–‡èµ„è®¯æºï¼ˆé»˜è®¤ä¸è®¡å…¥çƒ­åº¦ï¼Œå¯åˆ‡æ¢/è®¾ç½®æƒé‡ï¼‰
  { name: 'é‡‘è‰²è´¢ç»', home: 'https://www.jinse.com', url: 'https://www.jinse.com/rss', isCN:true },
  { name: 'å·´æ¯”ç‰¹',   home: 'https://www.8btc.com',  url: 'https://www.8btc.com/rss',  isCN:true },
  // è‹±æ–‡èµ„è®¯æº
  { name: "CoinDesk",      home: "https://www.coindesk.com",      url: "https://www.coindesk.com/arc/outboundfeeds/rss/?outputType=xml" },
  { name: "The Block",     home: "https://www.theblock.co",       url: "https://www.theblock.co/rss.xml" },
  { name: "Cointelegraph", home: "https://cointelegraph.com",     url: "https://cointelegraph.com/rss" },
  { name: "CryptoSlate",   home: "https://cryptoslate.com",       url: "https://cryptoslate.com/feed/" },
  { name: "Decrypt",       home: "https://decrypt.co",            url: "https://decrypt.co/feed" },
];

const KEYWORD_BOOSTS = [
  {re:/\b(SEC|ETF|approval|spot etf|lawsuit|settlement)\b/i, w:0.25},
  {re:/\b(hack|hacker|exploit|security breach|drain|rug)\b/i, w:0.25},
  {re:/\b(stablecoin|USDT|USDC|Tether|Circle)\b/i, w:0.18},
  {re:/\b(Bitcoin|BTC|Halving|Lightning)\b/i, w:0.12},
  {re:/\b(Ethereum|ETH|L2|rollup|staking)\b/i, w:0.12},
  {re:/\b(DeFi|DEX|TVL|airdrop)\b/i, w:0.1},
];

const MAX_PER_FEED = 12;
const HOT_LIMIT = 20;
let auto = true, autoTimer = null;

const hotList = document.getElementById('hotList');
const hotUpdated = document.getElementById('hotUpdated');
const srcUpdated = document.getElementById('srcUpdated');
const q = document.getElementById('q');
const nowEl = document.getElementById('now');
const btnRefresh = document.getElementById('refresh');
const btnAuto = document.getElementById('toggleAuto');
const srcLists = document.getElementById('srcLists');

function tickNow(){ nowEl.textContent = new Date().toLocaleString(); }
setInterval(tickNow, 1000); tickNow();

btnRefresh.addEventListener('click', refreshAll);
btnAuto.addEventListener('click', ()=>{
  auto = !auto;
  btnAuto.textContent = 'è‡ªåŠ¨åˆ·æ–°ï¼š' + (auto ? 'å¼€å¯' : 'å…³é—­');
  btnAuto.classList.toggle('secondary', !auto);
  if(auto) autoTimer = setInterval(refreshAll, 15*60*1000);
  else clearInterval(autoTimer);
});

q.addEventListener('input', ()=>{
  for (const el of document.querySelectorAll('[data-search]')){
    const hit = (el.dataset.search || '').includes(q.value.trim().toLowerCase());
    el.style.display = hit ? '' : 'none';
  }
});

function domainFrom(u){ try{ return new URL(u).hostname.replace(/^www\./,''); }catch(_){ return ''; } }
function strip(html){ const d = document.createElement('div'); d.innerHTML = html; return d.textContent || d.innerText || ''; }
function trunc(s, n=180){ if(!s) return ''; return s.length>n ? s.slice(0,n-1) + 'â€¦' : s; }

async function fetchWithFallbacks(url){
  try{
    const r = await fetch(url, {mode:'cors'});
    if(r.ok){ return { kind:'xml', text: await r.text() }; }
  }catch(e){}
  try{
    const r = await fetch('https://api.allorigins.win/raw?url='+encodeURIComponent(url));
    if(r.ok){ return { kind:'xml', text: await r.text() }; }
  }catch(e){}
  try{
    const r = await fetch('https://api.rss2json.com/v1/api.json?rss_url='+encodeURIComponent(url));
    if(r.ok){ return { kind:'json', json: await r.json() }; }
  }catch(e){}
  throw new Error('è·å–å¤±è´¥ï¼š'+url);
}

function parseXMLItems(xmlText){
  const dp = new DOMParser(); const doc = dp.parseFromString(xmlText, 'text/xml');
  let nodes = [...doc.querySelectorAll('item')]; if(nodes.length===0) nodes = [...doc.querySelectorAll('entry')];
  const items = nodes.map(n=>{
    const title = n.querySelector('title')?.textContent?.trim() || 'Untitled';
    const link = n.querySelector('link')?.getAttribute('href') || n.querySelector('link')?.textContent?.trim() || '#';
    const pubDate = n.querySelector('pubDate')?.textContent?.trim() || n.querySelector('updated')?.textContent?.trim() || n.querySelector('published')?.textContent?.trim() || '';
    const desc = n.querySelector('description')?.textContent || n.querySelector('content\\:encoded')?.textContent || '';
    return { title, link, pubDate, desc };
  });
  return items;
}
function parseJSONItems(j){
  return (j.items||[]).map(x=>({ title:x.title, link:x.link, pubDate:x.pubDate||x.published||'', desc:x.description||'' }));
}

function scoreItem(it, appearances=1){
  const KEYWORD_BOOSTS = getKeywordBoosts();
  // recency
  let recency = 0;
  if(it.pubDate){
    const ageMs = Date.now() - new Date(it.pubDate).getTime();
    const ageH = Math.max(0, ageMs/3600000);
    recency = Math.exp(-ageH/24); // 24h åŠè¡°
  }
  // keywords
  const text = (it.title + ' ' + (it.desc||'')).toLowerCase();
  let ksum = 0;
  for (const r of KEYWORD_BOOSTS){ if(r.re.test(text)) ksum += r.w; }
  // multi-source
  const multi = Math.min(1, 0.3 * Math.max(0, appearances-1));
  let score = 0.6*recency + ksum + multi + 0.1; // åŸºç¡€åˆ† 0.1
  if(it.isCN){ score = score * (CN_WEIGHT>0 ? (1+CN_WEIGHT) : 1); }

  return Math.round(score*100)/100;
}

function normalizeTitle(s){
  return s.toLowerCase()
    .replace(/[\|\-â€“â€”Â·â€¢:;,_()\[\]{}]/g,' ')
    .replace(/\s+/g,' ')
    .replace(/\b(crypto|cryptocurrency|breaking|update|news)\b/g,'')
    .trim();
}

async function refreshAll(){
  hotUpdated.textContent = 'æ›´æ–°ä¸­â€¦';
  srcUpdated.textContent = 'æ›´æ–°ä¸­â€¦';
  hotList.innerHTML = '<div class="skeleton"></div>'.repeat(8);
  srcLists.innerHTML = '';

  // 1) æ‹‰å–å„æº
  const allBySource = [];
  await Promise.all(feeds.map(async f=>{
    try{
      const res = await fetchWithFallbacks(f.url);
      let items = res.kind==='xml' ? parseXMLItems(res.text) : parseJSONItems(res.json);
      items = items.slice(0, MAX_PER_FEED).map(x=>({ ...x, source:f.name, home:f.home }));
      allBySource.push({ source:f.name, home:f.home, items });
    }catch(e){
      allBySource.push({ source:f.name, home:f.home, items:[{ title:'âŒ æ‹‰å–å¤±è´¥ï¼š'+e.message, link:f.home, pubDate:'', desc:'' }] });
    }
  }));

  // 2) ç»Ÿè®¡é‡å¤ï¼ˆæ ‡é¢˜å½’ä¸€åŒ–ï¼‰
  const bucket = new Map(); // key -> {item, appearances, sources:Set}
  for (const pkg of allBySource){
    for (const it of pkg.items){
      const key = normalizeTitle(it.title);
      if(!bucket.has(key)) bucket.set(key, { item: it, appearances:1, sources:new Set([it.source]) });
      else{
        const o = bucket.get(key);
        o.appearances += 1; o.sources.add(it.source);
        // é€‰æ›´è¿‘çš„ pubDate
        if(new Date(it.pubDate) > new Date(o.item.pubDate)) o.item = it;
      }
    }
  }

  // è¿‡æ»¤æ—¶é—´çª—å£
  for(const [key,obj] of bucket){
    if(obj.item && !inTimeWindow(obj.item.pubDate)) bucket.delete(key);
  }

  // 3) è®¡ç®—çƒ­åº¦åˆ†
  let hot = [];
  for (const [_, obj] of bucket){
    const isCN = !!obj.item.isCN || (obj.item.source && (obj.item.source.includes('é‡‘è‰²') || obj.item.source.includes('å·´æ¯”ç‰¹')));
    if(isCN && !CN_INCLUDE_IN_HOT){
      // è·³è¿‡è¿›å…¥ HOTï¼Œä½†ä»ä¼šåœ¨â€œæŒ‰æ¥æºâ€éƒ¨åˆ†å±•ç¤º
      continue;
    }

    const s = scoreItem(obj.item, obj.appearances);
    hot.push({ ...obj.item, appearances: obj.appearances, sources: [...obj.sources], score: s });
  }
  hot.sort((a,b)=> b.score - a.score);
  hot = hot.slice(0, HOT_LIMIT);

  // 4) æ¸²æŸ“ HOT
  hotList.innerHTML = hot.map((it, idx)=>{
    const dom = domainFrom(it.link) || it.source;
    const time = it.pubDate ? new Date(it.pubDate).toLocaleString() : '';
    const search = (it.title + ' ' + dom + ' ' + it.source).toLowerCase();
    const excerpt = trunc(strip(it.desc||''), 220);
    return `
      <article class="item" data-search="${search}">
        <div class="rank">${idx+1}</div>
        <div>
          <h3><a href="${it.link}" target="_blank" rel="noopener">${it.title}</a></h3>
          <div class="meta">
            <span class="badge">æ¥æºï¼š${it.source}${it.appearances>1?` Â· ${it.appearances}æºå…±è¯†`:''}</span>
            ${time?`<span class="badge">${time}</span>`:''}
            <span class="badge score">çƒ­åº¦åˆ†ï¼š${it.score.toFixed(2)}</span>
          </div>
          ${excerpt?`<div class="desc">${excerpt}</div>`:''}
          ${renderCnBlock(it)}
          <div class="actions">
            <a class="chip" href="${it.link}" target="_blank" rel="noopener">é˜…è¯»å…¨æ–‡ â†’</a>
            <a class="chip" href="${feeds.find(f=>f.name===it.source)?.home||'#'}" target="_blank" rel="noopener">è®¿é—® ${it.source}</a>
          </div>
        </div>
        <div><span class="chip">${dom}</span></div>
      </article>
    `;
  }).join('');
  hotUpdated.textContent = 'æ›´æ–°å®Œæˆ Â· ' + new Date().toLocaleTimeString();
  document.getElementById('trendBody').innerHTML = buildTrends(hot);
  document.getElementById('trendUpdated').textContent = 'å·²ç”Ÿæˆ';

  // 5) æ¸²æŸ“åˆ†æ¥æº
  srcLists.innerHTML = allBySource.map(pkg=>{
    const list = pkg.items.map(it=>{
      const t = it.pubDate ? new Date(it.pubDate).toLocaleString() : '';
      const ex = trunc(strip(it.desc||''), 120);
      const s = scoreItem(it, 1);
      const search = (it.title + ' ' + pkg.source + ' ' + (it.link||'')).toLowerCase();
      return `
        <div class="item" data-search="${search}">
          <div>
            <h3><a href="${it.link}" target="_blank" rel="noopener">${it.title}</a></h3>
            <div class="meta">
              ${t?`<span class="badge">${t}</span>`:''}
              <span class="badge score">çƒ­åº¦åˆ†ï¼š${isNaN(s)?'--':s.toFixed(2)}</span>
            </div>
            ${ex?`<div class="desc">${ex}</div>`:''}
            ${renderCnBlock(it)}
          </div>
          <div><a class="chip" href="${pkg.home}" target="_blank" rel="noopener">ä¸»é¡µ</a></div>
        </div>
      `;
    }).join('');
    return `
      <div class="panel" style="margin-bottom:12px">
        <h2>${pkg.source}</h2>
        <div class="list">${list}</div>
      </div>
    `;
  }).join('');

  // åº”ç”¨æœç´¢è¿‡æ»¤ï¼ˆè‹¥æœ‰å…³é”®å­—ï¼‰
  q.dispatchEvent(new Event('input'));
}


// ===== CN SUMMARY & CONCLUSION =====
let showCN = true;
const btnCN = document.getElementById('toggleCN');
if(btnCN){
  btnCN.addEventListener('click', ()=>{
    showCN = !showCN;
    btnCN.textContent = 'ä¸­æ–‡æ‘˜è¦ï¼š' + (showCN ? 'å¼€å¯' : 'å…³é—­');
    for(const el of document.querySelectorAll('.desc-cn')){
      el.style.display = showCN ? '' : 'none';
    }
  });
}

function classifyCategory(text){
  const t = text.toLowerCase();
  if(/(hack|drain|exploit|security breach|attack)/i.test(t)) return 'å®‰å…¨äº‹ä»¶';
  if(/(etf|sec|approval|lawsuit|regulat|policy|congress)/i.test(t)) return 'ç›‘ç®¡/ETF';
  if(/(stablecoin|usdt|usdc|tether|circle)/i.test(t)) return 'ç¨³å®šå¸';
  if(/(airdrop|tvl|defi|dex|staking|l2|rollup)/i.test(t)) return 'DeFi/ç”Ÿæ€';
  if(/(bitcoin|btc|halving|lightning)/i.test(t)) return 'æ¯”ç‰¹å¸';
  if(/(ethereum|eth)/i.test(t)) return 'ä»¥å¤ªåŠ';
  return 'å…¶ä»–';
}

function cnSummary(it){
  const title = it.title || '';
  const desc = (it.desc || '').replace(/\s+/g,' ').trim();
  const cat = classifyCategory(title + ' ' + desc);
  const time = it.pubDate ? new Date(it.pubDate).toLocaleString() : '';
  // ç”Ÿæˆä¸€å¥è¯ä¸­æ–‡æ‘˜è¦ï¼ˆåŸºäºå…³é”®è¯å¯å‘ï¼‰
  let point = '';
  if(cat==='ç›‘ç®¡/ETF'){
    if(/etf/i.test(title+desc)) point = 'ETF ç›¸å…³è¿›å±•å¢å¼ºäº†æœºæ„å‚ä¸é¢„æœŸï¼Œæˆ–æå‡å¸‚åœºé£é™©åå¥½ã€‚';
    else if(/sec|policy|law|congress|approval|lawsuit/i.test(title+desc)) point = 'ç›‘ç®¡åŠ¨æ€å¸¦æ¥ä¸ç¡®å®šä¸è¾¹é™…æ˜æœ—å¹¶å­˜ï¼ŒçŸ­æœŸæ³¢åŠ¨å¯èƒ½åŠ å¤§ã€‚';
    else point = 'ç›‘ç®¡ç›¸å…³æ¶ˆæ¯å¯èƒ½æ”¹å˜èµ„é‡‘è¿›å‡ºèŠ‚å¥ä¸ä¼°å€¼æ¡†æ¶ã€‚';
  }else if(cat==='å®‰å…¨äº‹ä»¶'){
    point = 'å®‰å…¨äº‹ä»¶æç¤ºé“¾ä¸Šé£é™©ï¼ŒçŸ­æœŸæˆ–å‹åˆ¶æƒ…ç»ªä¸æµåŠ¨æ€§ï¼Œåˆ©å¥½å®‰å…¨èµ›é“ä¸è“ç­¹èµ„äº§é¿é™©å±æ€§ã€‚';
  }else if(cat==='ç¨³å®šå¸'){
    point = 'ç¨³å®šå¸ç›¸å…³è¿›å±•å½±å“æ•´ä½“æµåŠ¨æ€§ä¸åšå¸‚æ¡ä»¶ï¼Œæ˜¯åˆ¤æ–­èµ„é‡‘é¢ä¸é£é™©åå¥½çš„å…³é”®å˜é‡ã€‚';
  }else if(cat==='æ¯”ç‰¹å¸'){
    point = 'æ¯”ç‰¹å¸ä½œä¸ºé£å‘æ ‡ï¼Œå…¶èµ°åŠ¿å¸¸å¼•é¢†å…¨ç›˜ï¼›æ¶ˆæ¯æˆ–å½±å“ä¸­çŸ­æœŸæ–¹å‘ä¸èµ„é‡‘é£é™©åå¥½ã€‚';
  }else if(cat==='ä»¥å¤ªåŠ'){
    point = 'ä»¥å¤ªåŠç”Ÿæ€æ¶ˆæ¯å¯èƒ½å½±å“ L2ã€è´¨æŠ¼ä¸ DeFi æ¿å—è¡¨ç°ï¼Œç»“æ„æ€§æœºä¼šå¢å¤šã€‚';
  }else if(cat==='DeFi/ç”Ÿæ€'){
    point = 'ç”Ÿæ€ä¸åº”ç”¨å±‚é¢çš„è¿›å±•å¼ºåŒ–åŸºæœ¬é¢å™äº‹ï¼Œåˆ©äºæ´»è·ƒåº¦ä¸ä¼°å€¼ä¿®å¤ã€‚';
  }else{
    point = 'è¯¥æ¶ˆæ¯å¯¹å¸‚åœºçš„å½±å“éœ€ç»“åˆåç»­è·Ÿè¸ªä¸å¤šæºéªŒè¯ç»¼åˆåˆ¤æ–­ã€‚';
  }
  // ç»“è®ºï¼ˆå¯æ“ä½œå±‚é¢æç¤ºï¼‰
  let concl = '';
  if(cat==='ç›‘ç®¡/ETF'){
    concl = 'ç»“è®ºï¼šè·Ÿè¸ªå®˜æ–¹æ–‡ä»¶ä¸ ETF ç”³æŠ¥èŠ‚å¥ï¼›è‹¥è½åœ°æ¨è¿›ï¼Œé€¢å›è°ƒå…³æ³¨ä¸»æµèµ„äº§ä¸ç›¸å…³å—ç›Šæ¿å—ã€‚';
  }else if(cat==='å®‰å…¨äº‹ä»¶'){
    concl = 'ç»“è®ºï¼šçŸ­æœŸæ§åˆ¶æ æ†ã€è­¦æƒ•å‡æ¶ˆæ¯ï¼›ä»½é¢ä¸Šåå‘é«˜æµåŠ¨æ€§èµ„äº§ï¼Œå…³æ³¨å®‰å…¨åŸºç¡€è®¾æ–½æ ‡çš„ã€‚';
  }else if(cat==='ç¨³å®šå¸'){
    concl = 'ç»“è®ºï¼šç•™æ„äº¤æ˜“æ‰€ç¨³å®šå¸å‡€æµå…¥/æµå‡ºä¸å‚¨å¤‡å˜åŠ¨ï¼Œä½œä¸ºé£é™©åå¥½çš„å…ˆè¡ŒæŒ‡æ ‡ã€‚';
  }else if(cat==='æ¯”ç‰¹å¸'){
    concl = 'ç»“è®ºï¼šç»“åˆèµ„é‡‘å‡€æµã€æœŸè´§æ æ†ä¸é“¾ä¸Šæ´»è·ƒåº¦åˆ¤æ–­èŠ‚å¥ï¼›ä¸­æ¢ä»å–å†³äºå®è§‚ä¸ç›‘ç®¡ã€‚';
  }else if(cat==='ä»¥å¤ªåŠ'){
    concl = 'ç»“è®ºï¼šè·Ÿè¸ªè´¨æŠ¼ä¸ L2 æ•°æ®ä»¥åŠæ½œåœ¨ ETF åŠ¨å‘ï¼›åˆ†é…ä¸Šæ³¨æ„ä¸ BTC çš„è½®åŠ¨èŠ‚å¥ã€‚';
  }else if(cat==='DeFi/ç”Ÿæ€'){
    concl = 'ç»“è®ºï¼šé‡è§†çœŸå®ç”¨ä¾‹ä¸ç°é‡‘æµæ•°æ®ï¼›äº‹ä»¶é©±åŠ¨å‚ä¸ï¼Œé¿å…è¿½é«˜ã€‚';
  }else{
    concl = 'ç»“è®ºï¼šç»´æŒè§‚å¯Ÿï¼Œç­‰å¾…å¤šæºç¡®è®¤åå†è¯„ä¼°äº¤æ˜“ä»·å€¼ã€‚';
  }
  return {cat, point, concl, time};
}

function renderCnBlock(it){
  const s = cnSummary(it);
  return `<div class="desc-cn" style="${showCN?'':'display:none'}">
    <span class="badge cn-tag">ç±»åˆ«ï¼š${s.cat}</span>
    <span class="badge">${s.time || ''}</span>
    <div style="margin-top:6px">${s.point}</div>
    <div class="muted" style="margin-top:4px">${s.concl}</div>
  </div>`;
}


// ===== Runtime controls for window & weights =====
const selTime = document.getElementById('timewin');
const chkCnInHot = document.getElementById('cnInHot');
const inpCnWeight = document.getElementById('cnWeight');
const wStable = document.getElementById('wStable');
const wTAO = document.getElementById('wTAO');
const wDOGE = document.getElementById('wDOGE');

// default: CN not counted (weight 0)
let CN_INCLUDE_IN_HOT = false;
let CN_WEIGHT = 0.0;

function getKeywordBoosts(){
  const wStableV = parseFloat(wStable.value||'0.18') || 0;
  const wTAOV = parseFloat(wTAO.value||'0.15') || 0;
  const wDOGEV = parseFloat(wDOGE.value||'0.12') || 0;
  return [
    {re:/\b(SEC|ETF|approval|spot etf|lawsuit|settlement)\b/i, w:0.25},
    {re:/\b(hack|hacker|exploit|security breach|drain|rug)\b/i, w:0.25},
    {re:/\b(stablecoin|USDT|USDC|Tether|Circle)\b/i, w:wStableV},
    {re:/\b(TAO|Bittensor)\b/i, w:wTAOV},
    {re:/\b(DOGE|Dogecoin)\b/i, w:wDOGEV},
    {re:/\b(Bitcoin|BTC|Halving|Lightning)\b/i, w:0.12},
    {re:/\b(Ethereum|ETH|L2|rollup|staking)\b/i, w:0.12},
    {re:/\b(DeFi|DEX|TVL|airdrop)\b/i, w:0.1},
  ];
}

// time window helper
function inTimeWindow(pubDate){
  if(!pubDate) return true;
  const mode = selTime.value || 'latest';
  if(mode==='latest') return true;
  const ageMs = Date.now() - new Date(pubDate).getTime();
  const limit = (mode==='24h') ? 24*3600000 : 48*3600000;
  return ageMs <= limit;
}

chkCnInHot.addEventListener('change', ()=>{
  CN_INCLUDE_IN_HOT = chkCnInHot.checked;
  refreshAll();
});
inpCnWeight.addEventListener('input', ()=>{
  CN_WEIGHT = Math.max(0, Math.min(1, parseFloat(inpCnWeight.value||'0')||0));
});
wStable.addEventListener('input', ()=> refreshAll());
wTAO.addEventListener('input', ()=> refreshAll());
wDOGE.addEventListener('input', ()=> refreshAll());
selTime.addEventListener('change', ()=> refreshAll());

// ===== TRENDS PANEL =====
function buildTrends(hot){
  const counts = { 'ç›‘ç®¡/ETF':0, 'å®‰å…¨äº‹ä»¶':0, 'ç¨³å®šå¸':0, 'æ¯”ç‰¹å¸':0, 'ä»¥å¤ªåŠ':0, 'DeFi/ç”Ÿæ€':0, 'å…¶ä»–':0 };
  let newestTs = 0;
  for(const it of hot){
    const cat = classifyCategory((it.title||'') + ' ' + (it.desc||''));
    counts[cat] = (counts[cat]||0) + 1;
    const ts = it.pubDate ? new Date(it.pubDate).getTime() : 0;
    if(ts > newestTs) newestTs = ts;
  }
  const focus = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,3);
  const dateStr = newestTs? new Date(newestTs).toLocaleString() : '';

  const bullets = [];
  if(counts['ç›‘ç®¡/ETF']>0) bullets.push('ç›‘ç®¡/ETF ç›¸å…³æ¶ˆæ¯å æ¯”æå‡ï¼Œæœºæ„åŒ–ä¸åˆè§„åŒ–è¿›ç¨‹æˆ–ç»§ç»­æ¨åŠ¨å¢é‡èµ„é‡‘ã€‚');
  if(counts['å®‰å…¨äº‹ä»¶']>0) bullets.push('å®‰å…¨äº‹ä»¶é¢‘å‘ï¼ŒçŸ­çº¿éœ€å…³æ³¨äº¤æ˜“æ‰€ä¸é“¾ä¸Šå¼‚å¸¸æµå‘ï¼Œæ§åˆ¶æ æ†ã€‚');
  if(counts['ç¨³å®šå¸']>0) bullets.push('ç¨³å®šå¸æˆä¸ºèµ„é‡‘é¢â€œæ™´é›¨è¡¨â€ï¼Œå‡€æµé‡å˜åŒ–å°†å…ˆäºä»·æ ¼ååº”ã€‚');
  if(counts['æ¯”ç‰¹å¸']>0) bullets.push('æ¯”ç‰¹å¸ä»æ˜¯é£å‘æ ‡ï¼Œæ˜“ä¸ç›‘ç®¡/ETFå™äº‹å…±æŒ¯ï¼Œæ³¨æ„ä¸å±±å¯¨å¸çš„èŠ‚å¥åˆ‡æ¢ã€‚');
  if(counts['ä»¥å¤ªåŠ']>0) bullets.push('ä»¥å¤ªåŠä¸ L2/è´¨æŠ¼å™äº‹å‡æ¸©ï¼Œç»“æ„æ€§æœºä¼šå¢å¤šã€‚');
  if(bullets.length===0) bullets.push('å¸‚åœºä¸»é¢˜åˆ†æ•£ï¼Œå»ºè®®ä»¥é£æ§ä¸ºå…ˆï¼Œè·Ÿè¸ªæƒå¨æºçš„ç¡®è®¤ä¿¡æ¯ã€‚');

  const outlook = [];
  outlook.push('30 å¤©å±•æœ›ï¼š');
  if(counts['ç›‘ç®¡/ETF']>=counts['å®‰å…¨äº‹ä»¶']) {
    outlook.push('è‹¥ç›‘ç®¡ä¸ ETF è¿›å±•é¡ºåˆ©ï¼Œä¸»æµèµ„äº§ç»´æŒåå¼ºéœ‡è¡ï¼Œé€¢å›è°ƒå…³æ³¨ BTC/ETHã€‚');
  } else {
    outlook.push('è‹¥å®‰å…¨äº‹ä»¶å‘é…µæˆ–å®è§‚æ³¢åŠ¨ä¸Šè¡Œï¼ŒçŸ­æœŸé˜²å®ˆä¼˜å…ˆï¼Œé«˜æµåŠ¨æ€§ä¸å¯¹å†²ç­–ç•¥å ä¼˜ã€‚');
  }
  outlook.push('å…³æ³¨ç¨³å®šå¸å‡€æµå…¥/æµå‡ºä¸äº¤æ˜“æ‰€å‚¨å¤‡ä½œä¸ºå…ˆè¡ŒæŒ‡æ ‡ï¼›äº‹ä»¶é©±åŠ¨ä¸‹åšå¥½ä»“ä½åˆ†å±‚ã€‚');

  const kpi = `
    <div class="kpi">
      ${focus.map(([k,v])=>`<span class="badge">${k}ï¼š${v} æ¡</span>`).join('')}
      <span class="badge">æœ€æ–°æ—¶é—´ï¼š${dateStr||'â€”'}</span>
    </div>`;

  return `
    <div class="trend-card">
      <h3>è¦ç‚¹</h3>
      ${kpi}
      <ul class="trend-list">
        ${bullets.map(x=>`<li>${x}</li>`).join('')}
      </ul>
      <h3 style="margin-top:10px">é¢„æµ‹</h3>
      <ul class="trend-list">
        ${outlook.map(x=>`<li>${x}</li>`).join('')}
      </ul>
    </div>
  `;
}

// åˆå§‹ä¸è‡ªåŠ¨åˆ·æ–°
refreshAll();
autoTimer = setInterval(refreshAll, 15*60*1000);
</script>
</body>
</html>
