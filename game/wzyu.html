<!DOCTYPE html>

<html lang="zh-CN">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>机场安全毒药挑战 - 卡通版</title>

    <style>

        :root {

            --primary-color: #42a5f5;

            --secondary-color: #1976d2;

            --danger-color: #ef5350;

            --success-color: #66bb6a;

            --warning-color: #ffa726;

            --light-color: #f5f5f5;

            --dark-color: #212121;

            --player1-color: #4caf50;

            --player2-color: #ff5722;

        }

        * {

            box-sizing: border-box;

            margin: 0;

            padding: 0;

        }

        body {

            font-family: 'Comic Sans MS', 'Microsoft YaHei', sans-serif;

            background-color: #e3f2fd;

            color: var(--dark-color);

            line-height: 1.6;

            padding: 20px;

            background-image: url('https://img.freepik.com/free-vector/hand-drawn-airport-background_23-2149430436.jpg');

            background-size: cover;

            background-attachment: fixed;

        }

        .container {

            max-width: 600px;

            margin: 0 auto;

            background-color: rgba(255, 255, 255, 0.9);

            border-radius: 15px;

            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);

            overflow: hidden;

            backdrop-filter: blur(5px);

            border: 3px solid var(--primary-color);

        }

        header {

            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));

            color: white;

            padding: 20px;

            text-align: center;

            border-bottom: 5px dotted white;

        }

        h1 {

            font-size: 1.8rem;

            margin-bottom: 10px;

            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);

        }

        .game-phase {

            display: none;

            padding: 20px;

            min-height: 400px;

        }

        .active-phase {

            display: block;

        }

        /* 设置阶段样式 */

        .setup-container {

            display: flex;

            flex-direction: column;

            align-items: center;

        }

        .player-setup {

            width: 100%;

            max-width: 400px;

            margin-bottom: 20px;

            background-color: var(--light-color);

            padding: 15px;

            border-radius: 12px;

            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);

            border: 2px dashed var(--primary-color);

        }

        .player-title {

            text-align: center;

            margin-bottom: 15px;

            color: var(--secondary-color);

            font-weight: bold;

            font-size: 1.3rem;

            background-color: white;

            padding: 8px;

            border-radius: 20px;

            border: 2px solid var(--primary-color);

        }

        .poison-select {

            width: 100%;

            padding: 10px;

            border-radius: 8px;

            border: 2px solid var(--primary-color);

            margin-bottom: 15px;

            font-family: inherit;

            background-color: white;

        }

        .grid-container {

            display: grid;

            grid-template-columns: repeat(4, 1fr);

            gap: 8px;

            margin-top: 15px;

        }

        .grid-item {

            aspect-ratio: 1;

            background-color: #e1f5fe;

            border-radius: 10px;

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: center;

            cursor: pointer;

            transition: all 0.3s;

            font-size: 0.8rem;

            text-align: center;

            padding: 5px;

            overflow: hidden;

            border: 2px solid #b3e5fc;

            position: relative;

        }

        .grid-item:hover {

            background-color: #b3e5fc;

            transform: scale(1.05);

            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);

        }

        .food-emoji {

            font-size: 1.8rem;

            margin-bottom: 5px;

        }

        .selected-poison {

            background-color: var(--danger-color);

            color: white;

            border-color: #c62828;

            animation: pulse 1s infinite;

        }

        .selected-poison .food-emoji {

            transform: scale(1.2);

        }

        .poison-label {

            position: absolute;

            bottom: 2px;

            font-size: 0.6rem;

            font-weight: bold;

            background-color: white;

            color: var(--danger-color);

            padding: 2px 4px;

            border-radius: 4px;

        }

        /* 挑战阶段样式 */

        .question-container {

            background-color: var(--light-color);

            padding: 20px;

            border-radius: 12px;

            margin-bottom: 20px;

            border: 2px solid var(--primary-color);

        }

        .question-text {

            font-size: 1.1rem;

            margin-bottom: 15px;

            font-weight: bold;

            color: var(--dark-color);

            background-color: white;

            padding: 10px;

            border-radius: 10px;

            border-left: 5px solid var(--primary-color);

        }

        .options-container {

            display: grid;

            grid-template-columns: 1fr;

            gap: 10px;

        }

        .option {

            padding: 12px;

            background-color: white;

            border: 2px solid #ddd;

            border-radius: 8px;

            cursor: pointer;

            transition: all 0.2s;

            text-align: center;

        }

        .option:hover {

            background-color: #e1f5fe;

            border-color: var(--primary-color);

            transform: translateY(-3px);

        }

        .correct {

            background-color: var(--success-color);

            color: white;

            border-color: var(--success-color);

            animation: bounce 0.5s;

        }

        .incorrect {

            background-color: var(--danger-color);

            color: white;

            border-color: var(--danger-color);

            animation: shake 0.5s;

        }

        /* 选择阶段样式 */

        .selection-instruction {

            text-align: center;

            margin-bottom: 15px;

            font-size: 1.1rem;

            background-color: white;

            padding: 10px;

            border-radius: 20px;

            border: 2px solid var(--primary-color);

        }

        .selection-grid {

            display: grid;

            grid-template-columns: repeat(4, 1fr);

            gap: 8px;

            margin: 20px auto;

            max-width: 400px;

        }

        .selection-item {

            aspect-ratio: 1;

            background-color: #e1f5fe;

            border-radius: 10px;

            display: flex;

            flex-direction: column;

            align-items: center;

            justify-content: center;

            cursor: pointer;

            transition: all 0.3s;

            position: relative;

            overflow: hidden;

            border: 2px solid #b3e5fc;

        }

        .selection-item:hover {

            background-color: #b3e5fc;

            transform: scale(1.05);

            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);

        }

        .selected-by-player1 {

            background-color: rgba(76, 175, 80, 0.3);

            border-color: var(--player1-color);

        }

        .selected-by-player2 {

            background-color: rgba(255, 87, 34, 0.3);

            border-color: var(--player2-color);

        }

        .player-marker {

            position: absolute;

            top: 2px;

            right: 2px;

            font-size: 0.7rem;

            font-weight: bold;

            padding: 2px 4px;

            border-radius: 4px;

        }

        .player1-marker {

            background-color: var(--player1-color);

            color: white;

        }

        .player2-marker {

            background-color: var(--player2-color);

            color: white;

        }

        .poison-icon {

            position: absolute;

            width: 24px;

            height: 24px;

            background-color: var(--danger-color);

            border-radius: 50%;

            display: flex;

            align-items: center;

            justify-content: center;

            color: white;

            font-weight: bold;

            opacity: 0;

            transition: opacity 0.3s;

            bottom: 5px;

            right: 5px;

            font-size: 1rem;

        }

        .revealed .poison-icon {

            opacity: 1;

            animation: pulse 1s infinite;

        }

        /* 计分板样式 */

        .score-board {

            display: flex;

            justify-content: space-around;

            margin-bottom: 20px;

            flex-wrap: wrap;

        }

        .player-score {

            text-align: center;

            padding: 10px 15px;

            background-color: white;

            border-radius: 15px;

            min-width: 120px;

            margin: 5px;

            border: 2px solid #ddd;

            transition: all 0.3s;

        }

        .current-player {

            border-color: var(--primary-color);

            box-shadow: 0 0 10px rgba(66, 165, 245, 0.5);

            transform: scale(1.05);

        }

        .player1-score {

            border-color: var(--player1-color);

        }

        .player2-score {

            border-color: var(--player2-color);

        }

        .score-value {

            font-size: 1.3rem;

            font-weight: bold;

            color: var(--primary-color);

        }

        /* 游戏结束样式 */

        .game-over {

            text-align: center;

            padding: 20px;

        }

        .game-over h2 {

            font-size: 1.8rem;

            margin-bottom: 15px;

            color: var(--primary-color);

            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);

        }

        .winner-message {

            font-size: 1.3rem;

            margin-bottom: 15px;

            padding: 12px;

            border-radius: 15px;

            background-color: white;

            border: 3px solid var(--success-color);

            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);

        }

        .final-scores {

            background-color: var(--light-color);

            padding: 12px;

            border-radius: 10px;

            margin: 12px 0;

            border-left: 5px solid var(--primary-color);

        }

        .violation-detail {

            background-color: var(--light-color);

            padding: 12px;

            border-radius: 10px;

            margin: 12px 0;

            border-left: 5px solid var(--danger-color);

        }

        .leaderboard {

            background-color: var(--light-color);

            padding: 12px;

            border-radius: 10px;

            margin: 12px 0;

            border-left: 5px solid var(--warning-color);

        }

        .leaderboard h3 {

            margin-bottom: 10px;

            color: var(--secondary-color);

        }

        .leaderboard ol {

            text-align: left;

            padding-left: 20px;

        }

        .leaderboard li {

            margin-bottom: 5px;

        }

        /* 按钮样式 */

        .btn {

            padding: 10px 20px;

            border: none;

            border-radius: 30px;

            background-color: var(--primary-color);

            color: white;

            font-size: 1rem;

            cursor: pointer;

            transition: all 0.3s;

            margin: 8px;

            font-family: inherit;

            font-weight: bold;

            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);

        }

        .btn:hover {

            background-color: var(--secondary-color);

            transform: translateY(-3px);

            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);

        }

        .btn:active {

            transform: translateY(0);

        }

        .btn-danger {

            background-color: var(--danger-color);

        }

        .btn-success {

            background-color: var(--success-color);

        }

        .btn-warning {

            background-color: var(--warning-color);

        }

        .btn-block {

            display: block;

            width: 100%;

            max-width: 250px;

            margin: 12px auto;

        }

        .btn-container {

            display: flex;

            justify-content: center;

            margin-top: 15px;

            flex-wrap: wrap;

        }

        /* 动画 */

        @keyframes bounce {

            0%, 100% { transform: translateY(0); }

            50% { transform: translateY(-8px); }

        }

        @keyframes shake {

            0%, 100% { transform: translateX(0); }

            25% { transform: translateX(-5px); }

            75% { transform: translateX(5px); }

        }

        @keyframes pulse {

            0%, 100% { transform: scale(1); }

            50% { transform: scale(1.1); }

        }

        /* 响应式设计 */

        @media (max-width: 480px) {

            .container {

                max-width: 100%;

                border-radius: 0;

            }

            .grid-item, .selection-item {

                font-size: 0.7rem;

            }

            .food-emoji {

                font-size: 1.5rem;

            }

            .question-text {

                font-size: 1rem;

            }

            .option {

                padding: 10px;

                font-size: 0.9rem;

            }

        }

    </style>

</head>

<body>

    <div class="container">

        <header>

            <h1>机场安全毒药挑战</h1>

            <p>找出对手的毒药，学习机场安全知识！</p>

        </header>

 

        <!-- 设置阶段 -->

        <div id="setup-phase" class="game-phase active-phase">

            <h2>设置你的毒药</h2>

            <p>每位玩家需要从16种食物中选择一种作为自己的"毒药"，毒药对应一种机场安全违规行为。</p>

            

            <div class="setup-container">

                <div class="player-setup" id="player1-setup">

                    <div class="player-title">玩家1</div>

                    <select id="player1-poison-select" class="poison-select">

                        <option value="">-- 选择违规行为作为毒药 --</option>

                        <option value="0">未刷卡尾随通过门禁 (扣10-20分)</option>

                        <option value="1">未制止他人未验证通行 (扣10-20分)</option>

                        <option value="2">未及时锁闭通道门 (扣10-20分)</option>

                        <option value="3">擅自将廊桥作为通行路由 (扣15分)</option>

                        <option value="4">擅自进入廊桥及航空器 (扣10-15分)</option>

                        <option value="5">在航空器与接机人员间穿行 (扣5分)</option>

                        <option value="6">未有效引导旅客 (扣10分)</option>

                        <option value="7">廊桥作业期间进入活动端 (扣2分)</option>

                        <option value="8">未穿反光警示服装 (扣2分)</option>

                        <option value="9">夹带香烟等可燃物 (扣10-15分)</option>

                        <option value="10">在控制区内吸烟 (扣15分)</option>

                    </select>

                    <p>选择食物位置：</p>

                    <div class="grid-container" id="player1-grid">

                        <!-- 通过JS生成16个格子 -->

                    </div>

                    <div class="btn-container">

                        <button id="player1-confirm-btn" class="btn btn-success">确认选择</button>

                    </div>

                </div>

                

                <div class="player-setup" id="player2-setup" style="display: none;">

                    <div class="player-title">玩家2</div>

                    <select id="player2-poison-select" class="poison-select">

                        <option value="">-- 选择违规行为作为毒药 --</option>

                        <option value="0">未刷卡尾随通过门禁 (扣10-20分)</option>

                        <option value="1">未制止他人未验证通行 (扣10-20分)</option>

                        <option value="2">未及时锁闭通道门 (扣10-20分)</option>

                        <option value="3">擅自将廊桥作为通行路由 (扣15分)</option>

                        <option value="4">擅自进入廊桥及航空器 (扣10-15分)</option>

                        <option value="5">在航空器与接机人员间穿行 (扣5分)</option>

                        <option value="6">未有效引导旅客 (扣10分)</option>

                        <option value="7">廊桥作业期间进入活动端 (扣2分)</option>

                        <option value="8">未穿反光警示服装 (扣2分)</option>

                        <option value="9">夹带香烟等可燃物 (扣10-15分)</option>

                        <option value="10">在控制区内吸烟 (扣15分)</option>

                    </select>

                    <p>选择食物位置：</p>

                    <div class="grid-container" id="player2-grid">

                        <!-- 通过JS生成16个格子 -->

                    </div>

                    <div class="btn-container">

                        <button id="player2-confirm-btn" class="btn btn-success">确认选择</button>

                    </div>

                </div>

            </div>

        </div>

 

        <!-- 挑战阶段 -->

        <div id="challenge-phase" class="game-phase">

            <h2>安全知识挑战</h2>

            <p>回答正确的玩家可以从食物网格中选择一个格子，小心不要选到毒药！</p>

            

            <div class="score-board">

                <div id="player1-score" class="player-score player1-score current-player">

                    <div>玩家1</div>

                    <div class="score-value">0</div>

                </div>

                <div id="player2-score" class="player-score player2-score">

                    <div>玩家2</div>

                    <div class="score-value">0</div>

                </div>

            </div>

            

            <div class="question-container">

                <div class="question-text" id="question-text">问题加载中...</div>

                <div class="options-container" id="options-container">

                    <!-- 通过JS生成选项 -->

                </div>

            </div>

        </div>

 

        <!-- 选择阶段 -->

        <div id="selection-phase" class="game-phase">

            <h2>选择食物</h2>

            <div class="selection-instruction" id="selection-instruction">玩家1，请从下面的食物网格中选择一个：</div>

            

            <div class="selection-grid" id="selection-grid">

                <!-- 通过JS生成16个格子 -->

            </div>

            

            <div class="btn-container">

                <button id="back-to-challenge-btn" class="btn">返回挑战</button>

            </div>

        </div>

 

        <!-- 游戏结束 -->

        <div id="game-over-phase" class="game-phase">

            <div class="game-over">

                <h2>游戏结束</h2>

                <div class="winner-message" id="winner-message">玩家1获胜！</div>

                

                <div class="final-scores">

                    <h3>最终得分</h3>

                    <p>玩家1: <span id="final-score-player1">0</span> 分</p>

                    <p>玩家2: <span id="final-score-player2">0</span> 分</p>

                </div>

                

                <div class="violation-detail" id="game-result-detail">

                    玩家1成功发现了玩家2设置的毒药：<strong>未刷卡尾随通过门禁</strong>！

                    <p>违规行为：本人未刷卡验证，通行其他持证人验证打开的门禁通道的</p>

                    <p>处罚措施：尾随者有权限但未刷卡验证通行的，扣10分；无权限尾随通行的扣15分，造成后果的扣20分。</p>

                </div>

                

                <div class="leaderboard">

                    <h3>排行榜</h3>

                    <ol id="leaderboard-list">

                        <!-- 排行榜将通过JS动态生成 -->

                    </ol>

                </div>

                

                <div class="btn-container">

                    <button id="play-again-btn" class="btn btn-success">再玩一次</button>

                    <button id="new-game-btn" class="btn btn-primary">新游戏</button>

                </div>

            </div>

        </div>

    </div>

 

    <script>

        // 游戏数据

        const violations = [

            {

                violation: "未刷卡尾随通过门禁",

                description: "本人未刷卡验证，通行其他持证人验证打开的门禁通道的",

                penalty: "扣10-20分",

                details: "尾随者有权限但未刷卡验证通行的，扣10分；无权限尾随通行的扣15分，造成后果的扣20分。"

            },

            {

                violation: "未制止他人未验证通行",

                description: "在验证打开无人值守的门禁通道后，未及时制止他人未验证通行的",

                penalty: "扣10-20分",

                details: "处罚对象为刷卡人和未验证人员；未造成后果的扣10分，造成后果的视情节扣15至20分。"

            },

            {

                violation: "未及时锁闭通道门",

                description: "在验证打开无人值守的门禁通道后，不及时锁闭通道门的",

                penalty: "扣10-20分",

                details: "旅客上、下客结束后未及时锁闭廊桥门禁的，属于违规行为；未造成后果的扣10分，造成后果的视情节扣15至20分。"

            },

            {

                violation: "擅自将廊桥作为通行路由",

                description: "非航班保障期间，擅自将廊桥作为通行路由的",

                penalty: "扣15分",

                details: "维修、维保巡视、警务工作以及其他应急情况除外。"

            },

            {

                violation: "擅自进入廊桥及航空器",

                description: "航班保障期间，未经承运人或者地面代理人员同意，擅自进入廊桥及航空器的",

                penalty: "扣10-15分",

                details: "未经承运人允许，擅自进入与本单位生产保障作业无关的航空器，属于违规行为，视违规情节及造成后果扣10至15分。"

            },

            {

                violation: "在航空器与接机人员间穿行",

                description: "在航空器进入机位过程中，车辆、人员在航空器和接机人员（或目视泊位引导系统）之间穿行的",

                penalty: "扣5分",

                details: ""

            },

            {

                violation: "未有效引导旅客",

                description: "引导人员未对旅客进行有效引导或管控，造成旅客通行路线穿越航空器滑行路线的；或驾驶车辆横穿旅客队伍的",

                penalty: "扣10分",

                details: ""

            },

            {

                violation: "廊桥作业期间进入活动端",

                description: "廊桥作业期间进入廊桥活动端的",

                penalty: "扣2分",

                details: ""

            },

            {

                violation: "未穿反光警示服装",

                description: "在飞行区内活动时未按要求穿着反光警示服装的",

                penalty: "扣2分",

                details: "持一次性证件的人员在飞行区活动未穿着反光警示服装的，扣罚陪同引领人员。"

            },

            {

                violation: "夹带香烟等可燃物",

                description: "进入隔离区时，夹带、藏匿香烟等限制携带可燃易燃物品的",

                penalty: "扣10-15分",

                details: "夹带的，未造成其他不良后果的，扣10分；造成不良后果或藏匿的扣15分。"

            },

            {

                violation: "在控制区内吸烟",

                description: "在控制区内吸烟",

                penalty: "扣15分",

                details: ""

            }

        ];

 

        const questions = [

            {

                question: "当发现有人未刷卡尾随通过门禁时，正确的做法是？",

                options: [

                    "假装没看见，继续自己的工作",

                    "立即上前制止，要求其补刷卡",

                    "帮他刷卡，让他快速通过",

                    "向同事使眼色，让他下次注意"

                ],

                correct: 1,

                violationIndex: 0

            },

            {

                question: "在验证打开无人值守门禁后，发现有人试图未验证通行，你应该？",

                options: [

                    "不予理会，这不是我的责任",

                    "立即制止并要求其验证身份",

                    "快速通过避免被牵连",

                    "拍照留证但不报告"

                ],

                correct: 1,

                violationIndex: 1

            },

            {

                question: "航班保障结束后，关于廊桥门禁的正确操作是？",

                options: [

                    "保持开启状态以便下次使用",

                    "旅客离开后立即锁闭门禁",

                    "等待清洁人员完成工作后再关闭",

                    "由最后离开的工作人员负责关闭"

                ],

                correct: 1,

                violationIndex: 2

            },

            {

                question: "非航班保障期间，关于廊桥使用的规定是？",

                options: [

                    "可以作为便捷通道使用",

                    "严禁作为通行路由，特殊情况除外",

                    "只有管理人员可以使用",

                    "可以使用但需登记"

                ],

                correct: 1,

                violationIndex: 3

            },

            {

                question: "未经允许擅自进入航空器的处罚是？",

                options: [

                    "口头警告",

                    "扣5分",

                    "扣10-15分",

                    "直接开除"

                ],

                correct: 2,

                violationIndex: 4

            },

            {

                question: "在航空器滑行过程中，正确的行为是？",

                options: [

                    "快速穿过滑行道",

                    "等待航空器完全停稳",

                    "在接机人员与航空器之间穿行",

                    "跟随其他车辆通行"

                ],

                correct: 1,

                violationIndex: 5

            },

            {

                question: "引导旅客时的正确做法是？",

                options: [

                    "让旅客自由行动",

                    "确保旅客路线不穿越航空器滑行路线",

                    "驾驶车辆穿过旅客队伍",

                    "只在人多时进行引导"

                ],

                correct: 1,

                violationIndex: 6

            },

            {

                question: "廊桥作业期间是否可以进入活动端？",

                options: [

                    "可以，如果有紧急情况",

                    "可以，如果没人看见",

                    "严禁进入",

                    "可以，但需快速通过"

                ],

                correct: 2,

                violationIndex: 7

            },

            {

                question: "在飞行区活动时的着装要求是？",

                options: [

                    "随意穿着，舒适即可",

                    "必须穿着反光警示服装",

                    "只有夜间需要反光服",

                    "管理人员才需穿反光服"

                ],

                correct: 1,

                violationIndex: 8

            },

            {

                question: "发现旅客夹带香烟等可燃物品时，应该？",

                options: [

                    "视而不见",

                    "按规定没收并记录",

                    "让他藏好别被发现",

                    "自己买下来"

                ],

                correct: 1,

                violationIndex: 9

            },

            {

                question: "在控制区内吸烟的处罚是？",

                options: [

                    "警告",

                    "扣5分",

                    "扣15分",

                    "停职"

                ],

                correct: 2,

                violationIndex: 10

            },

            {

                question: "值机过程中应如何核对旅客信息？",

                options: [

                    "快速扫描即可",

                    "认真核对客票和乘机人身份证明",

                    "只核对姓名",

                    "让旅客自己确认"

                ],

                correct: 1,

                violationIndex: -1

            },

            {

                question: "空白登机牌和行李条应何时回收？",

                options: [

                    "不需要回收",

                    "航班结束后及时回收",

                    "每周回收一次",

                    "用完后随意放置"

                ],

                correct: 1,

                violationIndex: -1

            },

            {

                question: "登机流程的正确顺序是？",

                options: [

                    "先撕后扫",

                    "先扫后撕",

                    "同时进行",

                    "由旅客自行决定"

                ],

                correct: 1,

                violationIndex: -1

            },

            {

                question: "通过无人值守门禁的正确步骤是？",

                options: [

                    "直接通过",

                    "刷通行证→开门→关门→确认",

                    "刷卡后快速通过",

                    "等待他人开门"

                ],

                correct: 1,

                violationIndex: -1

            },

            {

                question: "关于锂电池运输的规定是？",

                options: [

                    "可以夹带在托运行李中",

                    "严禁在托运行李中夹带锂电池",

                    "少量锂电池可以托运",

                    "由旅客自行决定"

                ],

                correct: 1,

                violationIndex: -1

            }

        ];

 

        // 食物数据 - 确保每轮一致

        const foodItems = [

            { emoji: "��", name: "苹果" },

            { emoji: "��", name: "梨" },

            { emoji: "��", name: "橙子" },

            { emoji: "��", name: "柠檬" },

            { emoji: "��", name: "香蕉" },

            { emoji: "��", name: "西瓜" },

            { emoji: "��", name: "葡萄" },

            { emoji: "��", name: "草莓" },

            { emoji: "��", name: "蓝莓" },

            { emoji: "��", name: "哈密瓜" },

            { emoji: "��", name: "樱桃" },

            { emoji: "��", name: "桃子" },

            { emoji: "��", name: "芒果" },

            { emoji: "��", name: "菠萝" },

            { emoji: "��", name: "椰子" },

            { emoji: "��", name: "猕猴桃" }

        ];

 

        // 游戏状态

        let gameState = {

            phase: "setup", // setup, challenge, selection, gameOver

            currentPlayer: 1, // 1 or 2

            player1: {

                score: 0,

                poisonIndex: -1,

                poisonCell: -1,

                selectedCells: []

            },

            player2: {

                score: 0,

                poisonIndex: -1,

                poisonCell: -1,

                selectedCells: []

            },

            currentQuestion: null,

            isComputer: false,

            currentSetupPlayer: 1,

            usedQuestions: [],

            currentFoodItems: [],

            leaderboard: JSON.parse(localStorage.getItem('poisonGameLeaderboard')) || []

        };

 

        // DOM元素

        const setupPhase = document.getElementById("setup-phase");

        const challengePhase = document.getElementById("challenge-phase");

        const selectionPhase = document.getElementById("selection-phase");

        const gameOverPhase = document.getElementById("game-over-phase");

        const player1Setup = document.getElementById("player1-setup");

        const player2Setup = document.getElementById("player2-setup");

        const player1ConfirmBtn = document.getElementById("player1-confirm-btn");

        const player2ConfirmBtn = document.getElementById("player2-confirm-btn");

        const backToChallengeBtn = document.getElementById("back-to-challenge-btn");

        const playAgainBtn = document.getElementById("play-again-btn");

        const newGameBtn = document.getElementById("new-game-btn");

        const player1ScoreElement = document.getElementById("player1-score");

        const player2ScoreElement = document.getElementById("player2-score");

        const questionTextElement = document.getElementById("question-text");

        const optionsContainer = document.getElementById("options-container");

        const selectionInstruction = document.getElementById("selection-instruction");

        const selectionGrid = document.getElementById("selection-grid");

        const winnerMessage = document.getElementById("winner-message");

        const finalScorePlayer1 = document.getElementById("final-score-player1");

        const finalScorePlayer2 = document.getElementById("final-score-player2");

        const gameResultDetail = document.getElementById("game-result-detail");

        const leaderboardList = document.getElementById("leaderboard-list");

 

        // 初始化游戏网格

        function initializeGrids() {

            const player1Grid = document.getElementById("player1-grid");

            const player2Grid = document.getElementById("player2-grid");

            

            player1Grid.innerHTML = "";

            player2Grid.innerHTML = "";

            

            // 打乱食物顺序但保持一致性

            gameState.currentFoodItems = [...foodItems].sort(() => Math.random() - 0.5);

            

            // 生成16个格子 (4x4)

            for (let i = 0; i < 16; i++) {

                const food = gameState.currentFoodItems[i];

                const cell1 = createGridCell(i, food);

                player1Grid.appendChild(cell1);

                

                const cell2 = createGridCell(i, food);

                player2Grid.appendChild(cell2);

            }

        }

 

        // 创建网格单元格

        function createGridCell(index, food) {

            const cell = document.createElement("div");

            cell.className = "grid-item";

            cell.dataset.index = index;

            

            const emoji = document.createElement("div");

            emoji.className = "food-emoji";

            emoji.textContent = food.emoji;

            cell.appendChild(emoji);

            

            const foodName = document.createElement("div");

            foodName.textContent = food.name;

            cell.appendChild(foodName);

            

            return cell;

        }

 

        // 选择毒药格子

        function selectPoisonCell(player, cellIndex) {

            const poisonSelect = document.getElementById(`player${player}-poison-select`);

            if (poisonSelect.value === "") {

                alert("请先选择一种违规行为作为毒药");

                return;

            }

            

            // 清除之前的选择

            const grid = document.getElementById(`player${player}-grid`);

            const previouslySelected = grid.querySelector(".selected-poison");

            if (previouslySelected) {

                previouslySelected.classList.remove("selected-poison");

                previouslySelected.querySelector(".poison-label")?.remove();

            }

            

            // 标记新选择

            const selectedCell = grid.querySelector(`[data-index="${cellIndex}"]`);

            selectedCell.classList.add("selected-poison");

            

            // 添加毒药标签

            const poisonLabel = document.createElement("div");

            poisonLabel.className = "poison-label";

            poisonLabel.textContent = "毒药";

            selectedCell.appendChild(poisonLabel);

        }

 

        // 确认毒药选择

        function confirmPoisonSelection(player) {

            const poisonSelect = document.getElementById(`player${player}-poison-select`);

            const grid = document.getElementById(`player${player}-grid`);

            const selectedCell = grid.querySelector(".selected-poison");

            

            if (poisonSelect.value === "" || !selectedCell) {

                alert("请先选择违规行为和食物位置");

                return;

            }

            

            // 更新游戏状态

            if (player === 1) {

                gameState.player1.poisonIndex = parseInt(poisonSelect.value);

                gameState.player1.poisonCell = parseInt(selectedCell.dataset.index);

            } else {

                gameState.player2.poisonIndex = parseInt(poisonSelect.value);

                gameState.player2.poisonCell = parseInt(selectedCell.dataset.index);

            }

            

            // 切换到下一个玩家设置或开始游戏

            if (player === 1) {

                gameState.currentSetupPlayer = 2;

                player1Setup.style.display = "none";

                player2Setup.style.display = "block";

                initializeGrids(); // 重新初始化网格以清除玩家1的选择

            } else {

                startGame();

            }

        }

 

        // 开始游戏

        function startGame() {

            // 确认是否与电脑对战

            gameState.isComputer = confirm("是否与电脑对战？点击确定与电脑对战，取消与朋友对战");

            

            // 切换到挑战阶段

            changePhase("challenge");

            

            // 初始化选择网格

            initializeSelectionGrid();

            

            // 开始第一个问题

            nextQuestion();

        }

 

        // 初始化选择网格

        function initializeSelectionGrid() {

            selectionGrid.innerHTML = "";

            

            for (let i = 0; i < 16; i++) {

                const food = gameState.currentFoodItems[i];

                const cell = document.createElement("div");

                cell.className = "selection-item";

                cell.dataset.index = i;

                

                const emoji = document.createElement("div");

                emoji.className = "food-emoji";

                emoji.textContent = food.emoji;

                cell.appendChild(emoji);

                

                const foodName = document.createElement("div");

                foodName.textContent = food.name;

                cell.appendChild(foodName);

                

                // 添加毒药标记（但不显示）

                const poisonIcon = document.createElement("div");

                poisonIcon.className = "poison-icon";

                poisonIcon.textContent = "☠";

                cell.appendChild(poisonIcon);

                

                cell.addEventListener("click", () => selectCell(i));

                selectionGrid.appendChild(cell);

            }

        }

 

        // 切换到下一个问题

        function nextQuestion() {

            // 随机选择一个未使用的问题

            const unusedQuestions = questions.filter(q => !gameState.usedQuestions.includes(q.question));

            if (unusedQuestions.length === 0) {

                // 所有问题都用过了，重置

                gameState.usedQuestions = [];

                return nextQuestion();

            }

            

            const randomIndex = Math.floor(Math.random() * unusedQuestions.length);

            gameState.currentQuestion = unusedQuestions[randomIndex];

            

            // 记录已使用的问题

            gameState.usedQuestions.push(gameState.currentQuestion.question);

            

            // 更新UI

            questionTextElement.textContent = gameState.currentQuestion.question;

            optionsContainer.innerHTML = "";

            

            gameState.currentQuestion.options.forEach((option, index) => {

                const optionElement = document.createElement("div");

                optionElement.className = "option";

                optionElement.textContent = option;

                optionElement.dataset.index = index;

                optionElement.addEventListener("click", selectAnswer);

                optionsContainer.appendChild(optionElement);

            });

            

            // 更新当前玩家显示

            updateCurrentPlayerDisplay();

            

            // 如果是电脑回合且在选择阶段，延迟后自动选择

            if (gameState.isComputer && gameState.currentPlayer === 2 && gameState.phase === "selection") {

                setTimeout(computerSelectCell, 1500);

            }

        }

 

        // 选择答案

        function selectAnswer(e) {

            const selectedOption = e.target;

            const selectedIndex = parseInt(selectedOption.dataset.index);

            const isCorrect = selectedIndex === gameState.currentQuestion.correct;

            

            // 禁用所有选项

            const options = optionsContainer.querySelectorAll(".option");

            options.forEach(option => {

                option.style.pointerEvents = "none";

                if (parseInt(option.dataset.index) === gameState.currentQuestion.correct) {

                    option.classList.add("correct");

                } else if (option === selectedOption) {

                    option.classList.add("incorrect");

                }

            });

            

            // 更新分数

            if (isCorrect) {

                if (gameState.currentPlayer === 1) {

                    gameState.player1.score += 5;

                } else {

                    gameState.player2.score += 5;

                }

                

                setTimeout(() => {

                    changePhase("selection");

                    selectionInstruction.textContent = `玩家${gameState.currentPlayer}，请从下面的食物网格中选择一个：`;

                    

                    // 如果是电脑回合，延迟后自动选择

                    if (gameState.isComputer && gameState.currentPlayer === 2) {

                        setTimeout(computerSelectCell, 1000);

                    }

                }, 1000);

            } else {

                setTimeout(() => {

                    // 切换玩家

                    gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;

                    nextQuestion();

                }, 1000);

            }

            

            // 更新分数显示

            updateScores();

        }

 

        // 选择格子

        function selectCell(cellIndex) {

            const cell = selectionGrid.querySelector(`[data-index="${cellIndex}"]`);

            

            // 检查是否已经选择过

            if (cell.classList.contains("selected-by-player1") || cell.classList.contains("selected-by-player2")) {

                return;

            }

            

            // 标记为已选择

            if (gameState.currentPlayer === 1) {

                cell.classList.add("selected-by-player1");

                

                // 添加玩家标记

                const marker = document.createElement("div");

                marker.className = "player-marker player1-marker";

                marker.textContent = "P1";

                cell.appendChild(marker);

                

                gameState.player1.selectedCells.push(cellIndex);

            } else {

                cell.classList.add("selected-by-player2");

                

                // 添加玩家标记

                const marker = document.createElement("div");

                marker.className = "player-marker player2-marker";

                marker.textContent = "P2";

                cell.appendChild(marker);

                

                gameState.player2.selectedCells.push(cellIndex);

            }

            

            // 检查是否是毒药

            const isPlayer1Poison = gameState.player1.poisonCell === cellIndex;

            const isPlayer2Poison = gameState.player2.poisonCell === cellIndex;

            

            if ((gameState.currentPlayer === 1 && isPlayer2Poison) ||

                (gameState.currentPlayer === 2 && isPlayer1Poison)) {

                // 找到对手的毒药，获胜

                cell.classList.add("revealed");

                

                setTimeout(() => {

                    endGame(gameState.currentPlayer);

                }, 1000);

            } else if ((gameState.currentPlayer === 1 && isPlayer1Poison) ||

                      (gameState.currentPlayer === 2 && isPlayer2Poison)) {

                // 吃到自己的毒药，失败

                cell.classList.add("revealed");

                

                setTimeout(() => {

                    endGame(gameState.currentPlayer === 1 ? 2 : 1);

                }, 1000);

            } else {

                // 安全食物，切换玩家

                gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;

                

                // 返回挑战阶段

                setTimeout(() => {

                    changePhase("challenge");

                    nextQuestion();

                }, 1000);

            }

        }

 

        // 电脑选择格子

        function computerSelectCell() {

            // 找出未选择的格子

            const availableCells = [];

            for (let i = 0; i < 16; i++) {

                const cell = selectionGrid.querySelector(`[data-index="${i}"]`);

                if (!cell.classList.contains("selected-by-player1") &&

                    !cell.classList.contains("selected-by-player2")) {

                    availableCells.push(i);

                }

            }

            

            if (availableCells.length > 0) {

                // 随机选择一个

                const randomIndex = Math.floor(Math.random() * availableCells.length);

                const selectedCellIndex = availableCells[randomIndex];

                

                // 模拟点击

                const cell = selectionGrid.querySelector(`[data-index="${selectedCellIndex}"]`);

                cell.click();

            }

        }

 

        // 结束游戏

        function endGame(winner) {

            gameState.phase = "gameOver";

            

            // 更新分数显示

            updateScores();

            

            // 显示最终得分

            finalScorePlayer1.textContent = gameState.player1.score;

            finalScorePlayer2.textContent = gameState.player2.score;

            

            // 显示获胜信息

            const winnerName = winner === 1 ? "玩家1" : "玩家2";

            winnerMessage.textContent = `${winnerName}获胜！`;

            

            const loser = winner === 1 ? gameState.player2 : gameState.player1;

            const violation = violations[loser.poisonIndex];

            

            gameResultDetail.innerHTML = `

                ${winnerName}成功发现了玩家${loser === gameState.player2 ? 2 : 1}设置的毒药：<strong>${violation.violation}</strong>！

                <p>违规行为：${violation.description}</p>

                <p>处罚措施：${violation.details || violation.penalty}</p>

            `;

            

            // 更新排行榜

            updateLeaderboard(winnerName, gameState[winner === 1 ? 'player1' : 'player2'].score);

            

            // 切换到游戏结束界面

            changePhase("gameOver");

        }

 

        // 更新排行榜

        function updateLeaderboard(winner, score) {

            // 添加到排行榜

            gameState.leaderboard.push({

                player: winner,

                score: score,

                date: new Date().toLocaleDateString()

            });

            

            // 按分数排序

            gameState.leaderboard.sort((a, b) => b.score - a.score);

            

            // 只保留前10名

            if (gameState.leaderboard.length > 10) {

                gameState.leaderboard = gameState.leaderboard.slice(0, 10);

            }

            

            // 保存到本地存储

            localStorage.setItem('poisonGameLeaderboard', JSON.stringify(gameState.leaderboard));

            

            // 更新排行榜显示

            renderLeaderboard();

        }

 

        // 渲染排行榜

        function renderLeaderboard() {

            leaderboardList.innerHTML = "";

            

            gameState.leaderboard.forEach((entry, index) => {

                const li = document.createElement("li");

                li.innerHTML = `<strong>${entry.player}</strong>: ${entry.score}分 (${entry.date})`;

                leaderboardList.appendChild(li);

            });

        }

 

        // 更新分数显示

        function updateScores() {

            player1ScoreElement.querySelector(".score-value").textContent = gameState.player1.score;

            player2ScoreElement.querySelector(".score-value").textContent = gameState.player2.score;

        }

 

        // 更新当前玩家显示

        function updateCurrentPlayerDisplay() {

            if (gameState.currentPlayer === 1) {

                player1ScoreElement.classList.add("current-player");

                player2ScoreElement.classList.remove("current-player");

            } else {

                player1ScoreElement.classList.remove("current-player");

                player2ScoreElement.classList.add("current-player");

            }

        }

 

        // 切换游戏阶段

        function changePhase(newPhase) {

            gameState.phase = newPhase;

            

            // 隐藏所有阶段

            setupPhase.classList.remove("active-phase");

            challengePhase.classList.remove("active-phase");

            selectionPhase.classList.remove("active-phase");

            gameOverPhase.classList.remove("active-phase");

            

            // 显示当前阶段

            document.getElementById(`${newPhase}-phase`).classList.add("active-phase");

        }

 

        // 重置游戏状态

        function resetGameState() {

            gameState = {

                phase: "setup",

                currentPlayer: 1,

                player1: {

                    score: 0,

                    poisonIndex: -1,

                    poisonCell: -1,

                    selectedCells: []

                },

                player2: {

                    score: 0,

                    poisonIndex: -1,

                    poisonCell: -1,

                    selectedCells: []

                },

                currentQuestion: null,

                isComputer: false,

                currentSetupPlayer: 1,

                usedQuestions: [],

                currentFoodItems: [],

                leaderboard: gameState.leaderboard // 保留排行榜

            };

        }

 

        // 事件监听

        player1ConfirmBtn.addEventListener("click", () => confirmPoisonSelection(1));

        player2ConfirmBtn.addEventListener("click", () => confirmPoisonSelection(2));

        

        // 玩家1网格点击事件

        document.getElementById("player1-grid").addEventListener("click", (e) => {

            const cell = e.target.closest(".grid-item");

            if (cell) {

                selectPoisonCell(1, parseInt(cell.dataset.index));

            }

        });

        

        // 玩家2网格点击事件

        document.getElementById("player2-grid").addEventListener("click", (e) => {

            const cell = e.target.closest(".grid-item");

            if (cell) {

                selectPoisonCell(2, parseInt(cell.dataset.index));

            }

        });

        

        backToChallengeBtn.addEventListener("click", () => {

            changePhase("challenge");

            nextQuestion();

        });

        

        playAgainBtn.addEventListener("click", () => {

            // 重置游戏状态但保留玩家设置

            const player1Poison = gameState.player1.poisonIndex;

            const player1Cell = gameState.player1.poisonCell;

            const player2Poison = gameState.player2.poisonIndex;

            const player2Cell = gameState.player2.poisonCell;

            

            resetGameState();

            

            // 恢复毒药设置

            gameState.player1.poisonIndex = player1Poison;

            gameState.player1.poisonCell = player1Cell;

            gameState.player2.poisonIndex = player2Poison;

            gameState.player2.poisonCell = player2Cell;

            

            // 重新初始化

            changePhase("challenge");

            initializeSelectionGrid();

            nextQuestion();

        });

        

        newGameBtn.addEventListener("click", () => {

            // 完全重置游戏

            resetGameState();

            

            // 重新初始化

            changePhase("setup");

            player1Setup.style.display = "block";

            player2Setup.style.display = "none";

            initializeGrids();

        });

 

        // 初始化游戏

        initializeGrids();

        renderLeaderboard();

    </script>

</body>

</html>
