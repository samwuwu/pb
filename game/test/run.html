<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>代码运行结果</title>
    <style>
      /* 简洁的全屏布局 */
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
      body {
        background: #f5f8fc;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: #333;
      }
      .message {
        max-width: 600px;
        text-align: center;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
    </style>
  </head>
  <body>
    <script>
      (function () {
        // 解析 URL 中的 code 参数
        const params = new URLSearchParams(window.location.search);
        if (params.has("code")) {
          try {
            const codeParam = params.get("code");
            // 解码 base64 编码的 HTML
            const decoded = decodeURIComponent(escape(atob(codeParam)));
            // 创建 iframe 元素并将解码的 HTML 设置为 srcdoc
            const iframe = document.createElement("iframe");
            let html = decoded;
            // 如果缺少基本结构或 charset，则尝试补充
            if (!/<html[\s>]/i.test(html)) {
              html = `<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"></head><body>${html}</body></html>`;
            } else if (!/<meta\s+charset/i.test(html) && !/<meta\s+http-equiv="?content-type"?/i.test(html)) {
              html = `<meta charset="UTF-8">\n${html}`;
            }
            iframe.srcdoc = html;
            iframe.setAttribute("sandbox", "allow-scripts allow-same-origin");
            document.body.appendChild(iframe);
          } catch (e) {
            const div = document.createElement("div");
            div.className = "message";
            div.innerHTML = `<h2>解析代码时发生错误</h2><pre>${e}</pre>`;
            document.body.appendChild(div);
          }
        } else {
          const div = document.createElement("div");
          div.className = "message";
          div.innerHTML = `<h2>未提供代码参数</h2><p>请通过带有 code 参数的链接访问此页面。</p>`;
          document.body.appendChild(div);
        }
      })();
    </script>
  </body>
</html>