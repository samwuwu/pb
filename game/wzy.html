<!DOCTYPE html>

<html lang="zh-CN">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>安全卫士小飞侠</title>

    <style>

        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

            touch-action: manipulation;

        }

        

        body {

            background: linear-gradient(to bottom, #0a0a2a, #1a1a4a);

            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;

            overflow: hidden;

            color: white;

            height: 100vh;

            width: 100vw;

            position: fixed;

        }

        

        #game-container {

            position: relative;

            width: 100%;

            height: 100%;

            overflow: hidden;

        }

        

        #start-screen {

            position: absolute;

            width: 100%;

            height: 100%;

            background: url('https://img.freepik.com/free-vector/hand-painted-space-background_23-2148964713.jpg') center/cover;

            display: flex;

            flex-direction: column;

            justify-content: center;

            align-items: center;

            z-index: 10;

        }

        

        #game-title {

            font-size: 2.5rem;

            color: #fff;

            text-shadow: 0 0 10px #00f, 0 0 20px #00f, 0 0 30px #00f;

            margin-bottom: 2rem;

            text-align: center;

            padding: 0 20px;

            animation: glow 2s infinite alternate;

        }

        

        @keyframes glow {

            from {

                text-shadow: 0 0 10px #00f, 0 0 20px #00f, 0 0 30px #00f;

            }

            to {

                text-shadow: 0 0 15px #00f, 0 0 25px #00f, 0 0 35px #00f, 0 0 45px #00f;

            }

        }

        

        .game-button {

            padding: 12px 25px;

            font-size: 1.2rem;

            background: linear-gradient(to right, #00a8ff, #0097e6);

            border: none;

            border-radius: 50px;

            color: white;

            cursor: pointer;

            transition: all 0.3s;

            box-shadow: 0 0 15px rgba(0, 168, 255, 0.7);

            margin: 10px;

            width: 80%;

            max-width: 250px;

        }

        

        .game-button:hover {

            transform: scale(1.05);

            box-shadow: 0 0 25px rgba(0, 168, 255, 0.9);

        }

        

        #game-canvas {

            display: block;

            background: linear-gradient(to bottom, #1a1a4a, #0a0a2a);

            width: 100%;

            height: 100%;

        }

        

        #hud {

            position: absolute;

            top: 10px;

            left: 10px;

            color: white;

            font-size: 1rem;

            display: flex;

            flex-direction: column;

            gap: 5px;

            background: rgba(0, 0, 0, 0.5);

            padding: 8px;

            border-radius: 8px;

            z-index: 2;

        }

        

        .hud-item {

            display: flex;

            align-items: center;

            gap: 5px;

        }

        

        #legend-screen {

            position: absolute;

            width: 100%;

            height: 100%;

            background: rgba(0, 0, 0, 0.9);

            display: flex;

            flex-direction: column;

            justify-content: flex-start;

            align-items: center;

            z-index: 5;

            color: white;

            overflow-y: auto;

            padding: 20px 0;

            -webkit-overflow-scrolling: touch;

        }

        

        #legend-content {

            width: 95%;

            max-width: 500px;

            padding-bottom: 20px;

        }

        

        #legend-timer {

            position: fixed;

            top: 20px;

            right: 20px;

            font-size: 1.2rem;

            color: white;

            background: rgba(0, 0, 0, 0.7);

            padding: 5px 10px;

            border-radius: 5px;

        }

        

        .legend-container {

            display: flex;

            flex-wrap: wrap;

            justify-content: center;

            gap: 15px;

            margin-bottom: 20px;

        }

        

        .legend-item {

            display: flex;

            flex-direction: column;

            align-items: center;

            width: 100px;

            background: rgba(255, 255, 255, 0.1);

            padding: 8px;

            border-radius: 8px;

            font-size: 0.9rem;

        }

        

        .legend-icon {

            width: 50px;

            height: 50px;

            margin-bottom: 8px;

            background-size: contain;

            background-repeat: no-repeat;

            background-position: center;

            background-color: white;

            padding: 5px;

            border-radius: 8px;

            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);

        }

        

        .danger {

            border: 2px solid red;

        }

        

        .safe {

            border: 2px solid blue;

        }

        

        .bonus {

            border: 2px solid gold;

        }

        

        #game-over {

            position: absolute;

            width: 100%;

            height: 100%;

            background: rgba(0, 0, 0, 0.9);

            display: none;

            flex-direction: column;

            justify-content: center;

            align-items: center;

            z-index: 5;

            color: white;

            padding: 20px;

        }

        

        #final-score {

            font-size: 2rem;

            margin: 15px 0;

            color: gold;

        }

        

        .progress-bar {

            width: 100px;

            height: 15px;

            background-color: #333;

            border-radius: 8px;

            margin-top: 5px;

            overflow: hidden;

        }

        

        .progress {

            height: 100%;

            background: linear-gradient(to right, #00a8ff, #0097e6);

            width: 100%;

            transition: width 0.3s;

        }

        

        .button-group {

            display: flex;

            flex-direction: column;

            gap: 10px;

            margin-top: 20px;

            width: 80%;

            max-width: 250px;

        }

        

        .section-title {

            font-size: 1.4rem;

            margin: 15px 0;

            color: #00a8ff;

            text-align: center;

        }

        

        #controls {

            position: absolute;

            bottom: 20px;

            width: 100%;

            display: flex;

            justify-content: center;

            gap: 30px;

            z-index: 2;

        }

        

        .control-btn {

            width: 60px;

            height: 60px;

            border-radius: 50%;

            background: rgba(0, 168, 255, 0.5);

            border: 2px solid rgba(255, 255, 255, 0.3);

            color: white;

            font-size: 1.5rem;

            display: flex;

            justify-content: center;

            align-items: center;

            user-select: none;

            -webkit-user-select: none;

        }

        

        #shoot-btn {

            background: rgba(255, 50, 50, 0.6);

            width: 70px;

            height: 70px;

        }

        

        @media (max-height: 600px) {

            #game-title {

                font-size: 2rem;

                margin-bottom: 1rem;

            }

            

            .game-button {

                padding: 10px 20px;

                font-size: 1rem;

            }

            

            .control-btn {

                width: 50px;

                height: 50px;

                font-size: 1.2rem;

            }

            

            #shoot-btn {

                width: 60px;

                height: 60px;

            }

            

            #hud {

                font-size: 0.9rem;

                padding: 5px;

            }

        }

    </style>

</head>

<body>

    <div id="game-container">

        <div id="start-screen">

            <h1 id="game-title">安全卫士小飞侠</h1>

            <button id="start-button" class="game-button">开始游戏</button>

        </div>

        

        <div id="legend-screen" style="display: none;">

            <div id="legend-timer">剩余时间: 15秒</div>

            <div id="legend-content">

                <h2 class="section-title">安全隐患标识</h2>

                <div class="legend-container" id="danger-legend"></div>

                

                <h2 class="section-title">安全操作标识</h2>

                <div class="legend-container" id="safe-legend"></div>

                

                <h2 class="section-title">惊喜盒子</h2>

                <div class="legend-container" id="bonus-legend"></div>

                

                <div class="button-group">

                    <button id="continue-button" class="game-button">开始游戏</button>

                    <button id="skip-legend-button" class="game-button">跳过教程</button>

                </div>

            </div>

        </div>

        

        <div id="game-over">

            <h2>游戏结束!</h2>

            <div id="final-score">得分: 0</div>

            <div class="button-group">

                <button id="restart-button" class="game-button">再玩一次</button>

                <button id="restart-skip-button" class="game-button">跳过教程再玩</button>

            </div>

        </div>

        

        <canvas id="game-canvas"></canvas>

        <div id="hud">

            <div class="hud-item">得分: <span id="score">0</span></div>

            <div class="hud-item">时间: <span id="time">60</span>秒</div>

            <div class="hud-item">

                生命:

                <div class="progress-bar">

                    <div class="progress" id="health-bar"></div>

                </div>

            </div>

        </div>

        

        <div id="controls">

            <div class="control-btn" id="left-btn">←</div>

            <div class="control-btn" id="shoot-btn">↑</div>

            <div class="control-btn" id="right-btn">→</div>

        </div>

    </div>

    

    <audio id="bg-music" loop>

        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">

    </audio>

    <audio id="shoot-sound">

        <source src="https://www.soundjay.com/buttons/sounds/button-09.mp3" type="audio/mpeg">

    </audio>

    <audio id="hit-sound">

        <source src="https://www.soundjay.com/mechanical/sounds/laser-gun-01.mp3" type="audio/mpeg">

    </audio>

    <audio id="bonus-sound">

        <source src="https://www.soundjay.com/buttons/sounds/button-21.mp3" type="audio/mpeg">

    </audio>

    <audio id="game-over-sound">

        <source src="https://www.soundjay.com/buttons/sounds/button-10.mp3" type="audio/mpeg">

    </audio>

 

    <script>

        // 游戏配置

        const config = {

            width: window.innerWidth,

            height: window.innerHeight,

            playerSpeed: 8,

            bulletSpeed: 10,

            enemySpeed: 3,

            enemySpawnRate: 60,

            gameTime: 60, // 60秒游戏时间

            playerHealth: 100,

            legendDisplayTime: 15 // 图例显示时间(秒)

        };

        

        // 游戏状态

        let gameState = {

            score: 0,

            timeLeft: config.gameTime,

            health: config.playerHealth,

            isRunning: false,

            enemies: [],

            bullets: [],

            bonuses: [],

            lastEnemySpawn: 0,

            lastTimeUpdate: 0,

            lastBulletTime: 0,

            animationId: null,

            legendTimer: null,

            touchControls: {

                left: false,

                right: false,

                shoot: false

            }

        };

        

        // 获取DOM元素

        const canvas = document.getElementById('game-canvas');

        const ctx = canvas.getContext('2d');

        const startScreen = document.getElementById('start-screen');

        const startButton = document.getElementById('start-button');

        const legendScreen = document.getElementById('legend-screen');

        const continueButton = document.getElementById('continue-button');

        const skipLegendButton = document.getElementById('skip-legend-button');

        const gameOverScreen = document.getElementById('game-over');

        const restartButton = document.getElementById('restart-button');

        const restartSkipButton = document.getElementById('restart-skip-button');

        const scoreDisplay = document.getElementById('score');

        const timeDisplay = document.getElementById('time');

        const healthBar = document.getElementById('health-bar');

        const finalScoreDisplay = document.getElementById('final-score');

        const dangerLegend = document.getElementById('danger-legend');

        const safeLegend = document.getElementById('safe-legend');

        const bonusLegend = document.getElementById('bonus-legend');

        const legendTimerDisplay = document.getElementById('legend-timer');

        const leftBtn = document.getElementById('left-btn');

        const rightBtn = document.getElementById('right-btn');

        const shootBtn = document.getElementById('shoot-btn');

        

        // 音频元素

        const bgMusic = document.getElementById('bg-music');

        const shootSound = document.getElementById('shoot-sound');

        const hitSound = document.getElementById('hit-sound');

        const bonusSound = document.getElementById('bonus-sound');

        const gameOverSound = document.getElementById('game-over-sound');

        

        // 设置画布大小

        canvas.width = config.width;

        canvas.height = config.height;

        

        // 游戏对象

        const player = {

            x: config.width / 2,

            y: config.height - 100,

            width: 50,

            height: 50,

            speed: config.playerSpeed,

            color: '#ff0000',

            borderColor: '#ffffff',

            bulletCooldown: 300 // 子弹冷却时间(毫秒)

        };

        

        // 自定义绘制红色飞机白色边框

        function drawPlayer() {

            // 绘制红色机身

            ctx.fillStyle = player.color;

            ctx.beginPath();

            ctx.moveTo(player.x + player.width/2, player.y);

            ctx.lineTo(player.x + player.width, player.y + player.height);

            ctx.lineTo(player.x, player.y + player.height);

            ctx.closePath();

            ctx.fill();

            

            // 绘制白色边框

            ctx.strokeStyle = player.borderColor;

            ctx.lineWidth = 2;

            ctx.beginPath();

            ctx.moveTo(player.x + player.width/2, player.y);

            ctx.lineTo(player.x + player.width, player.y + player.height);

            ctx.lineTo(player.x, player.y + player.height);

            ctx.closePath();

            ctx.stroke();

            

            // 添加飞机细节

            ctx.fillStyle = '#ffffff';

            ctx.beginPath();

            ctx.arc(player.x + player.width/2, player.y + player.height/3, 4, 0, Math.PI * 2);

            ctx.fill();

        }

        

        // 安全隐患图标 (8种不同图标)

        const dangerIcons = [

            { name: "充电宝冒烟", url: "https://cdn-icons-png.flaticon.com/512/2936/2936886.png", points: 20 },

            { name: "行李堵塞", url: "https://cdn-icons-png.flaticon.com/512/2885/2885417.png", points: 15 },

            { name: "未灭烟头", url: "https://cdn-icons-png.flaticon.com/512/1049/1049207.png", points: 25 },

            { name: "液体泄漏", url: "https://cdn-icons-png.flaticon.com/512/3161/3161837.png", points: 20 },

            { name: "设备过热", url: "https://cdn-icons-png.flaticon.com/512/2936/2936771.png", points: 30 },

            { name: "出口堵塞", url: "https://cdn-icons-png.flaticon.com/512/2885/2885455.png", points: 25 },

            { name: "电线裸露", url: "https://cdn-icons-png.flaticon.com/512/2936/2936751.png", points: 20 },

            { name: "未安全带", url: "https://cdn-icons-png.flaticon.com/512/3476/3476478.png", points: 15 }

        ];

        

        // 安全操作图标 (5种不同图标)

        const safeIcons = [

            { name: "灭火器", url: "https://cdn-icons-png.flaticon.com/512/2519/2519636.png", points: -30 },

            { name: "紧急出口", url: "https://cdn-icons-png.flaticon.com/512/3476/3476441.png", points: -30 },

            { name: "安全带", url: "https://cdn-icons-png.flaticon.com/512/3476/3476413.png", points: -20 },

            { name: "禁止吸烟", url: "https://cdn-icons-png.flaticon.com/512/2913/2913104.png", points: -25 },

            { name: "安全通道", url: "https://cdn-icons-png.flaticon.com/512/2519/2519603.png", points: -20 }

        ];

        

        // 惊喜盒子 (2种不同图标)

        const bonusIcons = [

            { name: "时间奖励", url: "https://cdn-icons-png.flaticon.com/512/3022/3022561.png", points: 0, effect: "time" },

            { name: "爆炸奖励", url: "https://cdn-icons-png.flaticon.com/512/3022/3022561.png", points: 50, effect: "explosion" }

        ];

        

        // 子弹图标

        const bulletIcon = {

            width: 4,

            height: 12,

            color: '#00f7ff'

        };

        

        // 初始化图例显示

        function initLegends() {

            dangerLegend.innerHTML = '';

            safeLegend.innerHTML = '';

            bonusLegend.innerHTML = '';

            

            dangerIcons.forEach((icon, index) => {

                const item = document.createElement('div');

                item.className = 'legend-item danger';

                item.innerHTML = `

                    <div class="legend-icon" style="background-image: url('${icon.url}')"></div>

                    <div style="font-weight: bold;">${icon.name}</div>

                    <div>+${icon.points}分</div>

                `;

                dangerLegend.appendChild(item);

            });

            

            safeIcons.forEach((icon, index) => {

                const item = document.createElement('div');

                item.className = 'legend-item safe';

                item.innerHTML = `

                    <div class="legend-icon" style="background-image: url('${icon.url}')"></div>

                    <div style="font-weight: bold;">${icon.name}</div>

                    <div>${icon.points}分</div>

                `;

                safeLegend.appendChild(item);

            });

            

            bonusIcons.forEach((icon, index) => {

                const item = document.createElement('div');

                item.className = 'legend-item bonus';

                item.innerHTML = `

                    <div class="legend-icon" style="background-image: url('${icon.url}')"></div>

                    <div style="font-weight: bold;">${icon.name}</div>

                    <div>${icon.effect === 'time' ? '+10秒' : '+50分'}</div>

                `;

                bonusLegend.appendChild(item);

            });

        }

        

        // 更新图例计时器

        function updateLegendTimer(seconds) {

            legendTimerDisplay.textContent = `剩余时间: ${seconds}秒`;

        }

        

        // 设置触摸控制

        function setupTouchControls() {

            // 左按钮

            leftBtn.addEventListener('touchstart', (e) => {

                e.preventDefault();

                gameState.touchControls.left = true;

            });

            

            leftBtn.addEventListener('touchend', (e) => {

                e.preventDefault();

                gameState.touchControls.left = false;

            });

            

            // 右按钮

            rightBtn.addEventListener('touchstart', (e) => {

                e.preventDefault();

                gameState.touchControls.right = true;

            });

            

            rightBtn.addEventListener('touchend', (e) => {

                e.preventDefault();

                gameState.touchControls.right = false;

            });

            

            // 射击按钮

            shootBtn.addEventListener('touchstart', (e) => {

                e.preventDefault();

                gameState.touchControls.shoot = true;

            });

            

            shootBtn.addEventListener('touchend', (e) => {

                e.preventDefault();

                gameState.touchControls.shoot = false;

            });

            

            // 防止触摸时页面滚动

            document.addEventListener('touchmove', (e) => {

                if (gameState.isRunning) {

                    e.preventDefault();

                }

            }, { passive: false });

        }

        

        // 键盘控制

        const keys = {

            ArrowUp: false,

            ArrowDown: false,

            ArrowLeft: false,

            ArrowRight: false,

            Space: false

        };

        

        // 事件监听

        window.addEventListener('keydown', (e) => {

            if (e.code in keys) {

                keys[e.code] = true;

                e.preventDefault();

            }

        });

        

        window.addEventListener('keyup', (e) => {

            if (e.code in keys) {

                keys[e.code] = false;

                e.preventDefault();

            }

        });

        

        // 按钮控制

        startButton.addEventListener('click', startGame);

        continueButton.addEventListener('click', () => startGamePlay(false));

        skipLegendButton.addEventListener('click', () => startGamePlay(true));

        restartButton.addEventListener('click', () => resetGame(false));

        restartSkipButton.addEventListener('click', () => resetGame(true));

        

        // 开始游戏

        function startGame() {

            startScreen.style.display = 'none';

            initLegends();

            legendScreen.style.display = 'flex';

            

            // 启动图例计时器

            let secondsLeft = config.legendDisplayTime;

            updateLegendTimer(secondsLeft);

            

            gameState.legendTimer = setInterval(() => {

                secondsLeft--;

                updateLegendTimer(secondsLeft);

                

                if (secondsLeft <= 0) {

                    clearInterval(gameState.legendTimer);

                    if (legendScreen.style.display === 'flex') {

                        startGamePlay(false);

                    }

                }

            }, 1000);

        }

        

        // 开始游戏主循环

        function startGamePlay(skipLegend) {

            if (gameState.legendTimer) {

                clearInterval(gameState.legendTimer);

            }

            

            legendScreen.style.display = 'none';

            gameOverScreen.style.display = 'none';

            

            // 重置游戏状态

            gameState = {

                score: 0,

                timeLeft: config.gameTime,

                health: config.playerHealth,

                isRunning: true,

                enemies: [],

                bullets: [],

                bonuses: [],

                lastEnemySpawn: 0,

                lastTimeUpdate: Date.now(),

                lastBulletTime: 0,

                animationId: null,

                legendTimer: null,

                touchControls: {

                    left: false,

                    right: false,

                    shoot: false

                }

            };

            

            // 重置玩家位置

            player.x = config.width / 2 - player.width / 2;

            player.y = config.height - 100;

            

            // 更新HUD

            updateHUD();

            

            // 播放背景音乐

            bgMusic.volume = 0.3;

            if (skipLegend) {

                bgMusic.currentTime = 0;

            }

            bgMusic.play().catch(e => console.log("自动播放被阻止，请点击开始游戏"));

            

            // 开始游戏循环

            gameLoop();

        }

        

        // 重置游戏

        function resetGame(skipLegend) {

            gameOverScreen.style.display = 'none';

            

            if (skipLegend) {

                startGamePlay(true);

            } else {

                startGame();

            }

        }

        

        // 游戏结束

        function gameOver() {

            gameState.isRunning = false;

            cancelAnimationFrame(gameState.animationId);

            

            // 停止背景音乐

            bgMusic.pause();

            bgMusic.currentTime = 0;

            

            // 播放游戏结束音效

            gameOverSound.play();

            

            // 显示最终得分

            finalScoreDisplay.textContent = `得分: ${gameState.score}`;

            gameOverScreen.style.display = 'flex';

        }

        

        // 更新HUD

        function updateHUD() {

            scoreDisplay.textContent = gameState.score;

            timeDisplay.textContent = gameState.timeLeft;

            healthBar.style.width = `${gameState.health}%`;

        }

        

        // 生成敌人

        function spawnEnemy() {

            const now = Date.now();

            if (now - gameState.lastEnemySpawn > 1000 / (config.enemySpawnRate / 60)) {

                gameState.lastEnemySpawn = now;

                

                // 随机决定生成敌人还是安全标志

                const type = Math.random() < 0.8 ? 'danger' : 'safe';

                let icon, points;

                

                if (type === 'danger') {

                    const randomIcon = dangerIcons[Math.floor(Math.random() * dangerIcons.length)];

                    icon = randomIcon.url;

                    points = randomIcon.points;

                } else {

                    const randomIcon = safeIcons[Math.floor(Math.random() * safeIcons.length)];

                    icon = randomIcon.url;

                    points = randomIcon.points;

                }

                

                // 5%几率生成惊喜盒子

                if (Math.random() < 0.05) {

                    const bonus = bonusIcons[Math.floor(Math.random() * bonusIcons.length)];

                    gameState.bonuses.push({

                        x: Math.random() * (config.width - 40),

                        y: -40,

                        width: 35,

                        height: 35,

                        speed: config.enemySpeed * 0.7,

                        image: bonus.url,

                        points: bonus.points,

                        effect: bonus.effect

                    });

                } else {

                    gameState.enemies.push({

                        x: Math.random() * (config.width - 40),

                        y: -40,

                        width: 35,

                        height: 35,

                        speed: config.enemySpeed * (0.8 + Math.random() * 0.4),

                        image: icon,

                        points: points,

                        type: type

                    });

                }

            }

        }

        

        // 发射子弹

        function shoot() {

            const now = Date.now();

            if ((keys.Space || keys.ArrowUp || gameState.touchControls.shoot) &&

                gameState.isRunning &&

                now - gameState.lastBulletTime > player.bulletCooldown) {

                gameState.bullets.push({

                    x: player.x + player.width / 2 - 2,

                    y: player.y,

                    width: bulletIcon.width,

                    height: bulletIcon.height,

                    speed: config.bulletSpeed,

                    color: bulletIcon.color

                });

                

                gameState.lastBulletTime = now;

                

                // 播放射击音效

                shootSound.currentTime = 0;

                shootSound.play();

            }

        }

        

        // 更新玩家位置

        function updatePlayer() {

            // 键盘控制

            if (keys.ArrowLeft && player.x > 0) {

                player.x -= player.speed;

            }

            if (keys.ArrowRight && player.x < config.width - player.width) {

                player.x += player.speed;

            }

            

            // 触摸控制

            if (gameState.touchControls.left && player.x > 0) {

                player.x -= player.speed;

            }

            if (gameState.touchControls.right && player.x < config.width - player.width) {

                player.x += player.speed;

            }

        }

        

        // 更新子弹位置

        function updateBullets() {

            for (let i = gameState.bullets.length - 1; i >= 0; i--) {

                const bullet = gameState.bullets[i];

                bullet.y -= bullet.speed;

                

                // 移除超出屏幕的子弹

                if (bullet.y + bullet.height < 0) {

                    gameState.bullets.splice(i, 1);

                }

            }

        }

        

        // 更新敌人位置

        function updateEnemies() {

            for (let i = gameState.enemies.length - 1; i >= 0; i--) {

                const enemy = gameState.enemies[i];

                enemy.y += enemy.speed;

                

                // 移除超出屏幕的敌人

                if (enemy.y > config.height) {

                    gameState.enemies.splice(i, 1);

                    

                    // 敌人到达底部会减少生命值

                    if (enemy.type === 'danger') {

                        gameState.health -= 5;

                        updateHUD();

                        

                        if (gameState.health <= 0) {

                            gameOver();

                        }

                    }

                }

            }

        }

        

        // 更新惊喜盒子位置

        function updateBonuses() {

            for (let i = gameState.bonuses.length - 1; i >= 0; i--) {

                const bonus = gameState.bonuses[i];

                bonus.y += bonus.speed;

                

                // 移除超出屏幕的惊喜盒子

                if (bonus.y > config.height) {

                    gameState.bonuses.splice(i, 1);

                }

            }

        }

        

        // 检测碰撞

        function checkCollisions() {

            // 子弹与敌人碰撞

            for (let i = gameState.bullets.length - 1; i >= 0; i--) {

                const bullet = gameState.bullets[i];

                

                for (let j = gameState.enemies.length - 1; j >= 0; j--) {

                    const enemy = gameState.enemies[j];

                    

                    if (

                        bullet.x < enemy.x + enemy.width &&

                        bullet.x + bullet.width > enemy.x &&

                        bullet.y < enemy.y + enemy.height &&

                        bullet.y + bullet.height > enemy.y

                    ) {

                        // 碰撞发生

                        gameState.score += enemy.points;

                        

                        // 播放击中音效

                        hitSound.currentTime = 0;

                        hitSound.play();

                        

                        // 移除子弹和敌人

                        gameState.bullets.splice(i, 1);

                        gameState.enemies.splice(j, 1);

                        

                        updateHUD();

                        break;

                    }

                }

                

                // 子弹与惊喜盒子碰撞

                for (let j = gameState.bonuses.length - 1; j >= 0; j--) {

                    const bonus = gameState.bonuses[j];

                    

                    if (

                        bullet.x < bonus.x + bonus.width &&

                        bullet.x + bullet.width > bonus.x &&

                        bullet.y < bonus.y + bonus.height &&

                        bullet.y + bullet.height > bonus.y

                    ) {

                        // 碰撞发生

                        if (bonus.effect === 'time') {

                            gameState.timeLeft += 10;

                        } else if (bonus.effect === 'explosion') {

                            gameState.score += bonus.points;

                            // 爆炸效果 - 移除周围敌人

                            for (let k = gameState.enemies.length - 1; k >= 0; k--) {

                                const enemy = gameState.enemies[k];

                                const distance = Math.sqrt(

                                    Math.pow(enemy.x + enemy.width/2 - (bonus.x + bonus.width/2), 2) +

                                    Math.pow(enemy.y + enemy.height/2 - (bonus.y + bonus.height/2), 2)

                                );

                                

                                if (distance < 120) {

                                    gameState.score += enemy.points;

                                    gameState.enemies.splice(k, 1);

                                }

                            }

                        }

                        

                        // 播放奖励音效

                        bonusSound.currentTime = 0;

                        bonusSound.play();

                        

                        // 移除子弹和惊喜盒子

                        gameState.bullets.splice(i, 1);

                        gameState.bonuses.splice(j, 1);

                        

                        updateHUD();

                        break;

                    }

                }

            }

            

            // 玩家与敌人碰撞

            for (let i = gameState.enemies.length - 1; i >= 0; i--) {

                const enemy = gameState.enemies[i];

                

                if (

                    player.x < enemy.x + enemy.width &&

                    player.x + player.width > enemy.x &&

                    player.y < enemy.y + enemy.height &&

                    player.y + player.height > enemy.y

                ) {

                    // 碰撞发生

                    if (enemy.type === 'danger') {

                        gameState.health -= 10;

                    } else {

                        gameState.score += enemy.points;

                    }

                    

                    // 播放击中音效

                    hitSound.currentTime = 0;

                    hitSound.play();

                    

                    // 移除敌人

                    gameState.enemies.splice(i, 1);

                    

                    updateHUD();

                    

                    if (gameState.health <= 0) {

                        gameOver();

                    }

                }

            }

        }

        

        // 更新游戏时间

        function updateGameTime() {

            const now = Date.now();

            if (now - gameState.lastTimeUpdate >= 1000) {

                gameState.lastTimeUpdate = now;

                gameState.timeLeft--;

                updateHUD();

                

                if (gameState.timeLeft <= 0) {

                    gameOver();

                }

            }

        }

        

        // 绘制游戏

        function draw() {

            // 清空画布

            ctx.clearRect(0, 0, config.width, config.height);

            

            // 绘制星空背景

            drawStarfield();

            

            // 绘制玩家

            drawPlayer();

            

            // 绘制子弹

            ctx.fillStyle = bulletIcon.color;

            gameState.bullets.forEach(bullet => {

                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);

                

                // 添加发光效果

                ctx.shadowColor = bulletIcon.color;

                ctx.shadowBlur = 8;

                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);

                ctx.shadowBlur = 0;

            });

            

            // 绘制敌人和安全标志

            gameState.enemies.forEach(enemy => {

                // 创建白色背景

                ctx.fillStyle = 'white';

                ctx.fillRect(enemy.x - 1, enemy.y - 1, enemy.width + 2, enemy.height + 2);

                

                const img = new Image();

                img.src = enemy.image;

                ctx.drawImage(img, enemy.x, enemy.y, enemy.width, enemy.height);

                

                // 添加边框颜色

                ctx.strokeStyle = enemy.type === 'danger' ? 'red' : 'blue';

                ctx.lineWidth = 2;

                ctx.strokeRect(enemy.x, enemy.y, enemy.width, enemy.height);

            });

            

            // 绘制惊喜盒子

            gameState.bonuses.forEach(bonus => {

                // 创建白色背景

                ctx.fillStyle = 'white';

                ctx.fillRect(bonus.x - 1, bonus.y - 1, bonus.width + 2, bonus.height + 2);

                

                const img = new Image();

                img.src = bonus.image;

                ctx.drawImage(img, bonus.x, bonus.y, bonus.width, bonus.height);

                

                // 添加金色边框

                ctx.strokeStyle = 'gold';

                ctx.lineWidth = 2;

                ctx.strokeRect(bonus.x, bonus.y, bonus.width, bonus.height);

            });

        }

        

        // 绘制星空背景

        function drawStarfield() {

            ctx.fillStyle = 'white';

            

            // 创建一些随机星星

            for (let i = 0; i < 80; i++) {

                const x = Math.random() * config.width;

                const y = (Math.random() * config.height + Date.now() / 100) % config.height;

                const size = Math.random() * 1.2;

                

                ctx.beginPath();

                ctx.arc(x, y, size, 0, Math.PI * 2);

                ctx.fill();

            }

        }

        

        // 游戏主循环

        function gameLoop() {

            if (!gameState.isRunning) return;

            

            updatePlayer();

            shoot();

            spawnEnemy();

            updateBullets();

            updateEnemies();

            updateBonuses();

            checkCollisions();

            updateGameTime();

            draw();

            

            gameState.animationId = requestAnimationFrame(gameLoop);

        }

        

        // 窗口大小调整

        window.addEventListener('resize', () => {

            config.width = window.innerWidth;

            config.height = window.innerHeight;

            canvas.width = config.width;

            canvas.height = config.height;

            

            // 调整玩家位置

            player.x = config.width / 2 - player.width / 2;

            player.y = config.height - 100;

        });

        

        // 初始化触摸控制

        setupTouchControls();

        

        // 防止移动端双击缩放

        document.addEventListener('dblclick', (e) => {

            e.preventDefault();

        }, { passive: false });

        

        // 防止移动端长按菜单

        document.addEventListener('contextmenu', (e) => {

            e.preventDefault();

        }, { passive: false });

    </script>

</body>

</html>
