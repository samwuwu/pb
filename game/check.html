<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å€¼æœºå¤§æŒ‘æˆ˜ï¼ˆä¼˜åŒ–ç‰ˆï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* æ·»åŠ ä¸€äº›è‡ªå®šä¹‰è¿‡æ¸¡æ•ˆæœ */
    .transition-all {
      transition: all 0.3s ease-in-out;
    }
    /* è‡ªå®šä¹‰å¼¹çª—çš„èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */
    .backdrop-blur-sm {
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4 font-sans">

  <div class="w-full max-w-md mx-auto">
    <!-- å¼€å§‹ç•Œé¢ -->
    <div id="start-screen" class="p-8 text-center bg-white rounded-3xl shadow-2xl">
      <h1 class="text-4xl font-bold text-gray-800 mb-4">å€¼æœºå¤§æŒ‘æˆ˜</h1>
      <p class="text-gray-500 mb-8">åœ¨è§„å®šæ—¶é—´å†…ï¼Œæ­£ç¡®è¯†åˆ«å‡ºæ—…å®¢è¡Œæä¸­çš„æ‰€æœ‰è¿ç¦å“ï¼ŒæŒ‘æˆ˜ä½ çš„ç«çœ¼é‡‘ç›ï¼</p>
      <button onclick="game.start()" class="w-full py-3 rounded-xl bg-blue-600 text-white font-semibold text-lg shadow-lg hover:bg-blue-700 transition-all transform hover:scale-105">
        å¼€å§‹æŒ‘æˆ˜
      </button>
    </div>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game-area" class="hidden p-4 bg-white rounded-3xl shadow-2xl space-y-4">
      <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
      <div class="flex justify-between text-gray-600 text-base font-medium border-b pb-3">
        <div class="bg-gray-100 px-4 py-1 rounded-lg">å¾—åˆ†: <span id="score" class="font-bold">0</span></div>
        <div class="bg-gray-100 px-4 py-1 rounded-lg">æ—¶é—´: <span id="time-left" class="font-bold">60</span>s</div>
      </div>

      <!-- æç¤ºè¯­ -->
      <div id="feedback-message" class="text-center text-sm text-red-500 font-medium h-5">è¯·æ‰¾å‡ºæ—…å®¢è¡Œæä¸­çš„è¿ç¦å“</div>

      <!-- æ—…å®¢ä¿¡æ¯ -->
      <div onclick="game.showPassengerInfo()" class="flex items-center p-4 bg-gray-50 rounded-2xl cursor-pointer shadow-inner hover:bg-gray-100 transition-all">
        <div id="passenger-avatar" class="text-6xl">ğŸ§</div>
        <div class="ml-4">
          <div class="text-sm text-gray-500">å½“å‰æ—…å®¢</div>
          <div id="passenger-name" class="text-xl font-semibold text-slate-700">æ—…å®¢å§“å</div>
        </div>
      </div>
      
      <!-- è¡Œæç‰©å“æ¸…å• -->
      <div id="item-list" class="grid grid-cols-2 gap-3 pt-2">
        <!-- ç‰©å“ä¼šåŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
      </div>

      <!-- æ“ä½œæŒ‰é’® -->
      <div class="pt-2">
        <button id="submit-button" onclick="game.submitJudgment()" class="w-full py-3 rounded-xl bg-green-600 text-white font-semibold text-lg shadow-lg hover:bg-green-700 transition-all transform hover:scale-105">
          å®Œæˆæ£€æŸ¥
        </button>
         <button id="next-button" onclick="game.nextRound()" class="hidden w-full py-3 rounded-xl bg-blue-600 text-white font-semibold text-lg shadow-lg hover:bg-blue-700 transition-all transform hover:scale-105">
          ä¸‹ä¸€ä½æ—…å®¢
        </button>
      </div>
    </div>
  </div>

  <!-- æ¸¸æˆç»“æŸå¼¹çª— -->
  <div id="game-over-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="bg-white rounded-3xl p-8 text-center w-80 shadow-2xl transform transition-all scale-95 opacity-0" id="game-over-content">
      <h2 class="text-3xl font-bold text-gray-800 mb-4">æ—¶é—´åˆ°ï¼</h2>
      <p class="text-lg text-gray-600 mb-2">æ­å–œä½ ï¼Œå®Œæˆäº†æŒ‘æˆ˜ï¼</p>
      <p class="text-lg text-gray-600 mb-2">æœ€ç»ˆå¾—åˆ†ï¼š</p>
      <p id="final-score" class="text-5xl font-bold text-blue-500 my-4">0</p>
      <button onclick="location.reload()" class="w-full py-3 rounded-xl bg-blue-600 text-white font-semibold text-lg hover:bg-blue-700 transition-all">
        å†ç©ä¸€æ¬¡
      </button>
    </div>
  </div>

  <!-- æ—…å®¢ä¿¡æ¯å¼¹çª— -->
  <div id="info-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50">
     <div class="bg-white rounded-3xl p-8 text-center w-80 shadow-2xl transform transition-all scale-95 opacity-0" id="info-content">
      <h2 id="info-title" class="text-2xl font-bold text-gray-800 mb-4">æç¤º</h2>
      <p id="info-text" class="text-gray-600 mb-6">ä¿¡æ¯å†…å®¹</p>
      <button onclick="game.closeInfoModal()" class="w-full py-2 rounded-xl bg-gray-600 text-white font-semibold text-lg hover:bg-gray-700 transition-all">
        å…³é—­
      </button>
    </div>
  </div>

  <script>
    // --- æ¸¸æˆæ•°æ®é…ç½® ---
    const config = {
      totalTime: 60, // æ¸¸æˆæ€»æ—¶é•¿
      items: [
        { name: 'æ‰“ç«æœº', prohibited: true, emoji: 'ğŸ”¥' },
        { name: 'ç“¶è£…æ°´', prohibited: false, emoji: 'ğŸ’§' },
        { name: 'æ°´æœåˆ€', prohibited: true, emoji: 'ğŸ”ª' },
        { name: 'ç‰™åˆ·', prohibited: false, emoji: 'ğŸª¥' },
        { name: 'ç¬”è®°æœ¬ç”µè„‘', prohibited: false, emoji: 'ğŸ’»' },
        { name: 'å……ç”µå®', prohibited: true, emoji: 'ğŸ”‹' }, // å……ç”µå®é€šå¸¸æœ‰æºå¸¦è§„å®šï¼Œè¿™é‡Œç®€åŒ–ä¸ºè¿ç¦å“
        { name: 'é›¨ä¼', prohibited: false, emoji: 'ğŸŒ‚' },
        { name: 'æ‰‹æª', prohibited: true, emoji: 'ğŸ”«' },
        { name: 'å‰ƒé¡»åˆ€', prohibited: false, emoji: 'ğŸª’'},
        { name: 'æŠ¤ç…§', prohibited: false, emoji: ' passport'},
        { name: 'ç›¸æœº', prohibited: false, emoji: 'ğŸ“·'},
        { name: 'çˆ†ç‚¸ç‰©', prohibited: true, emoji: 'ğŸ’£'}
      ],
      passengers: [
        { name: 'å¼ ä¸‰', avatar: 'ğŸ§' },
        { name: 'æå››', avatar: 'ğŸ‘©' },
        { name: 'ç‹äº”', avatar: 'ğŸ‘¨â€ğŸ¦°' },
        { name: 'èµµå…­', avatar: 'ğŸ§”' },
        { name: 'å­™ä¸ƒ', avatar: 'ğŸ‘±â€â™€ï¸' }
      ],
      scoring: {
        correctlyFound: 20,    // æ­£ç¡®æ‰¾å‡ºè¿ç¦å“
        missedProhibited: -30, // æ¼æ‰è¿ç¦å“
        wronglyMarked: -10,    // é”™æ ‡æ™®é€šå“
        correctlyIgnored: 5,   // æ­£ç¡®æ”¾è¡Œæ™®é€šå“
        allCorrectBonus: 15    // å…¨å¯¹é¢å¤–å¥–åŠ±
      }
    };

    // --- DOM å…ƒç´ ç¼“å­˜ ---
    const DOMElements = {
      startScreen: document.getElementById('start-screen'),
      gameArea: document.getElementById('game-area'),
      score: document.getElementById('score'),
      timeLeft: document.getElementById('time-left'),
      passengerAvatar: document.getElementById('passenger-avatar'),
      passengerName: document.getElementById('passenger-name'),
      itemList: document.getElementById('item-list'),
      submitButton: document.getElementById('submit-button'),
      nextButton: document.getElementById('next-button'),
      feedbackMessage: document.getElementById('feedback-message'),
      // å¼¹çª—
      gameOverModal: document.getElementById('game-over-modal'),
      gameOverContent: document.getElementById('game-over-content'),
      finalScore: document.getElementById('final-score'),
      infoModal: document.getElementById('info-modal'),
      infoContent: document.getElementById('info-content'),
      infoTitle: document.getElementById('info-title'),
      infoText: document.getElementById('info-text'),
    };
    
    // --- æ¸¸æˆçŠ¶æ€ç®¡ç† ---
    const gameState = {
      score: 0,
      timeLeft: config.totalTime,
      timer: null,
      currentLuggage: [],
      userSelection: [],
      gameActive: false,
    };

    // --- æ¸¸æˆä¸»é€»è¾‘ ---
    const game = {
      /**
       * å¼€å§‹æ¸¸æˆ
       */
      start() {
        DOMElements.startScreen.classList.add('hidden');
        DOMElements.gameArea.classList.remove('hidden');

        // åˆå§‹åŒ–çŠ¶æ€
        gameState.score = 0;
        gameState.timeLeft = config.totalTime;
        gameState.gameActive = true;
        
        // æ›´æ–°UI
        DOMElements.score.textContent = gameState.score;
        DOMElements.timeLeft.textContent = gameState.timeLeft;
        
        // å¯åŠ¨è®¡æ—¶å™¨
        if (gameState.timer) clearInterval(gameState.timer);
        gameState.timer = setInterval(() => {
          gameState.timeLeft--;
          DOMElements.timeLeft.textContent = gameState.timeLeft;
          if (gameState.timeLeft <= 0) {
            this.end();
          }
        }, 1000);
        
        this.nextRound();
      },
      
      /**
       * æ¸¸æˆç»“æŸ
       */
      end() {
        clearInterval(gameState.timer);
        gameState.gameActive = false;
        DOMElements.finalScore.textContent = gameState.score;
        DOMElements.gameOverModal.classList.remove('hidden');
        // æ·»åŠ åŠ¨ç”»æ•ˆæœ
        setTimeout(() => {
            DOMElements.gameOverContent.classList.remove('scale-95', 'opacity-0');
        }, 10);
      },

      /**
       * å‡†å¤‡ä¸‹ä¸€å›åˆ
       */
      nextRound() {
        // éšæœºé€‰æ‹©ä¸€ä½ä¹˜å®¢
        const passenger = this.getRandomElement(config.passengers);
        DOMElements.passengerName.textContent = passenger.name;
        DOMElements.passengerAvatar.textContent = passenger.avatar;

        // ç”Ÿæˆæœ¬è½®è¡Œæï¼ˆç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªè¿ç¦å“ï¼Œå¢åŠ æ¸¸æˆæ€§ï¼‰
        const prohibitedItems = config.items.filter(item => item.prohibited);
        const normalItems = config.items.filter(item => !item.prohibited);
        
        gameState.currentLuggage = [
            this.getRandomElement(prohibitedItems), // ä¿è¯è‡³å°‘1ä¸ª
            ...this.shuffle(normalItems).slice(0,2),
            ...this.shuffle(config.items).slice(0,1) // å¢åŠ éšæœºæ€§
        ].slice(0, 4); //ç¡®ä¿æœ€ç»ˆåªæœ‰4ä¸ª
        gameState.currentLuggage = this.shuffle(gameState.currentLuggage);

        gameState.userSelection = Array(gameState.currentLuggage.length).fill(false);
        
        this.renderItems(false); // æ¸²æŸ“ç‰©å“ï¼Œfalseä»£è¡¨æœªç»“æŸæ£€æŸ¥
        
        // é‡ç½®UI
        DOMElements.feedbackMessage.textContent = "è¯·æ‰¾å‡ºæ—…å®¢è¡Œæä¸­çš„è¿ç¦å“";
        DOMElements.submitButton.classList.remove('hidden');
        DOMElements.nextButton.classList.add('hidden');
        DOMElements.itemList.style.pointerEvents = 'auto'; // å…è®¸ç‚¹å‡»
      },
      
      /**
       * æ¸²æŸ“è¡Œæç‰©å“
       * @param {boolean} roundOver - æœ¬å›åˆæ˜¯å¦å·²ç»ç»“æŸ
       */
      renderItems(roundOver) {
        DOMElements.itemList.innerHTML = '';
        gameState.currentLuggage.forEach((item, index) => {
          const isSelected = gameState.userSelection[index];
          let borderColor = 'border-gray-200';
          let resultIcon = '';

          // å¦‚æœå›åˆç»“æŸï¼Œæ˜¾ç¤ºæ­£ç¡®/é”™è¯¯çŠ¶æ€
          if(roundOver) {
            if (item.prohibited && isSelected) {
              borderColor = 'border-green-500'; // æ­£ç¡®æ‰¾åˆ°
              resultIcon = 'âœ…';
            } else if (item.prohibited && !isSelected) {
              borderColor = 'border-red-500';   // æ¼æ‰
              resultIcon = 'âŒ';
            } else if (!item.prohibited && isSelected) {
              borderColor = 'border-yellow-500'; // é”™æ ‡
              resultIcon = 'âš ï¸';
            } else {
               borderColor = 'border-gray-300'; // æ­£ç¡®å¿½ç•¥
            }
          }
          
          const div = document.createElement('div');
          div.className = `item-card flex flex-col items-center justify-center p-4 bg-gray-50 rounded-2xl shadow-sm border-2 cursor-pointer transition-all ${borderColor} ${isSelected ? 'transform scale-105 bg-blue-100' : ''}`;
          div.innerHTML = `
            <div class="text-4xl">${item.emoji}</div>
            <div class="mt-2 text-base font-semibold text-gray-700">${item.name}</div>
            <div class="absolute top-2 right-2 text-xl">${resultIcon}</div>
          `;
          if (!roundOver) {
            div.onclick = () => this.toggleSelection(index);
          }
          DOMElements.itemList.appendChild(div);
        });
      },

      /**
       * åˆ‡æ¢ç‰©å“çš„é€‰ä¸­çŠ¶æ€
       * @param {number} index - ç‰©å“ç´¢å¼•
       */
      toggleSelection(index) {
        if (!gameState.gameActive) return;
        gameState.userSelection[index] = !gameState.userSelection[index];
        this.renderItems(false); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°æ ·å¼
      },
      
      /**
       * æäº¤åˆ¤æ–­
       */
      submitJudgment() {
        if (!gameState.gameActive) return;

        let roundScore = 0;
        let correctRemovals = 0;
        let missedProhibited = 0;
        let falsePositives = 0;
        let totalProhibited = 0;

        gameState.currentLuggage.forEach((item, index) => {
          const marked = gameState.userSelection[index];
          if (item.prohibited) totalProhibited++;

          if (item.prohibited && marked) {
            roundScore += config.scoring.correctlyFound;
            correctRemovals++;
          } else if (item.prohibited && !marked) {
            roundScore += config.scoring.missedProhibited;
            missedProhibited++;
          } else if (!item.prohibited && marked) {
            roundScore += config.scoring.wronglyMarked;
            falsePositives++;
          } else {
            roundScore += config.scoring.correctlyIgnored;
          }
        });

        // å…¨å¯¹å¥–åŠ±
        if (correctRemovals > 0 && correctRemovals === totalProhibited && falsePositives === 0) {
          roundScore += config.scoring.allCorrectBonus;
          DOMElements.feedbackMessage.textContent = `å¤ªæ£’äº†ï¼å¥–åŠ± ${config.scoring.allCorrectBonus} åˆ†ï¼`;
        } else if (missedProhibited > 0) {
           DOMElements.feedbackMessage.textContent = `å±é™©ï¼ä½ æ¼æ‰äº† ${missedProhibited} ä¸ªè¿ç¦å“ï¼`;
        } else if (falsePositives > 0) {
           DOMElements.feedbackMessage.textContent = `æ³¨æ„ï¼ä½ é”™è¯¯æ ‡è®°äº† ${falsePositives} ä¸ªæ™®é€šç‰©å“ã€‚`;
        } else {
            DOMElements.feedbackMessage.textContent = "æ£€æŸ¥å®Œæˆï¼";
        }

        gameState.score += roundScore;
        DOMElements.score.textContent = gameState.score;
        
        // æ˜¾ç¤ºç»“æœ
        this.renderItems(true); // true ä»£è¡¨å›åˆç»“æŸï¼Œæ˜¾ç¤ºå¯¹é”™
        DOMElements.itemList.style.pointerEvents = 'none'; // ç¦æ­¢å†æ¬¡ç‚¹å‡»
        DOMElements.submitButton.classList.add('hidden');
        DOMElements.nextButton.classList.remove('hidden');
      },

      /**
       * æ˜¾ç¤ºæ—…å®¢ä¿¡æ¯ï¼ˆä»£æ›¿ alertï¼‰
       */
      showPassengerInfo() {
          this.showInfoModal('æ—…å®¢è¯ä»¶ä¿¡æ¯', 'ç»æ ¸å¯¹ï¼Œè¯¥æ—…å®¢è¯ä»¶é½å…¨ï¼Œä¿¡æ¯æ— è¯¯ã€‚âœ…');
      },

      showInfoModal(title, text) {
          DOMElements.infoTitle.textContent = title;
          DOMElements.infoText.textContent = text;
          DOMElements.infoModal.classList.remove('hidden');
          setTimeout(() => {
              DOMElements.infoContent.classList.remove('scale-95', 'opacity-0');
          }, 10);
      },
      
      closeInfoModal() {
          DOMElements.infoContent.classList.add('scale-95', 'opacity-0');
          setTimeout(() => {
              DOMElements.infoModal.classList.add('hidden');
          }, 200);
      },

      // --- è¾…åŠ©å·¥å…·å‡½æ•° ---
      shuffle(arr) {
        const copy = [...arr];
        for (let i = copy.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [copy[i], copy[j]] = [copy[j], copy[i]];
        }
        return copy;
      },
      
      getRandomElement(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }
    };
  </script>

</body>
</html>
