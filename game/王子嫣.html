<!DOCTYPE html>

<html lang="zh-CN">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>航空安全小卫士</title>

    <style>

        * {

            box-sizing: border-box;

            margin: 0;

            padding: 0;

        }

        

        body {

            font-family: 'Microsoft YaHei', sans-serif;

            background-color: #111;

            color: white;

            overflow: hidden;

            user-select: none;

            height: 100vh;

            width: 100vw;

            touch-action: manipulation;

        }

        

        #game-container {

            position: relative;

            width: 100%;

            height: 100%;

            overflow: hidden;

            display: flex;

            justify-content: center;

            align-items: center;

        }

        

        #camera-view {

            position: relative;

            width: 100%;

            max-width: 600px;

            height: 100%;

            max-height: 800px;

            display: flex;

            flex-direction: column;

            align-items: center;

        }

        

        #camera-body {

            width: 100%;

            height: 100%;

            background-color: #333;

            border-radius: 20px;

            position: relative;

            overflow: hidden;

            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);

        }

        

        #viewfinder {

            position: absolute;

            top: 15%;

            left: 5%;

            width: 90%;

            height: 60%;

            border: 10px solid #444;

            border-radius: 10px;

            overflow: hidden;

            background-size: cover;

            background-position: center;

        }

        

        #hazard-container {

            position: absolute;

            width: 100%;

            height: 100%;

        }

        

        .hazard {

            position: absolute;

            width: 100px;

            height: 120px;

            display: flex;

            flex-direction: column;

            align-items: center;

            transition: all 0.3s;

            animation: float 3s ease-in-out infinite;

        }

        

        @keyframes float {

            0%, 100% { transform: translateY(0); }

            50% { transform: translateY(-5px); }

        }

        

        .hazard-img {

            width: 70px;

            height: 70px;

            background-size: contain;

            background-repeat: no-repeat;

            background-position: center;

            border: 2px solid #f00;

            border-radius: 50%;

            background-color: rgba(255, 255, 255, 0.9);

            padding: 5px;

        }

        

        .hazard-text {

            margin-top: 5px;

            font-size: 12px;

            text-align: center;

            background-color: rgba(255, 0, 0, 0.7);

            padding: 5px 8px;

            border-radius: 3px;

            font-weight: bold;

        }

        

        .hazard-command {

            margin-top: 5px;

            font-size: 14px;

            font-weight: bold;

            color: #ff0;

            background-color: rgba(0, 0, 0, 0.7);

            padding: 5px 8px;

            border-radius: 3px;

            border: 1px solid #ff0;

        }

        

        .bonus-box {

            position: absolute;

            width: 80px;

            height: 80px;

            background-image: url('https://cdn-icons-png.flaticon.com/512/3522/3522633.png');

            background-size: contain;

            background-repeat: no-repeat;

            background-position: center;

            animation: pulse 1.5s ease-in-out infinite;

            z-index: 15;

        }

        

        @keyframes pulse {

            0%, 100% { transform: scale(1); }

            50% { transform: scale(1.2); }

        }

        

        #shutter-btn {

            position: absolute;

            bottom: 10%;

            left: 50%;

            transform: translateX(-50%);

            width: 70px;

            height: 70px;

            border-radius: 50%;

            background-color: #f44336;

            border: 5px solid #ccc;

            cursor: pointer;

            display: flex;

            justify-content: center;

            align-items: center;

            font-weight: bold;

            font-size: 16px;

            color: white;

            z-index: 20;

            box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);

        }

        

        #score-display {

            position: absolute;

            top: 5%;

            right: 5%;

            background-color: rgba(0, 0, 0, 0.7);

            padding: 10px 15px;

            border-radius: 5px;

            font-size: 18px;

            border: 2px solid #4CAF50;

            z-index: 20;

        }

        

        #timer-display {

            position: absolute;

            top: 5%;

            left: 5%;

            background-color: rgba(0, 0, 0, 0.7);

            padding: 10px 15px;

            border-radius: 5px;

            font-size: 18px;

            border: 2px solid #f44336;

            z-index: 20;

        }

        

        #scene-display {

            position: absolute;

            top: 5%;

            left: 50%;

            transform: translateX(-50%);

            background-color: rgba(0, 0, 0, 0.7);

            padding: 10px 15px;

            border-radius: 5px;

            font-size: 18px;

            border: 2px solid #2196F3;

            z-index: 20;

        }

        

        #command-display {

            position: absolute;

            bottom: 20%;

            left: 50%;

            transform: translateX(-50%);

            background-color: rgba(0, 0, 0, 0.7);

            padding: 10px 15px;

            border-radius: 5px;

            font-size: 18px;

            min-width: 200px;

            text-align: center;

            border: 2px solid #9C27B0;

            z-index: 20;

        }

        

        #level-display {

            position: absolute;

            top: 15%;

            left: 5%;

            background-color: rgba(0, 0, 0, 0.7);

            padding: 10px 15px;

            border-radius: 5px;

            font-size: 18px;

            border: 2px solid #FF9800;

            z-index: 20;

        }

        

        #target-display {

            position: absolute;

            top: 15%;

            right: 5%;

            background-color: rgba(0, 0, 0, 0.7);

            padding: 10px 15px;

            border-radius: 5px;

            font-size: 18px;

            border: 2px solid #FF9800;

            z-index: 20;

        }

        

        #game-over {

            position: absolute;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.8);

            display: none;

            flex-direction: column;

            justify-content: center;

            align-items: center;

            z-index: 100;

        }

        

        #start-screen {

            position: absolute;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.9);

            display: flex;

            flex-direction: column;

            justify-content: center;

            align-items: center;

            z-index: 100;

            text-align: center;

            padding: 20px;

            background-image: url('https://cdn-icons-png.flaticon.com/512/3940/3940409.png'),

                            url('https://cdn-icons-png.flaticon.com/512/1138/1138008.png'),

                            url('https://cdn-icons-png.flaticon.com/512/2933/2933916.png');

            background-size: 100px, 200px, 100px;

            background-repeat: no-repeat;

            background-position: bottom 100px left 50px, center, bottom 100px right 50px;

        }

        

        #level-intro {

            position: absolute;

            top: 0;

            left: 0;

            width: 100%;

            height: 100%;

            background-color: rgba(0,0,0,0.9);

            display: none;

            flex-direction: column;

            justify-content: center;

            align-items: center;

            z-index: 100;

            text-align: center;

            padding: 20px;

        }

        

        .btn {

            margin-top: 20px;

            padding: 12px 24px;

            background-color: #4CAF50;

            color: white;

            border: none;

            border-radius: 5px;

            font-size: 18px;

            cursor: pointer;

            transition: all 0.3s;

        }

        

        .btn:hover {

            background-color: #45a049;

            transform: scale(1.05);

        }

        

        .btn-skip {

            background-color: #FF9800;

            margin-top: 10px;

        }

        

        .btn-skip:hover {

            background-color: #F57C00;

        }

        

        #instructions {

            max-width: 600px;

            margin: 20px auto;

            background-color: rgba(0,0,0,0.5);

            padding: 15px;

            border-radius: 10px;

            border: 1px solid #555;

        }

        

        .flash-animation {

            animation: flash 0.3s;

        }

        

        @keyframes flash {

            0% { opacity: 0; }

            50% { opacity: 0.8; }

            100% { opacity: 0; }

        }

        

        #photographer {

            position: absolute;

            bottom: 25%;

            left: 50%;

            transform: translateX(-50%);

            width: 60px;

            height: 80px;

            background-image: url('https://cdn-icons-png.flaticon.com/512/3940/3940409.png');

            background-size: contain;

            background-repeat: no-repeat;

            background-position: center;

            z-index: 15;

        }

        

        #airplane {

            position: absolute;

            top: 10%;

            right: 10%;

            width: 60px;

            height: 60px;

            background-image: url('https://cdn-icons-png.flaticon.com/512/2933/2933916.png');

            background-size: contain;

            background-repeat: no-repeat;

            background-position: center;

            z-index: 5;

            animation: fly 10s linear infinite;

        }

        

        @keyframes fly {

            0% { transform: translateX(100px) translateY(-50px); }

            100% { transform: translateX(-100px) translateY(50px); }

        }

        

        #mobile-controls {

            position: absolute;

            bottom: 15%;

            left: 30px;

            display: flex;

            flex-direction: column;

            align-items: center;

            z-index: 20;

            background-color: rgba(0,0,0,0.5);

            padding: 10px;

            border-radius: 10px;

        }

        

        .mobile-row {

            display: flex;

            margin: 5px 0;

        }

        

        .mobile-btn {

            width: 50px;

            height: 50px;

            background-color: rgba(0,0,0,0.7);

            border-radius: 50%;

            margin: 0 5px;

            display: flex;

            justify-content: center;

            align-items: center;

            font-size: 20px;

            font-weight: bold;

            cursor: pointer;

            border: 2px solid #fff;

        }

        

        #space-btn {

            position: absolute;

            bottom: 15%;

            right: 30px;

            width: 80px;

            height: 40px;

            border-radius: 5px;

            background-color: rgba(0,0,0,0.7);

            border: 2px solid #fff;

            display: flex;

            justify-content: center;

            align-items: center;

            font-size: 14px;

            color: white;

            cursor: pointer;

            z-index: 20;

        }

        

        #music-btn {

            position: absolute;

            top: 80px;

            right: 20px;

            width: 40px;

            height: 40px;

            border-radius: 50%;

            background-color: rgba(0,0,0,0.7);

            border: 2px solid #fff;

            display: flex;

            justify-content: center;

            align-items: center;

            font-size: 18px;

            cursor: pointer;

            z-index: 20;

        }

        

        @media (max-width: 400px) {

            .hazard {

                width: 80px;

                height: 100px;

            }

            

            .hazard-img {

                width: 60px;

                height: 60px;

            }

            

            .hazard-text {

                font-size: 10px;

            }

            

            .hazard-command {

                font-size: 12px;

            }

            

            #shutter-btn {

                width: 60px;

                height: 60px;

                font-size: 14px;

            }

            

            .mobile-btn {

                width: 40px;

                height: 40px;

                font-size: 16px;

            }

            

            #space-btn {

                width: 70px;

                height: 35px;

                font-size: 12px;

            }

        }

    </style>

</head>

<body>

    <div id="game-container">

        <div id="camera-view">

            <div id="photographer"></div>

            <div id="airplane"></div>

            <div id="camera-body">

                <div id="viewfinder">

                    <div id="hazard-container"></div>

                </div>

                <div id="command-display">指令: </div>

                <div id="shutter-btn">拍照</div>

                <div id="music-btn">♪</div>

            </div>

            <div id="score-display">分数: 0</div>

            <div id="timer-display">时间: 60</div>

            <div id="scene-display">当前场景: 员工休息室</div>

            <div id="level-display">关卡: 1/4</div>

            <div id="target-display">目标分数: 50</div>

            

            <!-- 手机端虚拟方向键 -->

            <div id="mobile-controls">

                <div class="mobile-row">

                    <div class="mobile-btn" id="up-btn">↑</div>

                </div>

                <div class="mobile-row">

                    <div class="mobile-btn" id="left-btn">←</div>

                    <div class="mobile-btn" id="right-btn">→</div>

                </div>

                <div class="mobile-row">

                    <div class="mobile-btn" id="down-btn">↓</div>

                </div>

            </div>

            

            <div id="space-btn">空格</div>

        </div>

        

        <div id="start-screen">

            <h1 style="color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); font-size: 24px;">航空安全小卫士</h1>

            <div id="instructions">

                <h2 style="color: #4CAF50; font-size: 18px;">游戏说明</h2>

                <p>游戏包含四个场景：员工休息室、值机柜台、安检和登机口</p>

                <p>每个安全隐患会显示一个键盘指令组合（↑↓←→方向键的组合）</p>

                <p>快速输入正确的指令组合即可消除隐患</p>

                <p>双击空格键可清空当前指令</p>

                <p>手机端可使用屏幕左下角的虚拟方向键操作</p>

                <p>点击右上角音乐按钮可开启/关闭背景音乐</p>

                <p>你有60秒时间，尽可能多地消除安全隐患！</p>

            </div>

            <button id="start-btn" class="btn">开始游戏</button>

        </div>

        

        <div id="level-intro">

            <h1 id="level-title" style="color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); font-size: 24px;">关卡1: 员工休息室</h1>

            <div id="level-instructions" style="max-width: 600px; margin: 20px auto; background-color: rgba(0,0,0,0.5); padding: 15px; border-radius: 10px; border: 1px solid #555;">

                <h2 style="color: #4CAF50; font-size: 18px;">本关卡注意事项</h2>

                <p>在员工休息室中，你需要关注以下安全隐患：</p>

                <ul style="text-align: left; margin: 10px 0;">

                    <li>电器无人看管充电</li>

                    <li>灭火瓶故障</li>

                    <li>消防通道堵塞</li>

                    <li>充电宝锁闭在储物柜中</li>

                    <li>冰箱内物品长时间放置</li>

                </ul>

                <p>目标分数: <span id="level-target">50</span>分</p>

            </div>

            <button id="continue-btn" class="btn">继续</button>

            <button id="skip-intro-btn" class="btn btn-skip">跳过介绍</button>

        </div>

        

        <div id="game-over">

            <h1 style="color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); font-size: 24px;">游戏结束</h1>

            <p id="final-score" style="font-size: 20px;">你的最终得分: 0</p>

            <button id="restart-btn" class="btn">再玩一次</button>

            <button id="quick-restart-btn" class="btn btn-skip">快速开始</button>

        </div>

    </div>

 

    <!-- 音频元素 -->

    <audio id="background-music" loop>

        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-9.mp3" type="audio/mpeg">

    </audio>

    

    <audio id="shutter-sound">

        <source src="https://www.soundjay.com/buttons/sounds/button-09.mp3" type="audio/mpeg">

    </audio>

 

    <script>

        // 游戏变量

        let score = 0;

        let timeLeft = 60;

        let gameInterval;

        let hazardInterval;

        let bonusInterval;

        let hazards = [];

        let currentScene = 0;

        let currentCommand = '';

        let commandSequence = [];

        let lastSpacePressTime = 0;

        let isMusicPlaying = false;

        let bonusBox = null;

        

        // 关卡分数要求

        const levelRequirements = [50, 100, 150, 200];

        

        // 关卡介绍

        const levelIntros = [

            {

                title: "关卡1: 员工休息室",

                description: "在员工休息室中，你需要关注以下安全隐患：",

                hazards: [

                    "电器无人看管充电",

                    "灭火瓶故障",

                    "消防通道堵塞",

                    "充电宝锁闭在储物柜中",

                    "冰箱内物品长时间放置"

                ]

            },

            {

                title: "关卡2: 值机柜台",

                description: "在值机柜台中，你需要关注以下安全隐患：",

                hazards: [

                    "无人认领行李",

                    "可疑人员",

                    "设备故障",

                    "证件问题",

                    "危险品识别"

                ]

            },

            {

                title: "关卡3: 安检",

                description: "在安检区域中，你需要关注以下安全隐患：",

                hazards: [

                    "违禁物品",

                    "秩序混乱",

                    "人员疏忽",

                    "冲闯安检",

                    "液体超标"

                ]

            },

            {

                title: "关卡4: 登机口",

                description: "在登机口区域中，你需要关注以下安全隐患：",

                hazards: [

                    "先撕后扫",

                    "尾随进入",

                    "电梯故障",

                    "旅客滞留",

                    "通行后未关廊桥门"

                ]

            }

        ];

        

        // 方向指令映射

        const directionMap = {

            'ArrowUp': '↑',

            'ArrowDown': '↓',

            'ArrowLeft': '←',

            'ArrowRight': '→'

        };

        

        // 场景配置

        const scenes = [

            {

                name: "员工休息室",

                background: "https://cdn-icons-png.flaticon.com/512/1138/1138008.png",

                hazards: [

                    {

                        name: "电器无人看管充电",

                        img: "https://cdn-icons-png.flaticon.com/512/2933/2933916.png",

                        correct: "及时拔掉电源",

                        points: 5

                    },

                    {

                        name: "灭火瓶故障",

                        img: "https://cdn-icons-png.flaticon.com/512/2936/2936886.png",

                        correct: "及时上报",

                        points: 5

                    },

                    {

                        name: "消防通道堵塞",

                        img: "https://cdn-icons-png.flaticon.com/512/2784/2784487.png",

                        correct: "立即清理通道",

                        points: 8

                    },

                    {

                        name: "充电宝锁闭在储物柜中",

                        img: "https://cdn-icons-png.flaticon.com/512/2933/2933916.png",

                        correct: "随身携带",

                        points: 5

                    },

                    {

                        name: "冰箱内物品长时间放置",

                        img: "https://cdn-icons-png.flaticon.com/512/3522/3522633.png",

                        correct: "及时取走",

                        points: 5

                    }

                ]

            },

            {

                name: "值机柜台",

                background: "https://cdn-icons-png.flaticon.com/512/1138/1138008.png",

                hazards: [

                    {

                        name: "无人认领行李",

                        img: "https://cdn-icons-png.flaticon.com/512/2936/2936886.png",

                        correct: "报告安保人员",

                        points: 8

                    },

                    {

                        name: "可疑人员",

                        img: "https://cdn-icons-png.flaticon.com/512/3940/3940409.png",

                        correct: "通知安保",

                        points: 8

                    },

                    {

                        name: "设备故障",

                        img: "https://cdn-icons-png.flaticon.com/512/2933/2933916.png",

                        correct: "挂故障牌",

                        points: 5

                    },

                    {

                        name: "证件问题",

                        img: "https://cdn-icons-png.flaticon.com/512/3952/3952531.png",

                        correct: "严格检查",

                        points: 5

                    },

                    {

                        name: "危险品识别",

                        img: "https://cdn-icons-png.flaticon.com/512/3522/3522633.png",

                        correct: "告知客人或及时上报",

                        points: 5

                    }

                ]

            },

            {

                name: "安检",

                background: "https://cdn-icons-png.flaticon.com/512/1138/1138008.png",

                hazards: [

                    {

                        name: "违禁物品",

                        img: "https://cdn-icons-png.flaticon.com/512/2784/2784487.png",

                        correct: "重新检查",

                        points: 10

                    },

                    {

                        name: "秩序混乱",

                        img: "https://cdn-icons-png.flaticon.com/512/2933/2933916.png",

                        correct: "有序过检",

                        points: 8

                    },

                    {

                        name: "人员疏忽",

                        img: "https://cdn-icons-png.flaticon.com/512/2784/2784487.png",

                        correct: "加强监督",

                        points: 8

                    },

                    {

                        name: "冲闯安检",

                        img: "https://cdn-icons-png.flaticon.com/512/4403/4403259.png",

                        correct: "立即制止",

                        points: 10

                    },

                    {

                        name: "液体超标",

                        img: "https://cdn-icons-png.flaticon.com/512/3522/3522633.png",

                        correct: "及时处理",

                        points: 5

                    }

                ]

            },

            {

                name: "登机口",

                background: "https://cdn-icons-png.flaticon.com/512/1138/1138008.png",

                hazards: [

                    {

                        name: "先撕后扫",

                        img: "https://cdn-icons-png.flaticon.com/512/3952/3952531.png",

                        correct: "先扫后撕",

                        points: 8

                    },

                    {

                        name: "尾随进入",

                        img: "https://cdn-icons-png.flaticon.com/512/3940/3940409.png",

                        correct: "引导纠正",

                        points: 10

                    },

                    {

                        name: "电梯故障",

                        img: "https://cdn-icons-png.flaticon.com/512/2933/2933916.png",

                        correct: "备用方案",

                        points: 8

                    },

                    {

                        name: "旅客滞留",

                        img: "https://cdn-icons-png.flaticon.com/512/3940/3940409.png",

                        correct: "及时疏导",

                        points: 5

                    },

                    {

                        name: "通行后未关廊桥门",

                        img: "https://cdn-icons-png.flaticon.com/512/3522/3522633.png",

                        correct: "严格执行门禁四步骤",

                        points: 5

                    }

                ]

            }

        ];

        

        // DOM元素

        const viewfinder = document.getElementById('viewfinder');

        const hazardContainer = document.getElementById('hazard-container');

        const scoreDisplay = document.getElementById('score-display');

        const timerDisplay = document.getElementById('timer-display');

        const sceneDisplay = document.getElementById('scene-display');

        const commandDisplay = document.getElementById('command-display');

        const levelDisplay = document.getElementById('level-display');

        const targetDisplay = document.getElementById('target-display');

        const gameOverScreen = document.getElementById('game-over');

        const finalScoreDisplay = document.getElementById('final-score');

        const startScreen = document.getElementById('start-screen');

        const startBtn = document.getElementById('start-btn');

        const restartBtn = document.getElementById('restart-btn');

        const quickRestartBtn = document.getElementById('quick-restart-btn');

        const musicBtn = document.getElementById('music-btn');

        const bgMusic = document.getElementById('background-music');

        const shutterSound = document.getElementById('shutter-sound');

        const levelIntroScreen = document.getElementById('level-intro');

        const levelTitle = document.getElementById('level-title');

        const levelInstructions = document.getElementById('level-instructions');

        const levelTarget = document.getElementById('level-target');

        const continueBtn = document.getElementById('continue-btn');

        const skipIntroBtn = document.getElementById('skip-intro-btn');

        

        // 手机控制按钮

        const upBtn = document.getElementById('up-btn');

        const downBtn = document.getElementById('down-btn');

        const leftBtn = document.getElementById('left-btn');

        const rightBtn = document.getElementById('right-btn');

        const spaceBtn = document.getElementById('space-btn');

        

        // 初始化游戏

        function initGame() {

            score = 0;

            timeLeft = 60;

            currentScene = 0;

            hazards = [];

            commandSequence = [];

            currentCommand = '';

            bonusBox = null;

            hazardContainer.innerHTML = '';

            scoreDisplay.textContent = `分数: ${score}`;

            timerDisplay.textContent = `时间: ${timeLeft}`;

            sceneDisplay.textContent = `当前场景: ${scenes[currentScene].name}`;

            levelDisplay.textContent = `关卡: ${currentScene + 1}/${scenes.length}`;

            targetDisplay.textContent = `目标分数: ${levelRequirements[currentScene]}`;

            viewfinder.style.backgroundImage = `url("${scenes[currentScene].background}")`;

            commandDisplay.textContent = '指令: ';

            musicBtn.textContent = '♪';

            isMusicPlaying = false;

            bgMusic.pause();

        }

        

        // 显示关卡介绍

        function showLevelIntro() {

            levelTitle.textContent = levelIntros[currentScene].title;

            

            let html = `<h2 style="color: #4CAF50; font-size: 18px;">本关卡注意事项</h2>

                       <p>${levelIntros[currentScene].description}</p>

                       <ul style="text-align: left; margin: 10px 0;">`;

            

            levelIntros[currentScene].hazards.forEach(hazard => {

                html += `<li>${hazard}</li>`;

            });

            

            html += `</ul><p>目标分数: ${levelRequirements[currentScene]}分</p>`;

            levelInstructions.innerHTML = html;

            levelTarget.textContent = levelRequirements[currentScene];

            

            levelIntroScreen.style.display = 'flex';

        }

        

        // 生成随机指令

        function generateCommand() {

            const directions = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];

            const length = Math.floor(Math.random() * 2) + 2; // 2-3个指令

            const command = [];

            

            for (let i = 0; i < length; i++) {

                command.push(directions[Math.floor(Math.random() * directions.length)]);

            }

            

            return command;

        }

        

        // 创建随机安全隐患

        function createHazard() {

            if (hazards.length >= 3) return; // 限制屏幕上最多3个隐患

            

            const viewfinderWidth = viewfinder.offsetWidth;

            const viewfinderHeight = viewfinder.offsetHeight;

            

            const sceneHazards = scenes[currentScene].hazards;

            const hazardType = sceneHazards[Math.floor(Math.random() * sceneHazards.length)];

            const hazard = document.createElement('div');

            hazard.className = 'hazard';

            hazard.style.left = `${Math.random() * (viewfinderWidth - 100)}px`;

            hazard.style.top = `${Math.random() * (viewfinderHeight - 120)}px`;

            

            // 生成随机指令

            const command = generateCommand();

            hazard.dataset.command = command.join(',');

            hazard.dataset.points = hazardType.points;

            

            const hazardImg = document.createElement('div');

            hazardImg.className = 'hazard-img';

            hazardImg.style.backgroundImage = `url("${hazardType.img}")`;

            

            const hazardText = document.createElement('div');

            hazardText.className = 'hazard-text';

            hazardText.textContent = hazardType.name;

            

            const hazardCommand = document.createElement('div');

            hazardCommand.className = 'hazard-command';

            hazardCommand.textContent = command.map(c => directionMap[c]).join(' ');

            

            hazard.appendChild(hazardImg);

            hazard.appendChild(hazardText);

            hazard.appendChild(hazardCommand);

            hazard.dataset.type = hazardType.name;

            hazard.dataset.correct = hazardType.correct;

            

            hazardContainer.appendChild(hazard);

            hazards.push(hazard);

            

            // 隐患5秒后消失

            setTimeout(() => {

                if (hazard.parentNode) {

                    hazardContainer.removeChild(hazard);

                    hazards = hazards.filter(h => h !== hazard);

                }

            }, 5000);

        }

        

        // 创建惊喜盒子

        function createBonusBox() {

            if (bonusBox || hazards.length === 0) return;

            

            const viewfinderWidth = viewfinder.offsetWidth;

            const viewfinderHeight = viewfinder.offsetHeight;

            

            bonusBox = document.createElement('div');

            bonusBox.className = 'bonus-box';

            bonusBox.style.left = `${Math.random() * (viewfinderWidth - 80)}px`;

            bonusBox.style.top = `${Math.random() * (viewfinderHeight - 80)}px`;

            

            // 生成特殊指令

            const command = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight'];

            bonusBox.dataset.command = command.join(',');

            

            hazardContainer.appendChild(bonusBox);

            

            // 10秒后消失

            setTimeout(() => {

                if (bonusBox && bonusBox.parentNode) {

                    hazardContainer.removeChild(bonusBox);

                    bonusBox = null;

                }

            }, 10000);

        }

        

        // 拍照功能

        function takePhoto(hazard) {

            // 闪光效果

            const flash = document.createElement('div');

            flash.className = 'flash-animation';

            flash.style.position = 'absolute';

            flash.style.top = hazard.style.top;

            flash.style.left = hazard.style.left;

            flash.style.width = '100px';

            flash.style.height = '120px';

            flash.style.backgroundColor = 'white';

            flash.style.pointerEvents = 'none';

            hazardContainer.appendChild(flash);

            

            setTimeout(() => {

                if (flash.parentNode) {

                    hazardContainer.removeChild(flash);

                }

            }, 300);

            

            // 播放快门声音

            shutterSound.currentTime = 0;

            shutterSound.play();

            

            // 增加分数

            const points = parseInt(hazard.dataset.points);

            score += points;

            scoreDisplay.textContent = `分数: ${score}`;

            

            // 显示正确操作

            alert(`已消除: ${hazard.dataset.type}\n\n正确操作: ${hazard.dataset.correct}\n\n获得分数: ${points}`);

            

            // 移除隐患

            hazardContainer.removeChild(hazard);

            hazards = hazards.filter(h => h !== hazard);

            

            // 检查是否达到关卡分数要求

            if (score >= levelRequirements[currentScene] && currentScene < scenes.length - 1) {

                currentScene++;

                sceneDisplay.textContent = `当前场景: ${scenes[currentScene].name}`;

                levelDisplay.textContent = `关卡: ${currentScene + 1}/${scenes.length}`;

                targetDisplay.textContent = `目标分数: ${levelRequirements[currentScene]}`;

                viewfinder.style.backgroundImage = `url("${scenes[currentScene].background}")`;

                hazardContainer.innerHTML = '';

                hazards = [];

                bonusBox = null;

                

                // 显示下一关介绍

                showLevelIntro();

            }

        }

        

        // 游戏主循环

        function gameLoop() {

            timeLeft--;

            timerDisplay.textContent = `时间: ${timeLeft}`;

            

            if (timeLeft <= 0) {

                endGame();

            }

        }

        

        // 结束游戏

        function endGame() {

            clearInterval(gameInterval);

            clearInterval(hazardInterval);

            clearInterval(bonusInterval);

            finalScoreDisplay.textContent = `你的最终得分: ${score}`;

            gameOverScreen.style.display = "flex";

        }

        

        // 开始游戏

        function startGame() {

            initGame();

            startScreen.style.display = "none";

            gameOverScreen.style.display = "none";

            showLevelIntro();

        }

        

        // 快速开始游戏（跳过介绍）

        function quickStartGame() {

            initGame();

            startScreen.style.display = "none";

            gameOverScreen.style.display = "none";

            levelIntroScreen.style.display = "none";

            

            // 每1.5秒生成一个隐患

            hazardInterval = setInterval(createHazard, 1500);

            

            // 每20秒生成一个惊喜盒子

            bonusInterval = setInterval(createBonusBox, 20000);

            

            // 游戏计时器

            gameInterval = setInterval(gameLoop, 1000);

        }

        

        // 继续游戏（从关卡介绍进入游戏）

        function continueGame() {

            levelIntroScreen.style.display = "none";

            

            // 每1.5秒生成一个隐患

            hazardInterval = setInterval(createHazard, 1500);

            

            // 每20秒生成一个惊喜盒子

            bonusInterval = setInterval(createBonusBox, 20000);

            

            // 游戏计时器

            gameInterval = setInterval(gameLoop, 1000);

        }

        

        // 检查指令是否正确

        function checkCommand() {

            if (hazards.length === 0 || commandSequence.length === 0) return;

            

            // 检查惊喜盒子

            if (bonusBox) {

                const bonusCommand = bonusBox.dataset.command.split(',');

                if (arraysEqual(commandSequence, bonusCommand)) {

                    // 触发惊喜盒子效果

                    const effect = Math.random() > 0.5 ? 'time' : 'clear';

                    

                    if (effect === 'time') {

                        timeLeft += 10;

                        timerDisplay.textContent = `时间: ${timeLeft}`;

                        alert('恭喜！获得额外10秒时间！');

                    } else {

                        // 清除所有隐患

                        hazardContainer.innerHTML = '';

                        hazards = [];

                        alert('恭喜！清除所有隐患！');

                    }

                    

                    // 移除惊喜盒子

                    hazardContainer.removeChild(bonusBox);

                    bonusBox = null;

                    

                    // 重置指令

                    commandSequence = [];

                    currentCommand = '';

                    commandDisplay.textContent = '指令: ';

                    return;

                }

            }

            

            // 检查所有隐患是否有匹配的指令

            hazards.forEach(hazard => {

                const hazardCommand = hazard.dataset.command.split(',');

                if (arraysEqual(commandSequence, hazardCommand)) {

                    // 指令匹配，消除隐患

                    const points = parseInt(hazard.dataset.points);

                    score += points;

                    scoreDisplay.textContent = `分数: ${score}`;

                    

                    // 显示闪光效果

                    const flash = document.createElement('div');

                    flash.className = 'flash-animation';

                    flash.style.position = 'absolute';

                    flash.style.top = hazard.style.top;

                    flash.style.left = hazard.style.left;

                    flash.style.width = '100px';

                    flash.style.height = '120px';

                    flash.style.backgroundColor = 'white';

                    flash.style.pointerEvents = 'none';

                    hazardContainer.appendChild(flash);

                    

                    setTimeout(() => {

                        if (flash.parentNode) {

                            hazardContainer.removeChild(flash);

                        }

                    }, 300);

                    

                    // 显示正确操作

                    alert(`已消除: ${hazard.dataset.type}\n\n正确操作: ${hazard.dataset.correct}\n\n获得分数: ${points}`);

                    

                    // 移除隐患

                    hazardContainer.removeChild(hazard);

                    hazards = hazards.filter(h => h !== hazard);

                    

                    // 检查是否达到关卡分数要求

                    if (score >= levelRequirements[currentScene] && currentScene < scenes.length - 1) {

                        currentScene++;

                        sceneDisplay.textContent = `当前场景: ${scenes[currentScene].name}`;

                        levelDisplay.textContent = `关卡: ${currentScene + 1}/${scenes.length}`;

                        targetDisplay.textContent = `目标分数: ${levelRequirements[currentScene]}`;

                        viewfinder.style.backgroundImage = `url("${scenes[currentScene].background}")`;

                        hazardContainer.innerHTML = '';

                        hazards = [];

                        bonusBox = null;

                        

                        // 显示下一关介绍

                        showLevelIntro();

                    }

                    

                    // 重置指令

                    commandSequence = [];

                    currentCommand = '';

                    commandDisplay.textContent = '指令: ';

                }

            });

        }

        

        // 比较两个数组是否相等

        function arraysEqual(a, b) {

            if (a.length !== b.length) return false;

            for (let i = 0; i < a.length; i++) {

                if (a[i] !== b[i]) return false;

            }

            return true;

        }

        

        // 事件监听

        startBtn.addEventListener('click', startGame);

        restartBtn.addEventListener('click', startGame);

        quickRestartBtn.addEventListener('click', quickStartGame);

        continueBtn.addEventListener('click', continueGame);

        skipIntroBtn.addEventListener('click', quickStartGame);

        

        // 音乐控制

        musicBtn.addEventListener('click', () => {

            if (isMusicPlaying) {

                bgMusic.pause();

                isMusicPlaying = false;

                musicBtn.textContent = '♪';

            } else {

                bgMusic.volume = 0.3;

                bgMusic.play();

                isMusicPlaying = true;

                musicBtn.textContent = '♫';

            }

        });

        

        // 键盘控制

        document.addEventListener('keydown', (e) => {

            if (e.key === 'ArrowUp' || e.key === 'ArrowDown' ||

                e.key === 'ArrowLeft' || e.key === 'ArrowRight') {

                

                e.preventDefault();

                commandSequence.push(e.key);

                currentCommand += directionMap[e.key] + ' ';

                commandDisplay.textContent = '指令: ' + currentCommand;

                

                // 检查指令

                checkCommand();

                

                // 3秒后重置指令

                clearTimeout(window.commandTimeout);

                window.commandTimeout = setTimeout(() => {

                    commandSequence = [];

                    currentCommand = '';

                    commandDisplay.textContent = '指令: ';

                }, 3000);

            }

            

            // 双击空格清空指令

            if (e.key === ' ') {

                e.preventDefault();

                const now = Date.now();

                if (now - lastSpacePressTime < 300) { // 300毫秒内按两次空格

                    commandSequence = [];

                    currentCommand = '';

                    commandDisplay.textContent = '指令: ';

                }

                lastSpacePressTime = now;

            }

        });

        

        // 手机方向键控制

        upBtn.addEventListener('click', () => {

            commandSequence.push('ArrowUp');

            currentCommand += '↑ ';

            commandDisplay.textContent = '指令: ' + currentCommand;

            checkCommand();

        });

        

        downBtn.addEventListener('click', () => {

            commandSequence.push('ArrowDown');

            currentCommand += '↓ ';

            commandDisplay.textContent = '指令: ' + currentCommand;

            checkCommand();

        });

        

        leftBtn.addEventListener('click', () => {

            commandSequence.push('ArrowLeft');

            currentCommand += '← ';

            commandDisplay.textContent = '指令: ' + currentCommand;

            checkCommand();

        });

        

        rightBtn.addEventListener('click', () => {

            commandSequence.push('ArrowRight');

            currentCommand += '→ ';

            commandDisplay.textContent = '指令: ' + currentCommand;

            checkCommand();

        });

        

        // 手机空格键

        spaceBtn.addEventListener('click', () => {

            const now = Date.now();

            if (now - lastSpacePressTime < 300) { // 300毫秒内按两次空格

                commandSequence = [];

                currentCommand = '';

                commandDisplay.textContent = '指令: ';

            }

            lastSpacePressTime = now;

        });

    </script>

</body>

</html>
