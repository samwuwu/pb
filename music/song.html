<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>随音而行 - 致敬方大同</title>
    <link rel="icon" type="image/png" href="album-cover.jpg">
    <link rel="manifest" href="manifest.json">
    <!-- iOS 锁屏显示相关 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="随音而行">
    <link rel="apple-touch-icon" href="http://ssjubnqgf.hb-bkt.clouddn.com/3_%E5%89%AF%E6%9C%AC.jpg?e=1741008814&token=GryFlGn-HrjFEsnON-Bi773y93uO2rIzCkQcOr_c:-q7bKshNTX3nedc4XLeve8onnIA=">
    <link rel="apple-touch-icon-precomposed" href="http://ssjubnqgf.hb-bkt.clouddn.com/3_%E5%89%AF%E6%9C%AC.jpg?e=1741008814&token=GryFlGn-HrjFEsnON-Bi773y93uO2rIzCkQcOr_c:-q7bKshNTX3nedc4XLeve8onnIA=">
    <link rel="apple-touch-startup-image" href="http://ssjubnqgf.hb-bkt.clouddn.com/3_%E5%89%AF%E6%9C%AC.jpg?e=1741008814&token=GryFlGn-HrjFEsnON-Bi773y93uO2rIzCkQcOr_c:-q7bKshNTX3nedc4XLeve8onnIA=">
    <meta name="apple-music-nowplaying-title" content="随音而行">
    <meta name="apple-music-nowplaying-artist" content="致敬方大同">
    <meta name="apple-music-nowplaying-album" content="随音而行">
    <meta name="apple-music-nowplaying-artwork" content="http://ssjubnqgf.hb-bkt.clouddn.com/3_%E5%89%AF%E6%9C%AC.jpg?e=1741008814&token=GryFlGn-HrjFEsnON-Bi773y93uO2rIzCkQcOr_c:-q7bKshNTX3nedc4XLeve8onnIA=">
    <meta name="theme-color" content="#2A2A2A">
    <meta name="description" content="随音而行 - 致敬方大同，一首充满音乐情怀的歌曲">
    <meta property="og:title" content="随音而行 - 致敬方大同">
    <meta property="og:description" content="随音而行 - 致敬方大同，一首充满音乐情怀的歌曲">
    <meta property="og:image" content="http://ssjubnqgf.hb-bkt.clouddn.com/3_%E5%89%AF%E6%9C%AC.jpg?e=1741008814&token=GryFlGn-HrjFEsnON-Bi773y93uO2rIzCkQcOr_c:-q7bKshNTX3nedc4XLeve8onnIA=">
    <meta property="og:type" content="music.song">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="随音而行 - 致敬方大同">
    <meta name="twitter:description" content="随音而行 - 致敬方大同，一首充满音乐情怀的歌曲">
    <meta name="twitter:image" content="http://ssjubnqgf.hb-bkt.clouddn.com/3_%E5%89%AF%E6%9C%AC.jpg?e=1741008814&token=GryFlGn-HrjFEsnON-Bi773y93uO2rIzCkQcOr_c:-q7bKshNTX3nedc4XLeve8onnIA=">
    <!-- 微信分享相关 -->
    <meta itemprop="name" content="随音而行 - 致敬方大同">
    <meta itemprop="description" content="随音而行 - 致敬方大同，一首充满音乐情怀的歌曲">
    <meta itemprop="image" content="http://ssjubnqgf.hb-bkt.clouddn.com/3_%E5%89%AF%E6%9C%AC.jpg?e=1741008814&token=GryFlGn-HrjFEsnON-Bi773y93uO2rIzCkQcOr_c:-q7bKshNTX3nedc4XLeve8onnIA=">
    <meta name="weixin:card" content="summary_large_image">
    <meta name="weixin:title" content="随音而行 - 致敬方大同">
    <meta name="weixin:description" content="随音而行 - 致敬方大同，一首充满音乐情怀的歌曲">
    <meta name="weixin:image" content="http://ssjubnqgf.hb-bkt.clouddn.com/3_%E5%89%AF%E6%9C%AC.jpg?e=1741008814&token=GryFlGn-HrjFEsnON-Bi773y93uO2rIzCkQcOr_c:-q7bKshNTX3nedc4XLeve8onnIA=">
    <!-- PWA iOS 特定标签 -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- 预加载音频文件 -->
    <link rel="preload" href="随音而行.mp3" as="audio" type="audio/mpeg">
    <style>
        :root {
            --background-color: #2A2A2A;
            --text-primary: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --progress-bar-bg: rgba(255, 255, 255, 0.2);
            --progress-bar-fg: #FFFFFF;
            --bottom-bar-bg: rgba(40, 40, 40, 0.8);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'PingFang SC', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .song-container {
            background: linear-gradient(180deg, rgba(60,60,60,0.5) 0%, var(--background-color) 30%);
            padding: 1rem;
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 3rem;
            position: relative;
        }

        .lyrics-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 200px;
            background-color: var(--background-color);
            z-index: 2000;
            display: none;
            flex-direction: column;
            overflow-y: auto;
            padding: 2rem 1rem;
            pointer-events: none;
        }

        .lyrics-container.show {
            display: block;
            pointer-events: auto;
        }

        .lyrics-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            background: linear-gradient(to bottom, var(--background-color), transparent);
            z-index: 2001;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: auto;
        }

        .close-lyrics {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            padding: 0.5rem;
        }

        .lyrics {
            margin-top: 60px;
            padding: 0 1rem;
            color: var(--text-secondary);
            line-height: 2;
            display: block;
            text-align: center;
        }

        .lyric-line {
            padding: 0.8rem 0;
            transition: all 0.3s ease;
            cursor: pointer;
            opacity: 0.7;
            font-size: 16px;
            text-align: center;
        }

        .lyric-line:hover {
            color: var(--text-primary);
            opacity: 0.9;
            transform: scale(1.02);
        }

        .lyric-line.active {
            color: var(--text-primary);
            opacity: 1;
            font-size: 18px;
            font-weight: 500;
            transform: scale(1.05);
        }

        .album-cover {
            width: 320px;
            height: 320px;
            margin: 1rem auto;
            position: relative;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 4px 60px rgba(0,0,0,0.5);
            animation: rotate 20s linear infinite;
            animation-play-state: paused;
            background: #000;
            padding: 16px;
        }

        .album-cover::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: linear-gradient(45deg, #000 0%, #333 100%);
            z-index: 1;
        }

        .album-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            position: relative;
            z-index: 1;
        }

        .album-cover.playing {
            animation-play-state: running;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .song-title {
            font-size: 22px;
            color: var(--text-primary);
            margin: 1.5rem 0 0.3rem;
            text-align: center;
            font-weight: 500;
        }

        .artist {
            font-size: 19px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 1rem;
            font-weight: normal;
        }

        .song-info {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid var(--text-secondary);
            color: var(--text-secondary);
            font-size: 0.9rem;
            width: 100%;
            max-width: 600px;
        }

        .section-title {
            color: var(--text-primary);
            font-weight: bold;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
        }

        .fixed-player {
            background: linear-gradient(to top, var(--background-color) 70%, transparent);
            padding: 2rem 1.5rem 0;
            box-shadow: none;
            position: fixed;
            bottom: 50px;
            left: 0;
            right: 0;
            z-index: 2001;
        }

        .progress-bar {
            width: 100%;
            height: 3px;
            background: var(--progress-bar-bg);
            border-radius: 1.5px;
            margin: 0;
            cursor: pointer;
        }

        .progress {
            height: 100%;
            background: var(--progress-bar-fg);
            border-radius: 1.5px;
        }

        .time-info {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 12px;
            margin: 0.5rem 0 1rem;
            font-weight: 500;
        }

        .player-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4rem;
            margin: 0.5rem 0;
        }

        .control-button {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 0;
            opacity: 1;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-button#prev,
        .control-button#next,
        .control-button#play {
            font-size: 32px;
            width: 35px;
            height: 35px;
        }

        .play-button {
            font-size: 32px;
            width: 35px;
            height: 35px;
        }

        .lyrics-button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-secondary);
            font-size: 16px;
            cursor: pointer;
            padding: 8px 20px;
            border-radius: 16px;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .lyrics-button:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
        }

        .lyrics-button svg {
            width: 16px;
            height: 16px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 180px;
        }

        .bottom-controls {
            display: none;
        }

        .additional-controls {
            display: none;
        }

        .volume-control {
            display: none;
        }

        .volume-slider {
            display: none;
        }

        .volume-progress {
            display: none;
        }

        #audio-player {
            position: absolute;
            opacity: 0;
            height: 0;
            width: 0;
            z-index: -1;
        }

        @media (max-width: 480px) {
            .album-cover {
                width: 280px;
                height: 280px;
                padding: 12px;
            }
            
            .player-controls {
                gap: 3rem;
            }
            
            .control-button {
                font-size: 24px;
                width: 30px;
                height: 30px;
            }
            
            .play-button {
                font-size: 36px;
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="song-container">
        <div class="main-content">
            <div class="album-cover">
                <img src="album-cover.jpg" alt="专辑封面">
            </div>
            <h1 class="song-title">随音而行</h1>
            <div class="artist">- 致敬方大同</div>
            <button class="lyrics-button">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M2 4v16h20V4H2zm2 14V6h16v12H4zm2-6h12v2H6v-2zm0-3h12v2H6V9z"/>
                </svg>
                歌词
            </button>
        </div>
    </div>

    <div class="lyrics-container">
        <div class="lyrics-header">
            <div></div>
            <div class="song-title" style="font-size: 17px;">随音而行</div>
            <button class="close-lyrics">✕</button>
        </div>
        <div class="lyrics show">
            <div class="section-title">[Verse 1]</div>
            <div class="lyric-line" data-time="11">《黑白》琴键上 听见风</div>
            <div class="lyric-line" data-time="16">《南音》 回荡着 自由歌声</div>
            <div class="lyric-line" data-time="21">你我和旋律，《三人游》</div>
            <div class="lyric-line" data-time="26">节奏在心中 跳动着自由</div>

            <div class="section-title">[Chorus]</div>
            <div class="lyric-line" data-time="31">你是 《特别的人》 教我懂得 《爱爱爱》</div>
            <div class="lyric-line" data-time="36">陪我走过 《危险世界》 迎接 《未来》</div>
            <div class="lyric-line" data-time="41">你的音乐如清风 将心打开</div>
            <div class="lyric-line" data-time="46">自由不羁灵魂 永不被阻碍</div>

            <div class="section-title">[Verse 2]</div>
            <div class="lyric-line" data-time="51">《橙月》 光下 轻轻哼唱</div>
            <div class="lyric-line" data-time="56">放飞 《千纸鹤》 承载愿望</div>
            <div class="lyric-line" data-time="61">纵然渺小如 《小小虫》</div>
            <div class="lyric-line" data-time="66">音符也能照亮寂寞夜空</div>

            <div class="section-title">[Chorus]</div>
            <div class="lyric-line" data-time="71">你是 《特别的人》 教我懂得 《爱爱爱》</div>
            <div class="lyric-line" data-time="76">陪我走过 《危险世界》 迎接 《未来》</div>
            <div class="lyric-line" data-time="81">你的音乐如清风 将心打开</div>
            <div class="lyric-line" data-time="86">自由不羁灵魂 永不被阻碍</div>

            <div class="section-title">[Verse 2]</div>
            <div class="lyric-line" data-time="91">《橙月》 光下 轻轻哼唱</div>
            <div class="lyric-line" data-time="96">放飞 《千纸鹤》 承载愿望</div>
            <div class="lyric-line" data-time="101">纵然渺小如 《小小虫》</div>
            <div class="lyric-line" data-time="106">音符也能照亮寂寞夜空</div>

            <div class="section-title">[Chorus]</div>
            <div class="lyric-line" data-time="111">你是 《特别的人》 教我懂得 《爱爱爱》</div>
            <div class="lyric-line" data-time="117">陪我走过 《危险世界》 迎接 《未来》</div>
            <div class="lyric-line" data-time="123">你的音乐如清风 将心打开</div>
            <div class="lyric-line" data-time="129">自由不羁灵魂 永不被阻碍</div>

            <div class="section-title">[Bridge]</div>
            <div class="lyric-line" data-time="135">旋律在耳边 轻轻流淌</div>
            <div class="lyric-line" data-time="140">歌声在世界 回响不忘</div>
            <div class="lyric-line" data-time="145">《如果爱》 能跨越时光</div>
            <div class="lyric-line" data-time="150">音乐是最温暖的光</div>

            <div class="section-title">[Chorus]</div>
            <div class="lyric-line" data-time="156">你是 《特别的人》 教我懂得 《爱爱爱》</div>
            <div class="lyric-line" data-time="161">陪我走过 《危险世界》 迎接 《未来》</div>
            <div class="lyric-line" data-time="166">你的音乐如清风 将心打开</div>
            <div class="lyric-line" data-time="171">自由不羁灵魂 永不被阻碍</div>

            <div class="section-title">[Outro]</div>
            <div class="lyric-line" data-time="176">风吹起 旋律仍在耳际</div>
            <div class="lyric-line" data-time="181">音乐不停 记忆随音延续……</div>
        </div>
    </div>

    <div class="fixed-player">
        <div class="progress-bar" id="progress-bar">
            <div class="progress" id="progress"></div>
        </div>
        <div class="time-info">
            <span id="current-time">0:03</span>
            <span id="duration">-3:04</span>
        </div>
        <div class="player-controls">
            <button class="control-button" id="prev">⏮︎</button>
            <button class="control-button play-button" id="play">▶</button>
            <button class="control-button" id="next">⏭︎</button>
        </div>
        <div class="additional-controls">
        </div>
        <audio id="audio-player" controls preload="auto" playsinline webkit-playsinline>
            <source src="随音而行.mp3" type="audio/mpeg">
            您的浏览器不支持音频播放。
        </audio>
    </div>

    <script>
        const audio = document.getElementById('audio-player');
        const lyrics = document.querySelectorAll('.lyric-line');
        const playButton = document.getElementById('play');
        const progressBar = document.getElementById('progress');
        const progressContainer = document.getElementById('progress-bar');
        const currentTimeDisplay = document.getElementById('current-time');
        const durationDisplay = document.getElementById('duration');
        const prevButton = document.getElementById('prev');
        const nextButton = document.getElementById('next');
        let currentLyric = null;
        let isPlaying = false;
        let lastUpdateTime = 0;
        const UPDATE_INTERVAL = 100; // 更新间隔（毫秒）

        // 注册Service Worker以支持PWA功能
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('ServiceWorker 注册成功: ', registration.scope);
                }).catch(error => {
                    console.log('ServiceWorker 注册失败: ', error);
                });
            });
        }

        // 设置 MediaSession API
        function setupMediaSession() {
            if ('mediaSession' in navigator) {
                // 使用本地图片路径，确保可以在锁屏时访问
                const artworkUrl = 'album-cover.jpg';
                
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: '随音而行',
                    artist: '致敬方大同',
                    album: '随音而行',
                    artwork: [
                        { src: artworkUrl, sizes: '96x96', type: 'image/jpeg' },
                        { src: artworkUrl, sizes: '128x128', type: 'image/jpeg' },
                        { src: artworkUrl, sizes: '192x192', type: 'image/jpeg' },
                        { src: artworkUrl, sizes: '256x256', type: 'image/jpeg' },
                        { src: artworkUrl, sizes: '384x384', type: 'image/jpeg' },
                        { src: artworkUrl, sizes: '512x512', type: 'image/jpeg' }
                    ]
                });
                
                // 更新 MediaSession 状态
                audio.addEventListener('play', function() {
                    navigator.mediaSession.playbackState = 'playing';
                    document.querySelector('.album-cover').classList.add('playing');
                    document.querySelector('.album-cover').classList.remove('paused');
                    playButton.innerHTML = '⏸';
                    isPlaying = true;
                    
                    // 更新位置状态，提高锁屏控制的准确性
                    updatePositionState();
                });
                
                audio.addEventListener('pause', function() {
                    navigator.mediaSession.playbackState = 'paused';
                    document.querySelector('.album-cover').classList.remove('playing');
                    document.querySelector('.album-cover').classList.add('paused');
                    playButton.innerHTML = '▶';
                    isPlaying = false;
                });
                
                // 定期更新位置状态
                audio.addEventListener('timeupdate', function() {
                    if (isPlaying && 'mediaSession' in navigator) {
                        updatePositionState();
                    }
                });
                
                // 设置媒体会话动作处理程序
                navigator.mediaSession.setActionHandler('play', function() {
                    audio.play();
                });
                
                navigator.mediaSession.setActionHandler('pause', function() {
                    audio.pause();
                });
                
                navigator.mediaSession.setActionHandler('previoustrack', function() {
                    audio.currentTime = 0;
                });
                
                navigator.mediaSession.setActionHandler('nexttrack', function() {
                    audio.currentTime = 0;
                });
                
                // 添加跳转功能
                navigator.mediaSession.setActionHandler('seekto', function(details) {
                    if (details.fastSeek && 'fastSeek' in audio) {
                        audio.fastSeek(details.seekTime);
                        return;
                    }
                    audio.currentTime = details.seekTime;
                    updatePositionState();
                });
                
                // 添加前进后退功能
                const skipTime = 10; // 跳转时间（秒）
                
                navigator.mediaSession.setActionHandler('seekbackward', function(event) {
                    const skipAmount = event.seekOffset || skipTime;
                    audio.currentTime = Math.max(audio.currentTime - skipAmount, 0);
                    updatePositionState();
                });
                
                navigator.mediaSession.setActionHandler('seekforward', function(event) {
                    const skipAmount = event.seekOffset || skipTime;
                    audio.currentTime = Math.min(audio.currentTime + skipAmount, audio.duration);
                    updatePositionState();
                });
                
                // 尝试添加停止功能（部分浏览器支持）
                try {
                    navigator.mediaSession.setActionHandler('stop', function() {
                        audio.pause();
                        audio.currentTime = 0;
                        navigator.mediaSession.playbackState = 'none';
                    });
                } catch (error) {
                    console.log('不支持"stop"操作: ', error);
                }
            }
        }
        
        // 更新位置状态函数
        function updatePositionState() {
            if ('setPositionState' in navigator.mediaSession) {
                navigator.mediaSession.setPositionState({
                    duration: audio.duration || 0,
                    playbackRate: audio.playbackRate || 1,
                    position: audio.currentTime || 0
                });
            }
        }

        // 播放/暂停控制
        playButton.addEventListener('click', () => {
            if (isPlaying) {
                audio.pause();
            } else {
                const playPromise = audio.play();
                
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.error('播放失败:', error);
                    });
                }
            }
        });

        // 上一首/下一首控制
        prevButton.addEventListener('click', () => {
            audio.currentTime = 0;
        });

        nextButton.addEventListener('click', () => {
            audio.currentTime = 0;
        });

        // 进度条更新（使用节流优化性能）
        audio.addEventListener('timeupdate', () => {
            const now = Date.now();
            if (now - lastUpdateTime >= UPDATE_INTERVAL) {
                const progress = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = `${progress}%`;
                currentTimeDisplay.textContent = formatTime(audio.currentTime);
                lastUpdateTime = now;
            }
        });

        // 点击进度条跳转
        progressContainer.addEventListener('click', (e) => {
            const rect = progressContainer.getBoundingClientRect();
            const pos = (e.clientX - rect.left) / rect.width;
            audio.currentTime = pos * audio.duration;
        });

        // 格式化时间
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            seconds = Math.floor(seconds % 60);
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // 设置总时长
        audio.addEventListener('loadedmetadata', () => {
            durationDisplay.textContent = formatTime(audio.duration);
            setupMediaSession(); // 在音频加载后设置MediaSession
            updatePositionState(); // 初始化位置状态
        });

        // 优化后的歌词同步
        let lastLyricUpdate = 0;
        audio.addEventListener('timeupdate', () => {
            const now = Date.now();
            if (now - lastLyricUpdate >= UPDATE_INTERVAL) {
                const currentTime = audio.currentTime;
                let activeLyric = null;
                
                for (let i = lyrics.length - 1; i >= 0; i--) {
                    const time = parseFloat(lyrics[i].dataset.time);
                    if (currentTime >= time && currentTime < time + 6) {
                        activeLyric = lyrics[i];
                        break;
                    }
                }

                if (activeLyric && activeLyric !== currentLyric) {
                    if (currentLyric) {
                        currentLyric.classList.remove('active');
                    }
                    activeLyric.classList.add('active');
                    currentLyric = activeLyric;
                    
                    // 使用 requestAnimationFrame 优化滚动性能
                    requestAnimationFrame(() => {
                        activeLyric.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    });
                }
                
                lastLyricUpdate = now;
            }
        });

        // 专辑封面旋转动画
        const albumCover = document.querySelector('.album-cover');
        
        // 播放结束处理
        audio.addEventListener('ended', () => {
            isPlaying = false;
            playButton.textContent = '▶';
            navigator.mediaSession.playbackState = 'none';
        });

        // 歌词显示/隐藏功能
        const lyricsButton = document.querySelector('.lyrics-button');
        const lyricsContainer = document.querySelector('.lyrics-container');
        const closeLyricsButton = document.querySelector('.close-lyrics');
        const lyricLines = document.querySelectorAll('.lyric-line');

        lyricsButton.addEventListener('click', () => {
            lyricsContainer.classList.add('show');
            document.body.style.overflow = 'hidden';
        });

        closeLyricsButton.addEventListener('click', () => {
            lyricsContainer.classList.remove('show');
            document.body.style.overflow = '';
        });

        // 歌词点击事件处理
        lyricLines.forEach(lyric => {
            lyric.addEventListener('click', () => {
                const time = parseFloat(lyric.dataset.time);
                if (!isNaN(time)) {
                    audio.currentTime = time;
                    if (!isPlaying) {
                        audio.play().catch(error => {
                            console.error('播放失败:', error);
                        });
                    }
                }
            });
        });

        // 处理页面可见性变化，优化后台播放体验
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                // 页面可见时，如果正在播放，确保UI状态正确
                if (!audio.paused) {
                    playButton.innerHTML = '⏸';
                    isPlaying = true;
                    albumCover.classList.add('playing');
                }
            }
        });

        // 处理音频错误
        audio.addEventListener('error', (e) => {
            console.error('音频播放错误:', e);
            alert('音频加载失败，请检查网络连接或刷新页面重试。');
        });

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 确保在用户交互后才尝试播放
            document.body.addEventListener('click', function bodyClick() {
                // 移除事件监听器，确保只执行一次
                document.body.removeEventListener('click', bodyClick);
                
                // 延迟一秒尝试播放
                setTimeout(() => {
                    const playPromise = audio.play();
                    
                    if (playPromise !== undefined) {
                        playPromise.then(_ => {
                            // 播放成功
                            console.log("播放成功");
                        })
                        .catch(error => {
                            // 播放被阻止
                            console.log("播放需要用户交互:", error);
                        });
                    }
                }, 1000);
            }, { once: true });
        });
    </script>
</body>
</html> 