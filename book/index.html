<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="《知微见著》by AI·Orange - 在线小说阅读体验。提供多种字体、字号和主题选择，支持书签和章节导航。">
    <title>《知微见著》 - AI·Orange</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-white text-gray-800 text-base">

    <header class="fixed top-0 left-0 right-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-md shadow-md z-50 p-4 flex justify-between items-center h-16" aria-label="页面顶部操作栏">
        <div class="flex items-center">
            <button id="tocBtn" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700 mr-2" aria-label="打开/关闭目录" aria-expanded="false" aria-controls="tocPanel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>
            </button>
            <div class="text-xl font-semibold" role="heading" aria-level="1">《知微见著》</div>
        </div>
        <div class="flex items-center space-x-1 sm:space-x-2">
            <div class="relative group">
                <p id="usernameDisplay" class="px-2 py-1 text-sm text-gray-800 dark:text-gray-200 truncate w-24 sm:w-32"></p>
            </div>
            <button id="fontSettingsBtn" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700" aria-label="打开/关闭字体设置" aria-expanded="false" aria-controls="fontPanel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 21l5.25-11.25L21 21m-9-3h7.5M3 5.621a48.474 48.474 0 016-.371m0 0c1.12 0 2.233.038 3.334.114M9 5.25V3m3.334 2.364C11.176 10.658 7.69 15.08 3 17.502m9.334-12.138c.896.061 1.785.147 2.666.257m-4.589 8.495a18.023 18.023 0 01-3.827-5.802" />
                </svg>
            </button>
            <button id="themeCycleBtn" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700" aria-label="切换主题">
                <svg id="themeIconLight" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 hidden" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" /></svg>
                <svg id="themeIconDark" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 hidden" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" /></svg>
            </button>
            <button id="bookmarkBtn" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700" aria-label="打开/关闭书签" aria-expanded="false" aria-controls="bookmarksPanel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.5 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z" /></svg>
            </button>
            
            <!-- <div id="userAuthSection" class="ml-2 flex items-center">
                <div id="loginForm" class="flex items-center text-sm">
                    <input type="email" id="emailInput" placeholder="输入邮箱登录/注册" class="px-2 py-1 border rounded-l-md text-xs dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-1 focus:ring-blue-500 dark:focus:ring-purple-500 outline-none transition-all duration-150" style="width: 150px; height: 30px; font-size: 0.75rem;">
                    <button id="sendLoginLinkBtn" class="px-2 py-1 bg-blue-500 dark:bg-purple-600 text-white rounded-r-md hover:bg-blue-600 dark:hover:bg-purple-700 text-xs whitespace-nowrap" style="height: 30px; font-size: 0.75rem;">发送链接</button>
                </div>
                <div id="userInfo" class="hidden items-center text-sm">
                    <img id="userAvatar" src="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>👤</text></svg>" alt="用户头像" class="w-8 h-8 rounded-full mr-2 object-cover border border-gray-300 dark:border-gray-600">
                    <span id="usernameDisplay" class="mr-3 dark:text-gray-200 font-medium truncate max-w-[100px]" title="点击可修改昵称 (功能待实现)"></span>
                    <button id="logoutBtn" class="px-2 py-1 text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs underline whitespace-nowrap" style="height: 30px; font-size: 0.75rem;">退出</button>
                </div>
            </div> -->
            </div>
    </header>

    <div id="progressBarContainer" aria-hidden="true"><div id="progressBar"></div></div>
    <div id="overlay" class="fixed inset-0 bg-black/50 dark:bg-black/70 z-40 overlay-hidden" aria-hidden="true" tabindex="-1"></div>

    <div id="confirmationModal" class="fixed inset-0 bg-black/50 dark:bg-black/70 z-[1001] flex items-center justify-center hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl max-w-sm w-full mx-4" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalMessage">
            <h3 id="modalTitle" class="text-lg font-semibold mb-4 dark:text-white">确认操作</h3>
            <p id="modalMessage" class="text-gray-700 dark:text-gray-300 mb-4">你确定要执行此操作吗？</p>
            <div id="modalAuthInputGroup" class="mb-6 hidden"> <label for="confirmUsernameInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">请输入你的名字以确认：</label>
                <input type="text" id="confirmUsernameInput" 
                       class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500 text-sm dark:text-white shadow-sm" 
                       placeholder="你的名字">
                <p id="confirmAuthError" class="text-red-500 dark:text-red-400 text-xs mt-1 hidden">名字不匹配，请重试。</p>
            </div>
            <div class="flex justify-end space-x-3">
                <button id="cancelConfirmBtn" class="px-4 py-2 text-sm font-medium bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded-md dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">取消</button>
                <button id="confirmActionBtn" class="px-4 py-2 text-sm font-medium bg-red-500 hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">确认</button>
            </div>
        </div>
    </div>
    <aside id="tocPanel" class="panel toc-panel-hidden fixed top-0 left-0 h-full w-full max-w-xs bg-white dark:bg-gray-800 shadow-lg p-6 z-[51] overflow-y-auto" aria-labelledby="tocHeading" tabindex="-1">
        <div class="flex justify-between items-center mb-4">
            <h2 id="tocHeading" class="text-xl font-semibold">目录</h2>
            <button id="closeTocBtn" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700" aria-label="关闭目录"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg></button>
        </div>
        <nav id="tocList" class="space-y-1" aria-label="章节导航"></nav>
    </aside>

    <aside id="fontPanel" class="panel settings-panel-hidden fixed top-[70px] right-4 bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6 z-[51] w-72" aria-labelledby="fontPanelHeading" tabindex="-1">
        <div class="flex justify-between items-center mb-3">
            <h2 id="fontPanelHeading" class="text-lg font-semibold">外观设置</h2>
        </div>
        <div>
            <label for="fontSizeSlider" class="block text-sm font-medium mb-1">字体大小: <span id="currentFontSizeName" class="text-sm text-gray-600 dark:text-gray-400">大</span></label>
            <input type="range" id="fontSizeSlider" min="0" max="3" step="1" class="w-full mb-4" aria-describedby="currentFontSizeName"> </div>
        <div>
            <label for="fontFamilySelector" class="block text-sm font-medium mb-1">选择字体</label>
            <select id="fontFamilySelector" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500 text-sm">
                <option disabled selected value="">— 选择字体 —</option>
            </select>
        </div>
    </aside>

    <aside id="bookmarksPanel" class="panel settings-panel-hidden fixed top-[70px] right-4 bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6 z-[51] w-72 max-h-[70vh] overflow-y-auto" aria-labelledby="bookmarksPanelHeading" tabindex="-1">
        <h2 id="bookmarksPanelHeading" class="text-lg font-semibold mb-4">我的书签</h2>
        <button id="addCurrentBookmarkBtn" class="w-full mb-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 dark:bg-purple-600 dark:hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-purple-500">添加当前位置为书签</button>
        <div id="bookmarksList" class="space-y-2" aria-live="polite">
            <p class="text-sm text-gray-500 dark:text-gray-400">暂无书签。</p>
        </div>
    </aside>
    
    <main id="novelContent" class="prose dark:prose-invert px-4 pt-24 pb-16" aria-live="polite">
        <div class="text-center py-8">
            <p class="text-lg text-gray-500 dark:text-gray-400">正在加载内容，请稍候...</p>
            </div>
    </main>

    <div id="sharePopup" class="fixed p-4 bg-white dark:bg-gray-800 shadow-xl rounded-md z-[1000]" role="dialog" aria-modal="true" aria-labelledby="sharePopupHeading" style="display: none; min-width: 300px; max-width: 90vw; /* 限制最大宽度 */">
        <h3 id="sharePopupHeading" class="text-lg font-semibold mb-3 dark:text-white">添加笔记/想法</h3>
        
        <div class="mb-3">
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-1">针对内容：</p>
            <p id="selectedTextPreview" class="text-sm italic text-gray-700 dark:text-gray-300 max-h-24 overflow-y-auto p-2 bg-gray-100 dark:bg-gray-700 rounded shadow-inner"></p>
        </div>

        <div class="mb-4">
            <label for="noteInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">您的笔记：</label>
            <textarea id="noteInput" rows="4" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:ring-blue-500 focus:border-blue-500 text-sm dark:text-white shadow-sm" placeholder="在此输入您的笔记..."></textarea>
        </div>

        <div class="mb-4 text-sm text-gray-700 dark:text-gray-300 flex items-center space-x-2">
            <label for="noteUsernameInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">你的名字：</label>
            <input type="text" id="noteUsernameInput" placeholder="你的名字" 
                   class="px-2 py-1 text-sm rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-1 focus:ring-blue-500 dark:focus:ring-purple-500 transition-all duration-150 flex-grow"
                   aria-label="输入你的名字">
        </div>
        <div class="mt-4 flex justify-end space-x-3">
            <button id="copySelectedTextBtn" class="px-4 py-2 text-sm font-medium bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded-md dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">复制所选</button>
            <button id="cancelNoteBtn" class="px-4 py-2 text-sm font-medium bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded-md dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">取消</button>
            <button id="saveNoteBtn" class="px-4 py-2 text-sm font-medium bg-blue-500 hover:bg-blue-600 dark:bg-purple-600 dark:hover:bg-purple-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-purple-500">保存笔记</button>
        </div>
        
    </div>
    <footer class="py-8 text-center text-sm text-gray-600 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700">
        <p>&copy; <span id="currentYear">2024</span> AI·Orange &《知微见著》版权所有.</p>
        <p><a href="admin-notes.html" class="text-blue-500 hover:underline dark:text-purple-400">后台笔记管理</a></p>
    </footer>

    <button id="returnToTopBtn" class="p-3 bg-blue-500 dark:bg-purple-600 text-white rounded-full shadow-lg hover:bg-blue-600 dark:hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-400 dark:focus:ring-purple-500" aria-label="返回顶部">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" /></svg>
    </button>

    <script src="script.js" defer></script>
</body>
</html>
